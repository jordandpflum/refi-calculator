{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Refi Calculator","text":"<p>Refi Calculator is a multi-interface toolkit that helps homeowners and finance professionals evaluate refinancing decisions. The package blends a full-featured Tkinter GUI with a Streamlit placeholder for future web delivery, a CLI entry point, and a core analytics library so every interface relies on consistent calculations.</p>"},{"location":"#key-capabilities","title":"Key Capabilities","text":"<ul> <li>Side-by-side loan comparisons for current vs. proposed mortgages covering nominal   payments, after-tax analysis, and amortization.</li> <li>Decision support such as breakeven and holding-period tables, plus accelerated payoff   scenarios that keep target payments constant.</li> <li>Insightful visualizations via the Tkinter tabbed UI: refreshed cumulative savings chart,   loan balance comparison, and the amortization table that highlights cumulative interest deltas.</li> <li>Market intelligence when the <code>FRED_API_KEY</code> is provided: historical 30-year fixed rates,   live default refinance estimates, and dual-tenor comparison tables.</li> <li>Export-ready data for every tab so downstream tools or reports can consume precise CSV   exports.</li> </ul>"},{"location":"#quick-links-navigation","title":"Quick Links &amp; Navigation","text":"Destination Description User Guide Guides for installing, configuring, and using the GUI or web experience. API Reference Auto-generated reference for the core analytics library under <code>reference/</code>. Codebase Overview Key modules live under <code>src/refi_calculator/</code>, including <code>core/</code>, <code>gui/</code>, and <code>web/</code>. Automation/Entry Points Entry scripts under <code>bin/</code> for CLI launches and PowerShell wrappers. <p>Use the navigation pane (Home, User Guide, API Reference) to jump into each document or explore the generated reference pages from <code>docs/gen_ref_pages.py</code>.</p>"},{"location":"#environment-entry-points","title":"Environment &amp; Entry Points","text":"<ol> <li>Runtime requirements: Python 3.13+, Poetry-managed dependencies, and an optional <code>.venv/</code>    for isolation.</li> <li>GUI launch: <code>poetry run refi-calculator</code> (the console script wires into    <code>refi_calculator.gui.app:main</code>).</li> <li>Hosted Streamlit experience: Visit https://refi-calculator.streamlit.app/    for the hosted preview powered by the Streamlit placeholder layers.</li> <li>Web placeholder: enable <code>[web]</code> extras and run <code>poetry run refi-calculator-web</code> to start    <code>streamlit run src/refi_calculator/web/app.py</code> and continue iterating toward the future web UI.</li> <li>CLI scaffolding: <code>src/refi_calculator/cli.py</code> and <code>bin/refi-calculator.py</code> share logging and    configuration plumbing for command-line workflows.</li> </ol>"},{"location":"#development-quality","title":"Development &amp; Quality","text":"<ul> <li>Testing: <code>poetry run pytest</code> (tests live under <code>tests/</code> following <code>test_*.py</code>).</li> <li>Pre-commit checks: <code>poetry run pre-commit run --all-files</code> keeps formatting (Black, Ruff,   isort) and linting in sync.</li> <li>Documentation generation: <code>mkdocs</code> powers static sites with plugins for search, literate   navigation, and mkdocstrings referencing <code>src/</code>.</li> <li>Versioning and releases: use conventional commits (<code>feat</code>, <code>fix</code>, <code>docs</code>, etc.) and keep   changelog entries in <code>CHANGELOG.md</code> aligned with PyPI releases.</li> </ul>"},{"location":"#contribution-guidance","title":"Contribution Guidance","text":"<ul> <li>Update docs (<code>docs/guide.md</code> and <code>docs/index.md</code>) whenever behavior changes or new capabilities   are added.</li> <li>Keep feature branches focused; run targeted tests locally and ensure all relevant hooks pass   before opening a pull request.</li> <li>For automation updates (PowerShell scripts, bin scripts), preserve the structure outlined in   <code>AGENTS.md</code> and mirror logging/transcript behavior.</li> <li>Refer to <code>AGENTS.md</code> for standards on module headers, docstrings, logging, and error handling so   every Python module stays consistent.</li> </ul>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li>Dive into the User Guide to see detailed workflows for using the GUI, enabling the market   tab, and contributing safely.</li> <li>Browse API Reference for individual plot builders, calculators, and models exposed under   <code>src/refi_calculator/core/</code>.</li> <li>Run <code>docs/gen_ref_pages.py</code> when you add new modules so the reference site stays current.</li> </ul>"},{"location":"guide/","title":"User Guide","text":"<p>This guide walks through installing, configuring, and operating Refi Calculator across the GUI, web placeholder, and supporting tooling. Follow the sections below in order, or jump straight to the workflow that matches your role (borrower, analyst, or maintainer).</p>"},{"location":"guide/#project-intent","title":"Project Intent","text":"<p>Refi Calculator is a decision-support suite for borrowers who want to understand how a refinance offer stacks up against an existing mortgage. The GUI layers clear comparisons, visualizations, and forecasts on top of a single analytics core, so every view (breakeven, holding period, amortization, or savings chart) relies on consistent rules, taxation assumptions, and payoff math.</p>"},{"location":"guide/#installation-environment-setup","title":"Installation &amp; Environment Setup","text":"<ol> <li>System requirements</li> <li>Python 3.13 or newer.</li> <li>Poetry for dependency resolution and virtual environment management.</li> <li>A shell capable of activating the generated <code>.venv/</code> in the project root (standard on macOS/      Linux).</li> <li>Bootstrap the project</li> </ol> <p><code>bash    poetry install</code></p> <p>This command installs runtime and development dependencies, generates the virtual environment,    and registers Git hooks declared in <code>.pre-commit-config.yaml</code>. 3. Optional extras    - Install GUI-only requirements via <code>pip install .[gui]</code> (already included when running <code>poetry      install</code>).    - Add the web placeholder dependencies with <code>pip install .[web]</code> to bring in Streamlit and      front-end helpers. 4. Environment variables    - Provide <code>FRED_API_KEY</code> to enable the Market tab to refresh historical 30-year fixed rates from      the Federal Reserve Economic Data (FRED) API. The key populates tables and the default      refinance rate.</p>"},{"location":"guide/#running-the-tkinter-gui","title":"Running the Tkinter GUI","text":"<ol> <li>Launch command</li> </ol> <p><code>bash    poetry run refi-calculator</code></p> <p>The <code>refi-calculator</code> console script routes to <code>refi_calculator.gui.app:main</code>, which initializes    the tabs, logging, and data exporters. 2. GUI layout highlights    - Overview tab: Compares current and proposed loans using nominal and after-tax payments      while surfacing an early decision recommendation.    - Breakeven tab: Shows when tax-adjusted savings justify the refinance. Use the table      filters to focus on different holding periods.    - Holding Period tab: Projects payments over discrete horizons so you can model shorter      timeframes.    - Loan Visualizations tab: Displays the amortization table (with cumulative interest delta      column), the refreshed cumulative savings chart, and the new balance comparison chart for      both loans.    - Market tab: When <code>FRED_API_KEY</code> exists, the tab pulls the latest 30-year fixed data,      toggles between tenors (15Y/30Y), and pre-fills the refinance rate. If the API call fails or      the key is absent, the UI logs the skip but keeps other tabs operational. 3. Exporting insights    Every tab includes a CSV export button. Use this to feed spreadsheets or downstream analytics    with the exact rows shown in the table.</p>"},{"location":"guide/#running-the-streamlit-web-placeholder","title":"Running the Streamlit Web Placeholder","text":"<ol> <li>Install extras: <code>pip install .[web]</code> (if not already part of <code>poetry install</code>).</li> <li>Launch command</li> </ol> <p><code>bash    poetry run refi-calculator-web</code></p> <p>This command invokes <code>streamlit run src/refi_calculator/web/app.py</code>, giving you a browser-based    preview of the future web experience while retaining centralized configuration logic. The same    Streamlit workflow also hosts at https://refi-calculator.streamlit.app/    for a zero-install, shareable showcase. 3. Behavior    The placeholder mirrors the GUI's core calculations but simplifies interactions for rapid    prototyping. Expect limited functionality while the Streamlit UI continues to evolve.</p>"},{"location":"guide/#cli-automation-considerations","title":"CLI &amp; Automation Considerations","text":"<ul> <li>The CLI entry point <code>refi_calculator.cli</code> centralizes logging configuration, verbosity controls,   and optional JSON config loading. Use <code>bin/refi-calculator.py</code> for scriptable hooks or automation   wrappers.</li> <li>PowerShell scripts inside <code>automation/</code> follow the structure described in <code>AGENTS.md</code>, including   transcript logging, repository management, Poetry activation, and safe cleanup.</li> </ul>"},{"location":"guide/#data-logs-and-troubleshooting","title":"Data, Logs, and Troubleshooting","text":"<ul> <li>Market data: If historical data is unavailable, the Market tab reports the reason via the GUI   log window and gracefully disables the missing dataset. Always verify <code>FRED_API_KEY</code> formatting   and connectivity when the tab reports stale data.</li> <li>Logging: Related modules use <code>logging.getLogger(__name__)</code>; check the console output when you   encounter inconsistent calculations or GUI launch failures.</li> <li>Exception handling: The core follows the <code>logger.exception(...); raise</code> pattern whenever an   unexpected condition occurs, keeping tracebacks accessible for maintainers.</li> </ul>"},{"location":"guide/#testing-quality-assurance","title":"Testing &amp; Quality Assurance","text":"<ul> <li>Run <code>poetry run pytest</code> to execute tests under <code>tests/</code> (expand coverage as functionality grows).</li> <li>Use <code>poetry run pre-commit run --all-files</code> to ensure formatting and linting (Black, Ruff, etc.)   remain consistent with project policy.</li> <li>Add tests whenever you introduce calculations or UI logic; align file names with <code>test_*.py</code> and   place shared fixtures in the appropriate <code>conftest.py</code> files.</li> </ul>"},{"location":"guide/#contributions-release-readiness","title":"Contributions &amp; Release Readiness","text":"<ol> <li>Workflow</li> <li>Branch from <code>main</code>, keep changes focused, and describe your work with a conventional commit      message (<code>feat</code>, <code>fix</code>, <code>docs</code>, etc.).</li> <li>Update <code>CHANGELOG.md</code> when you ship features or fixes that users should notice.</li> <li>Documentation</li> <li>Refresh <code>docs/guide.md</code> or <code>docs/index.md</code> whenever behavior changes or new interfaces emerge.</li> <li>Regenerate auto reference pages with <code>python docs/gen_ref_pages.py</code> if you add new modules.</li> <li>Publishing</li> <li>After review and testing, <code>poetry publish</code> targets PyPI releases (the project already publishes      via GitHub Actions using the CI workflow described in <code>README.md</code>).</li> </ol>"},{"location":"guide/#additional-resources","title":"Additional Resources","text":"<ul> <li><code>README.md</code> for a quick overview, feature list, and install instructions.</li> <li><code>AGENTS.md</code> for code standards, logging practices, docstring expectations, and CLI patterns.</li> <li><code>docs/reference/</code> (auto-generated) for developer-facing API details.</li> <li><code>mkdocs.yml</code> + <code>docs/gen_ref_pages.py</code> for how the static documentation site builds itself.</li> </ul>"},{"location":"reference/SUMMARY/","title":"SUMMARY","text":"<ul> <li>refi_calculator<ul> <li>cli</li> <li>core<ul> <li>calculations</li> <li>charts</li> <li>market<ul> <li>constants</li> <li>fred</li> </ul> </li> <li>models</li> </ul> </li> <li>environment</li> <li>gui<ul> <li>app</li> <li>builders<ul> <li>analysis_tab</li> <li>helpers</li> <li>info_tab</li> <li>main_tab</li> <li>market_tab</li> <li>options_tab</li> <li>visuals_tab</li> </ul> </li> <li>chart</li> <li>market_chart</li> </ul> </li> <li>web<ul> <li>app</li> <li>calculator</li> <li>formatting</li> <li>info</li> <li>market</li> <li>results</li> <li>runner</li> </ul> </li> </ul> </li> </ul>"},{"location":"reference/refi_calculator/cli/","title":"cli","text":"<p>Command-line launcher for the refinance calculator app.</p>"},{"location":"reference/refi_calculator/cli/#refi_calculator.cli.main","title":"<code>main(argv=None)</code>","text":"<p>Launch the refinance calculator UI.</p> <p>Parameters:</p> Name Type Description Default <code>argv</code> <code>list[str] | None</code> <p>Optional argument list; defaults to <code>sys.argv</code> when <code>None</code>.</p> <code>None</code> Source code in <code>src/refi_calculator/cli.py</code> <pre><code>def main(argv: list[str] | None = None) -&gt; None:\n    \"\"\"Launch the refinance calculator UI.\n\n    Args:\n        argv: Optional argument list; defaults to ``sys.argv`` when ``None``.\n    \"\"\"\n    parser = _create_parser()\n    parser.parse_args(argv)\n    load_dotenv()\n    basicConfig(level=\"INFO\")\n    logger.info(\"Launching Refi-Calculator UI\")\n    launch_gui()\n</code></pre>"},{"location":"reference/refi_calculator/environment/","title":"environment","text":"<p>Utilities for loading environment variables from .env files.</p>"},{"location":"reference/refi_calculator/environment/#refi_calculator.environment.load_dotenv","title":"<code>load_dotenv(dotenv_path=None, *, override_existing=False)</code>","text":"<p>Load environment variables from a .env file into the process environment.</p> <p>Parameters:</p> Name Type Description Default <code>dotenv_path</code> <code>Path | str | None</code> <p>Path to the .env file. Defaults to <code>Path.cwd() / \".env\"</code>.</p> <code>None</code> <code>override_existing</code> <code>bool</code> <p>Whether to overwrite existing environment variables.</p> <code>False</code> <p>Returns:</p> Type Description <code>dict[str, str]</code> <p>A mapping of keys that were set from the .env file to their values.</p> <p>Raises:</p> Type Description <code>OSError</code> <p>If the .env file could not be read.</p> Source code in <code>src/refi_calculator/environment.py</code> <pre><code>def load_dotenv(\n    dotenv_path: Path | str | None = None,\n    *,\n    override_existing: bool = False,\n) -&gt; dict[str, str]:\n    \"\"\"Load environment variables from a .env file into the process environment.\n\n    Args:\n        dotenv_path: Path to the .env file. Defaults to ``Path.cwd() / \".env\"``.\n        override_existing: Whether to overwrite existing environment variables.\n\n    Returns:\n        A mapping of keys that were set from the .env file to their values.\n\n    Raises:\n        OSError: If the .env file could not be read.\n    \"\"\"\n    path = Path(dotenv_path) if dotenv_path is not None else Path.cwd() / \".env\"\n    if not path.exists():\n        logger.debug(\"No .env file found at %s\", path)\n        return {}\n\n    try:\n        content = path.read_text(encoding=\"utf-8\")\n    except OSError:\n        logger.exception(\"Failed to read .env file at %s\", path)\n        raise\n\n    loaded: dict[str, str] = {}\n    for line in _iter_lines(content):\n        pair = _parse_dotenv_line(line)\n        if pair is None:\n            continue\n\n        key, value = pair\n        if override_existing or key not in os.environ:\n            os.environ[key] = value\n            loaded[key] = value\n        else:\n            logger.debug(\"Skipping existing environment variable %s\", key)\n\n    logger.debug(\"Loaded %d environment variables from %s\", len(loaded), path)\n    return loaded\n</code></pre>"},{"location":"reference/refi_calculator/core/calculations/","title":"calculations","text":"<p>Financial calculations for refinance analysis.</p>"},{"location":"reference/refi_calculator/core/calculations/#refi_calculator.core.calculations.analyze_refinance","title":"<code>analyze_refinance(current_balance, current_rate, current_remaining_years, new_rate, new_term_years, closing_costs, opportunity_rate=0.05, npv_window_years=5, chart_horizon_years=10, marginal_tax_rate=0.0, cash_out=0.0, maintain_payment=False)</code>","text":"<p>Analyze refinance scenario.</p> <p>Parameters:</p> Name Type Description Default <code>current_balance</code> <code>float</code> <p>Current loan balance</p> required <code>current_rate</code> <code>float</code> <p>Current loan interest rate (as a decimal)</p> required <code>current_remaining_years</code> <code>float</code> <p>Current loan remaining term in years</p> required <code>new_rate</code> <code>float</code> <p>New loan interest rate (as a decimal)</p> required <code>new_term_years</code> <code>float</code> <p>New loan term in years</p> required <code>closing_costs</code> <code>float</code> <p>Closing costs for refinance</p> required <code>opportunity_rate</code> <code>float</code> <p>Opportunity cost rate (as a decimal). Default is 5%.</p> <code>0.05</code> <code>npv_window_years</code> <code>int</code> <p>Years to calculate NPV over. Default is 5 years.</p> <code>5</code> <code>chart_horizon_years</code> <code>int</code> <p>Years to show in cumulative savings chart. Default is 10 years.</p> <code>10</code> <code>marginal_tax_rate</code> <code>float</code> <p>Marginal tax rate (as a decimal). Default is 0%.</p> <code>0.0</code> <code>cash_out</code> <code>float</code> <p>Cash out amount from refinance. Default is 0.</p> <code>0.0</code> <code>maintain_payment</code> <code>bool</code> <p>Whether to maintain current payment amount. Default is False.</p> <code>False</code> <p>Returns:</p> Type Description <code>RefinanceAnalysis</code> <p>RefinanceAnalysis object with results</p> Source code in <code>src/refi_calculator/core/calculations.py</code> <pre><code>def analyze_refinance(\n    current_balance: float,\n    current_rate: float,\n    current_remaining_years: float,\n    new_rate: float,\n    new_term_years: float,\n    closing_costs: float,\n    opportunity_rate: float = 0.05,\n    npv_window_years: int = 5,\n    chart_horizon_years: int = 10,\n    marginal_tax_rate: float = 0.0,\n    cash_out: float = 0.0,\n    maintain_payment: bool = False,\n) -&gt; RefinanceAnalysis:\n    \"\"\"Analyze refinance scenario.\n\n    Args:\n        current_balance: Current loan balance\n        current_rate: Current loan interest rate (as a decimal)\n        current_remaining_years: Current loan remaining term in years\n        new_rate: New loan interest rate (as a decimal)\n        new_term_years: New loan term in years\n        closing_costs: Closing costs for refinance\n        opportunity_rate: Opportunity cost rate (as a decimal). Default is 5%.\n        npv_window_years: Years to calculate NPV over. Default is 5 years.\n        chart_horizon_years: Years to show in cumulative savings chart. Default is 10 years.\n        marginal_tax_rate: Marginal tax rate (as a decimal). Default is 0%.\n        cash_out: Cash out amount from refinance. Default is 0.\n        maintain_payment: Whether to maintain current payment amount. Default is False.\n\n    Returns:\n        RefinanceAnalysis object with results\n    \"\"\"\n    current_loan = LoanParams(\n        balance=current_balance,\n        rate=current_rate,\n        term_years=current_remaining_years,\n    )\n\n    new_balance = current_balance + closing_costs + cash_out\n    new_loan = LoanParams(\n        balance=new_balance,\n        rate=new_rate,\n        term_years=new_term_years,\n    )\n\n    monthly_savings = current_loan.monthly_payment - new_loan.monthly_payment\n\n    simple_breakeven: float | None = None\n    if monthly_savings &gt; 0:\n        simple_breakeven = closing_costs / monthly_savings\n\n    monthly_opp_rate = opportunity_rate / 12\n    chart_months = chart_horizon_years * 12\n    cumulative_savings, npv_breakeven = _build_cumulative_savings(\n        monthly_savings,\n        closing_costs,\n        monthly_opp_rate,\n        chart_months,\n        new_loan.num_payments,\n    )\n\n    npv_window_months = npv_window_years * 12\n    window_npv = _calculate_npv_window(\n        monthly_savings,\n        monthly_opp_rate,\n        closing_costs,\n        npv_window_months,\n    )\n\n    current_avg_monthly_interest = current_loan.total_interest / current_loan.num_payments\n    new_avg_monthly_interest = new_loan.total_interest / new_loan.num_payments\n    current_monthly_tax_benefit = current_avg_monthly_interest * marginal_tax_rate\n    new_monthly_tax_benefit = new_avg_monthly_interest * marginal_tax_rate\n\n    current_after_tax_payment = current_loan.monthly_payment - current_monthly_tax_benefit\n    new_after_tax_payment = new_loan.monthly_payment - new_monthly_tax_benefit\n    after_tax_monthly_savings = current_after_tax_payment - new_after_tax_payment\n\n    after_tax_simple_breakeven = None\n    if after_tax_monthly_savings &gt; 0:\n        after_tax_simple_breakeven = closing_costs / after_tax_monthly_savings\n\n    after_tax_npv_breakeven = _find_npv_breakeven(\n        after_tax_monthly_savings,\n        monthly_opp_rate,\n        closing_costs,\n        new_loan.num_payments,\n    )\n\n    after_tax_npv = _calculate_npv_window(\n        after_tax_monthly_savings,\n        monthly_opp_rate,\n        closing_costs,\n        npv_window_months,\n    )\n\n    current_after_tax_total_interest = current_loan.total_interest * (1 - marginal_tax_rate)\n    new_after_tax_total_interest = new_loan.total_interest * (1 - marginal_tax_rate)\n\n    accelerated_months: int | None = None\n    accelerated_total_interest: float | None = None\n    accelerated_interest_savings: float | None = None\n    accelerated_time_savings_months: int | None = None\n\n    # Accelerated payoff calculations (if maintaining current payment)\n    if maintain_payment and current_loan.monthly_payment &gt; new_loan.monthly_payment:\n        # User wants to keep paying the old (higher) amount\n        acc_months, acc_interest = calculate_accelerated_payoff(\n            new_balance,\n            new_rate,\n            current_loan.monthly_payment,\n        )\n        if acc_months:\n            accelerated_months = acc_months\n            accelerated_total_interest = acc_interest\n            if acc_interest is not None:\n                accelerated_interest_savings = new_loan.total_interest - acc_interest\n            accelerated_time_savings_months = new_loan.num_payments - acc_months\n\n    # Total cost NPV calculations\n    current_total_cost_npv = (\n        calculate_total_cost_npv(\n            current_balance,\n            current_rate,\n            current_remaining_years,\n            opportunity_rate,\n        )\n        + closing_costs\n    )  # Include closing costs in current scenario as sunk cost comparison\n\n    if maintain_payment and current_loan.monthly_payment &gt; new_loan.monthly_payment:\n        new_total_cost_npv = calculate_total_cost_npv(\n            new_balance,\n            new_rate,\n            new_term_years,\n            opportunity_rate,\n            payment_override=current_loan.monthly_payment,\n        )\n    else:\n        new_total_cost_npv = calculate_total_cost_npv(\n            new_balance,\n            new_rate,\n            new_term_years,\n            opportunity_rate,\n        )\n\n    # Positive = refinancing is cheaper in NPV terms\n    total_cost_npv_advantage = current_total_cost_npv - new_total_cost_npv - closing_costs\n\n    return RefinanceAnalysis(\n        current_payment=current_loan.monthly_payment,\n        new_payment=new_loan.monthly_payment,\n        monthly_savings=monthly_savings,\n        simple_breakeven_months=simple_breakeven,\n        npv_breakeven_months=npv_breakeven,\n        current_total_interest=current_loan.total_interest,\n        new_total_interest=new_loan.total_interest,\n        interest_delta=new_loan.total_interest - current_loan.total_interest,\n        five_year_npv=window_npv,\n        cumulative_savings=cumulative_savings,\n        current_after_tax_payment=current_after_tax_payment,\n        new_after_tax_payment=new_after_tax_payment,\n        after_tax_monthly_savings=after_tax_monthly_savings,\n        after_tax_simple_breakeven_months=after_tax_simple_breakeven,\n        after_tax_npv_breakeven_months=after_tax_npv_breakeven,\n        after_tax_npv=after_tax_npv,\n        current_after_tax_total_interest=current_after_tax_total_interest,\n        new_after_tax_total_interest=new_after_tax_total_interest,\n        after_tax_interest_delta=new_after_tax_total_interest - current_after_tax_total_interest,\n        new_loan_balance=new_balance,\n        cash_out_amount=cash_out,\n        accelerated_months=accelerated_months,\n        accelerated_total_interest=accelerated_total_interest,\n        accelerated_interest_savings=accelerated_interest_savings,\n        accelerated_time_savings_months=accelerated_time_savings_months,\n        current_total_cost_npv=current_total_cost_npv,\n        new_total_cost_npv=new_total_cost_npv,\n        total_cost_npv_advantage=total_cost_npv_advantage,\n    )\n</code></pre>"},{"location":"reference/refi_calculator/core/calculations/#refi_calculator.core.calculations.calculate_accelerated_payoff","title":"<code>calculate_accelerated_payoff(balance, rate, payment)</code>","text":"<p>Calculate months to payoff and total interest when paying more than minimum.</p> <p>Parameters:</p> Name Type Description Default <code>balance</code> <code>float</code> <p>Loan balance</p> required <code>rate</code> <code>float</code> <p>Annual interest rate (as a decimal)</p> required <code>payment</code> <code>float</code> <p>Monthly payment amount</p> required <p>Returns:</p> Type Description <code>tuple[int | None, float | None]</code> <p>Tuple of (months to payoff, total interest paid)</p> Source code in <code>src/refi_calculator/core/calculations.py</code> <pre><code>def calculate_accelerated_payoff(\n    balance: float,\n    rate: float,\n    payment: float,\n) -&gt; tuple[int | None, float | None]:\n    \"\"\"Calculate months to payoff and total interest when paying more than minimum.\n\n    Args:\n        balance: Loan balance\n        rate: Annual interest rate (as a decimal)\n        payment: Monthly payment amount\n\n    Returns:\n        Tuple of (months to payoff, total interest paid)\n    \"\"\"\n    if rate == 0:\n        months = int(balance / payment) + 1\n        return months, 0.0\n\n    monthly_rate = rate / 12\n    months = 0\n    total_interest = 0.0\n    remaining = balance\n\n    min_term_in_months = 0\n    max_term_in_months = 50 * 12  # Cap at 50 years\n    while remaining &gt; min_term_in_months and months &lt; max_term_in_months:\n        interest = remaining * monthly_rate\n        principal = min(payment - interest, remaining)\n        if principal &lt;= 0:  # Payment doesn't cover interest - would never pay off\n            return None, None\n        remaining -= principal\n        total_interest += interest\n        months += 1\n\n    return months, total_interest\n</code></pre>"},{"location":"reference/refi_calculator/core/calculations/#refi_calculator.core.calculations.calculate_total_cost_npv","title":"<code>calculate_total_cost_npv(balance, rate, term_years, opportunity_rate, payment_override=None)</code>","text":"<p>Calculate NPV of total loan cost (all payments discounted to present).</p> <p>Parameters:</p> Name Type Description Default <code>balance</code> <code>float</code> <p>Loan balance</p> required <code>rate</code> <code>float</code> <p>Annual interest rate (as a decimal)</p> required <code>term_years</code> <code>float</code> <p>Loan term in years</p> required <code>opportunity_rate</code> <code>float</code> <p>Annual opportunity cost rate (as a decimal)</p> required <code>payment_override</code> <code>float | None</code> <p>Optional monthly payment to use instead of standard</p> <code>None</code> <p>Returns:</p> Type Description <code>float</code> <p>NPV of total loan cost</p> Source code in <code>src/refi_calculator/core/calculations.py</code> <pre><code>def calculate_total_cost_npv(\n    balance: float,\n    rate: float,\n    term_years: float,\n    opportunity_rate: float,\n    payment_override: float | None = None,\n) -&gt; float:\n    \"\"\"Calculate NPV of total loan cost (all payments discounted to present).\n\n    Args:\n        balance: Loan balance\n        rate: Annual interest rate (as a decimal)\n        term_years: Loan term in years\n        opportunity_rate: Annual opportunity cost rate (as a decimal)\n        payment_override: Optional monthly payment to use instead of standard\n\n    Returns:\n        NPV of total loan cost\n    \"\"\"\n    loan = LoanParams(\n        balance=balance,\n        rate=rate,\n        term_years=term_years,\n    )\n    payment = payment_override if payment_override else loan.monthly_payment\n    monthly_opp_rate = opportunity_rate / 12\n\n    if payment_override and payment_override &gt; loan.monthly_payment:\n        # Accelerated payoff\n        months, _ = calculate_accelerated_payoff(\n            balance=balance,\n            rate=rate,\n            payment=payment_override,\n        )\n        if months is None:\n            months = loan.num_payments\n    else:\n        months = loan.num_payments\n\n    npv = 0.0\n    remaining = balance\n    monthly_rate = rate / 12\n\n    for month in range(1, months + 1):\n        if remaining &lt;= 0:\n            break\n        interest = remaining * monthly_rate\n        actual_payment = min(payment, remaining + interest)\n        principal = actual_payment - interest\n        remaining -= principal\n        npv += actual_payment / ((1 + monthly_opp_rate) ** month)\n\n    return npv\n</code></pre>"},{"location":"reference/refi_calculator/core/calculations/#refi_calculator.core.calculations.generate_amortization_schedule","title":"<code>generate_amortization_schedule(loan, label)</code>","text":"<p>Generate Amortization Schedule.</p> <p>Parameters:</p> Name Type Description Default <code>loan</code> <code>LoanParams</code> <p>LoanParams object</p> required <code>label</code> <code>str</code> <p>Label for the loan (e.g., \"Current\" or \"New\")</p> required <p>Returns:</p> Type Description <code>list[dict]</code> <p>List of dictionaries with amortization schedule details. Each dictionary contains: - loan: Loan label - month: Month number - year: Year number - payment: Monthly payment amount - principal: Principal portion of payment - interest: Interest portion of payment - balance: Remaining balance after payment</p> Source code in <code>src/refi_calculator/core/calculations.py</code> <pre><code>def generate_amortization_schedule(\n    loan: LoanParams,\n    label: str,\n) -&gt; list[dict]:\n    \"\"\"Generate Amortization Schedule.\n\n    Args:\n        loan: LoanParams object\n        label: Label for the loan (e.g., \"Current\" or \"New\")\n\n    Returns:\n        List of dictionaries with amortization schedule details. Each dictionary contains:\n            - loan: Loan label\n            - month: Month number\n            - year: Year number\n            - payment: Monthly payment amount\n            - principal: Principal portion of payment\n            - interest: Interest portion of payment\n            - balance: Remaining balance after payment\n    \"\"\"\n    schedule = []\n    balance = loan.balance\n    monthly_payment = loan.monthly_payment\n    monthly_rate = loan.monthly_rate\n\n    for month in range(1, loan.num_payments + 1):\n        interest_payment = balance * monthly_rate\n        principal_payment = monthly_payment - interest_payment\n        balance -= principal_payment\n        if balance &lt; 0:\n            principal_payment += balance\n            balance = 0\n        schedule.append(\n            {\n                \"loan\": label,\n                \"month\": month,\n                \"year\": (month - 1) // 12 + 1,\n                \"payment\": monthly_payment,\n                \"principal\": principal_payment,\n                \"interest\": interest_payment,\n                \"balance\": max(0, balance),\n            },\n        )\n    return schedule\n</code></pre>"},{"location":"reference/refi_calculator/core/calculations/#refi_calculator.core.calculations.generate_amortization_schedule_pair","title":"<code>generate_amortization_schedule_pair(current_balance, current_rate, current_remaining_years, new_rate, new_term_years, closing_costs, cash_out=0.0, maintain_payment=False)</code>","text":"<p>Produce monthly amortization schedules for the current and new loans.</p> <p>Parameters:</p> Name Type Description Default <code>current_balance</code> <code>float</code> <p>Current loan balance.</p> required <code>current_rate</code> <code>float</code> <p>Current loan interest rate (as a decimal).</p> required <code>current_remaining_years</code> <code>float</code> <p>Remaining term of the current loan.</p> required <code>new_rate</code> <code>float</code> <p>Proposed refinance rate (as a decimal).</p> required <code>new_term_years</code> <code>float</code> <p>Term for the new loan.</p> required <code>closing_costs</code> <code>float</code> <p>Closing cost amount for the refinance.</p> required <code>cash_out</code> <code>float</code> <p>Cash out amount applied to the refinance.</p> <code>0.0</code> <code>maintain_payment</code> <code>bool</code> <p>Whether the new loan should use the current payment.</p> <code>False</code> <p>Returns:</p> Type Description <code>list[dict]</code> <p>Tuple of (current_schedule, new_schedule), where each schedule is a list of</p> <code>list[dict]</code> <p>monthly dictionaries matching the structure produced by <code>generate_amortization_schedule</code>.</p> Source code in <code>src/refi_calculator/core/calculations.py</code> <pre><code>def generate_amortization_schedule_pair(\n    current_balance: float,\n    current_rate: float,\n    current_remaining_years: float,\n    new_rate: float,\n    new_term_years: float,\n    closing_costs: float,\n    cash_out: float = 0.0,\n    maintain_payment: bool = False,\n) -&gt; tuple[list[dict], list[dict]]:\n    \"\"\"Produce monthly amortization schedules for the current and new loans.\n\n    Args:\n        current_balance: Current loan balance.\n        current_rate: Current loan interest rate (as a decimal).\n        current_remaining_years: Remaining term of the current loan.\n        new_rate: Proposed refinance rate (as a decimal).\n        new_term_years: Term for the new loan.\n        closing_costs: Closing cost amount for the refinance.\n        cash_out: Cash out amount applied to the refinance.\n        maintain_payment: Whether the new loan should use the current payment.\n\n    Returns:\n        Tuple of (current_schedule, new_schedule), where each schedule is a list of\n        monthly dictionaries matching the structure produced by ``generate_amortization_schedule``.\n    \"\"\"\n    current_loan = LoanParams(current_balance, current_rate, current_remaining_years)\n    new_balance = current_balance + closing_costs + cash_out\n    new_loan = LoanParams(new_balance, new_rate, new_term_years)\n\n    current_schedule = generate_amortization_schedule(current_loan, \"Current\")\n\n    if maintain_payment and current_loan.monthly_payment &gt; new_loan.monthly_payment:\n        schedule: list[dict] = []\n        balance = new_balance\n        monthly_payment = current_loan.monthly_payment\n        monthly_rate = new_rate / 12\n\n        month = 0\n        max_months = 600\n        while balance &gt; 0 and month &lt; max_months:\n            month += 1\n            interest_payment = balance * monthly_rate\n            principal_payment = monthly_payment - interest_payment\n            balance -= principal_payment\n            if balance &lt; 0:\n                principal_payment += balance\n                balance = 0\n            schedule.append(\n                {\n                    \"loan\": \"New\",\n                    \"month\": month,\n                    \"year\": (month - 1) // 12 + 1,\n                    \"payment\": monthly_payment,\n                    \"principal\": principal_payment,\n                    \"interest\": interest_payment,\n                    \"balance\": max(0, balance),\n                },\n            )\n        new_schedule = schedule\n    else:\n        new_schedule = generate_amortization_schedule(new_loan, \"New\")\n\n    return current_schedule, new_schedule\n</code></pre>"},{"location":"reference/refi_calculator/core/calculations/#refi_calculator.core.calculations.generate_comparison_schedule","title":"<code>generate_comparison_schedule(current_balance, current_rate, current_remaining_years, new_rate, new_term_years, closing_costs, cash_out=0.0, maintain_payment=False)</code>","text":"<p>Generate Comparison Amortization Schedule between current and new loan.</p> <p>Parameters:</p> Name Type Description Default <code>current_balance</code> <code>float</code> <p>Current loan balance</p> required <code>current_rate</code> <code>float</code> <p>Current loan interest rate (as a decimal)</p> required <code>current_remaining_years</code> <code>float</code> <p>Current loan remaining term in years</p> required <code>new_rate</code> <code>float</code> <p>New loan interest rate (as a decimal)</p> required <code>new_term_years</code> <code>float</code> <p>New loan term in years</p> required <code>closing_costs</code> <code>float</code> <p>Closing costs for refinance</p> required <code>cash_out</code> <code>float</code> <p>Cash out amount from refinance. Default is 0.</p> <code>0.0</code> <code>maintain_payment</code> <code>bool</code> <p>Whether to maintain current payment amount. Default is False.</p> <code>False</code> <p>Returns:</p> Type Description <code>list[dict]</code> <p>List of dictionaries comparing current and new loan amortization schedules by year.</p> <code>list[dict]</code> <p>Each dictionary contains: - year: Year number - current_principal: Total principal paid in current loan that year - current_interest: Total interest paid in current loan that year - current_balance: Remaining balance on current loan at year end - new_principal: Total principal paid in new loan that year - new_interest: Total interest paid in new loan that year - new_balance: Remaining balance on new loan at year end - principal_diff: Difference in principal paid (new - current) - interest_diff: Difference in interest paid (new - current) - balance_diff: Difference in balance (new - current)</p> Source code in <code>src/refi_calculator/core/calculations.py</code> <pre><code>def generate_comparison_schedule(\n    current_balance: float,\n    current_rate: float,\n    current_remaining_years: float,\n    new_rate: float,\n    new_term_years: float,\n    closing_costs: float,\n    cash_out: float = 0.0,\n    maintain_payment: bool = False,\n) -&gt; list[dict]:\n    \"\"\"Generate Comparison Amortization Schedule between current and new loan.\n\n    Args:\n        current_balance: Current loan balance\n        current_rate: Current loan interest rate (as a decimal)\n        current_remaining_years: Current loan remaining term in years\n        new_rate: New loan interest rate (as a decimal)\n        new_term_years: New loan term in years\n        closing_costs: Closing costs for refinance\n        cash_out: Cash out amount from refinance. Default is 0.\n        maintain_payment: Whether to maintain current payment amount. Default is False.\n\n    Returns:\n        List of dictionaries comparing current and new loan amortization schedules by year.\n        Each dictionary contains:\n            - year: Year number\n            - current_principal: Total principal paid in current loan that year\n            - current_interest: Total interest paid in current loan that year\n            - current_balance: Remaining balance on current loan at year end\n            - new_principal: Total principal paid in new loan that year\n            - new_interest: Total interest paid in new loan that year\n            - new_balance: Remaining balance on new loan at year end\n            - principal_diff: Difference in principal paid (new - current)\n            - interest_diff: Difference in interest paid (new - current)\n            - balance_diff: Difference in balance (new - current)\n    \"\"\"\n    current_schedule, new_schedule = generate_amortization_schedule_pair(\n        current_balance=current_balance,\n        current_rate=current_rate,\n        current_remaining_years=current_remaining_years,\n        new_rate=new_rate,\n        new_term_years=new_term_years,\n        closing_costs=closing_costs,\n        cash_out=cash_out,\n        maintain_payment=maintain_payment,\n    )\n\n    # Determine the number of years to show based on the actual schedules\n    max_years = max(\n        max((s[\"year\"] for s in current_schedule), default=0),\n        max((s[\"year\"] for s in new_schedule), default=0),\n    )\n    comparison = []\n\n    for year in range(1, max_years + 1):\n        current_year_data = [s for s in current_schedule if s[\"year\"] == year]\n        new_year_data = [s for s in new_schedule if s[\"year\"] == year]\n\n        current_principal = sum(s[\"principal\"] for s in current_year_data)\n        current_interest = sum(s[\"interest\"] for s in current_year_data)\n        current_end_balance = current_year_data[-1][\"balance\"] if current_year_data else 0\n\n        new_principal = sum(s[\"principal\"] for s in new_year_data)\n        new_interest = sum(s[\"interest\"] for s in new_year_data)\n        new_end_balance = new_year_data[-1][\"balance\"] if new_year_data else 0\n\n        comparison.append(\n            {\n                \"year\": year,\n                \"current_principal\": current_principal,\n                \"current_interest\": current_interest,\n                \"current_balance\": current_end_balance,\n                \"new_principal\": new_principal,\n                \"new_interest\": new_interest,\n                \"new_balance\": new_end_balance,\n                \"principal_diff\": new_principal - current_principal,\n                \"interest_diff\": new_interest - current_interest,\n                \"balance_diff\": new_end_balance - current_end_balance,\n            },\n        )\n    return comparison\n</code></pre>"},{"location":"reference/refi_calculator/core/calculations/#refi_calculator.core.calculations.run_holding_period_analysis","title":"<code>run_holding_period_analysis(current_balance, current_rate, current_remaining_years, new_rate, new_term_years, closing_costs, opportunity_rate, marginal_tax_rate, holding_periods, cash_out=0.0)</code>","text":"<p>Run holding period analysis for various time frames.</p> <p>Parameters:</p> Name Type Description Default <code>current_balance</code> <code>float</code> <p>Current loan balance</p> required <code>current_rate</code> <code>float</code> <p>Current loan interest rate (as a decimal)</p> required <code>current_remaining_years</code> <code>float</code> <p>Current loan remaining term in years</p> required <code>new_rate</code> <code>float</code> <p>New loan interest rate (as a decimal)</p> required <code>new_term_years</code> <code>float</code> <p>New loan term in years</p> required <code>closing_costs</code> <code>float</code> <p>Closing costs for refinance</p> required <code>opportunity_rate</code> <code>float</code> <p>Opportunity cost rate (as a decimal)</p> required <code>marginal_tax_rate</code> <code>float</code> <p>Marginal tax rate (as a decimal)</p> required <code>holding_periods</code> <code>list[int]</code> <p>List of holding periods in years to analyze</p> required <code>cash_out</code> <code>float</code> <p>Cash out amount from refinance. Default is 0.</p> <code>0.0</code> <p>Returns:</p> Type Description <code>list[dict]</code> <p>List of dictionaries with analysis results for each holding period.</p> <code>list[dict]</code> <p>Each dictionary contains: - years: Holding period in years - nominal_savings: Nominal savings over holding period - npv: NPV of savings over holding period - npv_after_tax: NPV of savings after tax adjustment - recommendation: Recommendation string based on NPV</p> Source code in <code>src/refi_calculator/core/calculations.py</code> <pre><code>def run_holding_period_analysis(\n    current_balance: float,\n    current_rate: float,\n    current_remaining_years: float,\n    new_rate: float,\n    new_term_years: float,\n    closing_costs: float,\n    opportunity_rate: float,\n    marginal_tax_rate: float,\n    holding_periods: list[int],\n    cash_out: float = 0.0,\n) -&gt; list[dict]:\n    \"\"\"Run holding period analysis for various time frames.\n\n    Args:\n        current_balance: Current loan balance\n        current_rate: Current loan interest rate (as a decimal)\n        current_remaining_years: Current loan remaining term in years\n        new_rate: New loan interest rate (as a decimal)\n        new_term_years: New loan term in years\n        closing_costs: Closing costs for refinance\n        opportunity_rate: Opportunity cost rate (as a decimal)\n        marginal_tax_rate: Marginal tax rate (as a decimal)\n        holding_periods: List of holding periods in years to analyze\n        cash_out: Cash out amount from refinance. Default is 0.\n\n    Returns:\n        List of dictionaries with analysis results for each holding period.\n        Each dictionary contains:\n            - years: Holding period in years\n            - nominal_savings: Nominal savings over holding period\n            - npv: NPV of savings over holding period\n            - npv_after_tax: NPV of savings after tax adjustment\n            - recommendation: Recommendation string based on NPV\n    \"\"\"\n    results = []\n    current_loan = LoanParams(current_balance, current_rate, current_remaining_years)\n    new_balance = current_balance + closing_costs + cash_out\n    new_loan = LoanParams(new_balance, new_rate, new_term_years)\n\n    monthly_savings = current_loan.monthly_payment - new_loan.monthly_payment\n    monthly_opp_rate = opportunity_rate / 12\n\n    current_avg_monthly_interest = current_loan.total_interest / current_loan.num_payments\n    new_avg_monthly_interest = new_loan.total_interest / new_loan.num_payments\n    current_monthly_tax_benefit = current_avg_monthly_interest * marginal_tax_rate\n    new_monthly_tax_benefit = new_avg_monthly_interest * marginal_tax_rate\n    after_tax_monthly_savings = (current_loan.monthly_payment - current_monthly_tax_benefit) - (\n        new_loan.monthly_payment - new_monthly_tax_benefit\n    )\n\n    for years in holding_periods:\n        months = years * 12\n        nominal_savings = (monthly_savings * months) - closing_costs\n        npv = -closing_costs\n        for m in range(1, months + 1):\n            npv += monthly_savings / ((1 + monthly_opp_rate) ** m)\n        npv_after_tax = -closing_costs\n        for m in range(1, months + 1):\n            npv_after_tax += after_tax_monthly_savings / ((1 + monthly_opp_rate) ** m)\n\n        strong_yes_threshold = 5000\n        yes_threshold = 0\n        marginal_threshold = -2000\n        if npv &gt; strong_yes_threshold:\n            recommendation = \"Strong Yes\"\n        elif npv &gt; yes_threshold:\n            recommendation = \"Yes\"\n        elif npv &gt; -marginal_threshold:\n            recommendation = \"Marginal\"\n        else:\n            recommendation = \"No\"\n\n        results.append(\n            {\n                \"years\": years,\n                \"nominal_savings\": nominal_savings,\n                \"npv\": npv,\n                \"npv_after_tax\": npv_after_tax,\n                \"recommendation\": recommendation,\n            },\n        )\n    return results\n</code></pre>"},{"location":"reference/refi_calculator/core/calculations/#refi_calculator.core.calculations.run_sensitivity","title":"<code>run_sensitivity(current_balance, current_rate, current_remaining_years, new_term_years, closing_costs, opportunity_rate, rate_steps, npv_window_years=5)</code>","text":"<p>Run sensitivity analysis over a range of new interest rates.</p> <p>Parameters:</p> Name Type Description Default <code>current_balance</code> <code>float</code> <p>Current loan balance</p> required <code>current_rate</code> <code>float</code> <p>Current loan interest rate (as a decimal)</p> required <code>current_remaining_years</code> <code>float</code> <p>Current loan remaining term in years</p> required <code>new_term_years</code> <code>float</code> <p>New loan term in years</p> required <code>closing_costs</code> <code>float</code> <p>Closing costs for refinance</p> required <code>opportunity_rate</code> <code>float</code> <p>Opportunity cost rate (as a decimal)</p> required <code>rate_steps</code> <code>list[float]</code> <p>List of new interest rates (as decimals) to analyze</p> required <code>npv_window_years</code> <code>int</code> <p>Years to calculate NPV over. Default is 5 years.</p> <code>5</code> <p>Returns:</p> Type Description <code>list[dict]</code> <p>List of dictionaries with sensitivity analysis results for each new rate.</p> <code>list[dict]</code> <p>Each dictionary contains: - new_rate: New interest rate (as a percentage) - monthly_savings: Monthly savings from refinancing - simple_be: Months to simple breakeven - npv_be: Months to NPV breakeven - five_yr_npv: NPV of savings over 5 years</p> Source code in <code>src/refi_calculator/core/calculations.py</code> <pre><code>def run_sensitivity(\n    current_balance: float,\n    current_rate: float,\n    current_remaining_years: float,\n    new_term_years: float,\n    closing_costs: float,\n    opportunity_rate: float,\n    rate_steps: list[float],\n    npv_window_years: int = 5,\n) -&gt; list[dict]:\n    \"\"\"Run sensitivity analysis over a range of new interest rates.\n\n    Args:\n        current_balance: Current loan balance\n        current_rate: Current loan interest rate (as a decimal)\n        current_remaining_years: Current loan remaining term in years\n        new_term_years: New loan term in years\n        closing_costs: Closing costs for refinance\n        opportunity_rate: Opportunity cost rate (as a decimal)\n        rate_steps: List of new interest rates (as decimals) to analyze\n        npv_window_years: Years to calculate NPV over. Default is 5 years.\n\n    Returns:\n        List of dictionaries with sensitivity analysis results for each new rate.\n        Each dictionary contains:\n            - new_rate: New interest rate (as a percentage)\n            - monthly_savings: Monthly savings from refinancing\n            - simple_be: Months to simple breakeven\n            - npv_be: Months to NPV breakeven\n            - five_yr_npv: NPV of savings over 5 years\n    \"\"\"\n    results = []\n    for new_rate in rate_steps:\n        a = analyze_refinance(\n            current_balance,\n            current_rate,\n            current_remaining_years,\n            new_rate,\n            new_term_years,\n            closing_costs,\n            opportunity_rate,\n            npv_window_years=npv_window_years,\n        )\n        results.append(\n            {\n                \"new_rate\": new_rate * 100,\n                \"monthly_savings\": a.monthly_savings,\n                \"simple_be\": a.simple_breakeven_months,\n                \"npv_be\": a.npv_breakeven_months,\n                \"five_yr_npv\": a.five_year_npv,\n            },\n        )\n    return results\n</code></pre>"},{"location":"reference/refi_calculator/core/charts/","title":"charts","text":"<p>Shared chart helper utilities for refinance visualizations.</p>"},{"location":"reference/refi_calculator/core/charts/#refi_calculator.core.charts.build_linear_ticks","title":"<code>build_linear_ticks(min_value, max_value, max_ticks=5)</code>","text":"<p>Generate evenly spaced linear axis tick values.</p> <p>Parameters:</p> Name Type Description Default <code>min_value</code> <code>float</code> <p>Minimum value to include on the axis.</p> required <code>max_value</code> <code>float</code> <p>Maximum value to include on the axis.</p> required <code>max_ticks</code> <code>int</code> <p>Maximum number of ticks to produce.</p> <code>5</code> <p>Returns:</p> Type Description <code>list[float]</code> <p>A list of axis values covering the requested range.</p> Source code in <code>src/refi_calculator/core/charts.py</code> <pre><code>def build_linear_ticks(min_value: float, max_value: float, max_ticks: int = 5) -&gt; list[float]:\n    \"\"\"Generate evenly spaced linear axis tick values.\n\n    Args:\n        min_value: Minimum value to include on the axis.\n        max_value: Maximum value to include on the axis.\n        max_ticks: Maximum number of ticks to produce.\n\n    Returns:\n        A list of axis values covering the requested range.\n    \"\"\"\n    if max_ticks &lt; MIN_LINEAR_TICKS:\n        return [min_value, max_value]\n\n    span = max_value - min_value\n    if span == 0:\n        expansion = abs(max_value) or 1.0\n        min_value -= expansion / 2\n        max_value += expansion / 2\n        span = max_value - min_value\n\n    step = span / (max_ticks - 1)\n    ticks = [min_value + step * i for i in range(max_ticks)]\n    ticks[-1] = max_value\n    return ticks\n</code></pre>"},{"location":"reference/refi_calculator/core/charts/#refi_calculator.core.charts.build_month_ticks","title":"<code>build_month_ticks(max_month, max_ticks=6)</code>","text":"<p>Generate tick positions for month-based axes.</p> <p>Parameters:</p> Name Type Description Default <code>max_month</code> <code>int</code> <p>Latest month number to display on the axis.</p> required <code>max_ticks</code> <code>int</code> <p>Maximum number of tick marks to emit.</p> <code>6</code> <p>Returns:</p> Type Description <code>list[int]</code> <p>A list of month values to use for axis ticks.</p> Source code in <code>src/refi_calculator/core/charts.py</code> <pre><code>def build_month_ticks(max_month: int, max_ticks: int = 6) -&gt; list[int]:\n    \"\"\"Generate tick positions for month-based axes.\n\n    Args:\n        max_month: Latest month number to display on the axis.\n        max_ticks: Maximum number of tick marks to emit.\n\n    Returns:\n        A list of month values to use for axis ticks.\n    \"\"\"\n    if max_month &lt;= 0:\n        return [0]\n\n    tick_count = min(max_ticks, max_month + 1)\n    if tick_count &lt;= 1:\n        return [max_month]\n\n    interval = max_month / (tick_count - 1)\n    ticks: list[int] = []\n    last = -1\n    for i in range(tick_count):\n        tick = int(round(i * interval))\n        if tick &lt;= last:\n            tick = last + 1\n        tick = min(max_month, tick)\n        ticks.append(tick)\n        last = tick\n\n    if ticks[-1] != max_month:\n        ticks[-1] = max_month\n\n    return ticks\n</code></pre>"},{"location":"reference/refi_calculator/core/models/","title":"models","text":"<p>Loan and analysis data models.</p>"},{"location":"reference/refi_calculator/core/models/#refi_calculator.core.models.LoanParams","title":"<code>LoanParams</code>  <code>dataclass</code>","text":"<p>Parameters for a mortgage loan.</p> <p>Attributes:</p> Name Type Description <code>balance</code> <code>float</code> <p>Loan balance.</p> <code>rate</code> <code>float</code> <p>Annual interest rate as a decimal.</p> <code>term_years</code> <code>float</code> <p>Loan term in years.</p> Source code in <code>src/refi_calculator/core/models.py</code> <pre><code>@dataclass\nclass LoanParams:\n    \"\"\"Parameters for a mortgage loan.\n\n    Attributes:\n        balance: Loan balance.\n        rate: Annual interest rate as a decimal.\n        term_years: Loan term in years.\n    \"\"\"\n\n    balance: float\n    rate: float\n    term_years: float\n\n    @property\n    def monthly_rate(self) -&gt; float:\n        \"\"\"Monthly interest rate.\n\n        Returns:\n            Monthly interest rate as a decimal.\n        \"\"\"\n        return self.rate / 12\n\n    @property\n    def num_payments(self) -&gt; int:\n        \"\"\"Total number of monthly payments.\n\n        Returns:\n            Total number of payments.\n        \"\"\"\n        return int(self.term_years * 12)\n\n    @property\n    def monthly_payment(self) -&gt; float:\n        \"\"\"Monthly payment using the standard amortization formula.\n\n        Returns:\n            Monthly payment amount.\n        \"\"\"\n        r = self.monthly_rate\n        n = self.num_payments\n        if r == 0:\n            return self.balance / n\n        return self.balance * (r * (1 + r) ** n) / ((1 + r) ** n - 1)\n\n    @property\n    def total_interest(self) -&gt; float:\n        \"\"\"Total interest paid over the life of the loan.\"\"\"\n        return (self.monthly_payment * self.num_payments) - self.balance\n</code></pre>"},{"location":"reference/refi_calculator/core/models/#refi_calculator.core.models.LoanParams.monthly_payment","title":"<code>monthly_payment</code>  <code>property</code>","text":"<p>Monthly payment using the standard amortization formula.</p> <p>Returns:</p> Type Description <code>float</code> <p>Monthly payment amount.</p>"},{"location":"reference/refi_calculator/core/models/#refi_calculator.core.models.LoanParams.monthly_rate","title":"<code>monthly_rate</code>  <code>property</code>","text":"<p>Monthly interest rate.</p> <p>Returns:</p> Type Description <code>float</code> <p>Monthly interest rate as a decimal.</p>"},{"location":"reference/refi_calculator/core/models/#refi_calculator.core.models.LoanParams.num_payments","title":"<code>num_payments</code>  <code>property</code>","text":"<p>Total number of monthly payments.</p> <p>Returns:</p> Type Description <code>int</code> <p>Total number of payments.</p>"},{"location":"reference/refi_calculator/core/models/#refi_calculator.core.models.LoanParams.total_interest","title":"<code>total_interest</code>  <code>property</code>","text":"<p>Total interest paid over the life of the loan.</p>"},{"location":"reference/refi_calculator/core/models/#refi_calculator.core.models.RefinanceAnalysis","title":"<code>RefinanceAnalysis</code>  <code>dataclass</code>","text":"<p>Results of refinance breakeven analysis.</p> <p>Attributes:</p> Name Type Description <code>current_payment</code> <code>float</code> <p>Current monthly payment.</p> <code>new_payment</code> <code>float</code> <p>New monthly payment.</p> <code>monthly_savings</code> <code>float</code> <p>Monthly savings from refinancing.</p> <code>simple_breakeven_months</code> <code>float | None</code> <p>Months to simple breakeven (nominal).</p> <code>npv_breakeven_months</code> <code>int | None</code> <p>Months to NPV breakeven.</p> <code>current_total_interest</code> <code>float</code> <p>Total interest of the current loan.</p> <code>new_total_interest</code> <code>float</code> <p>Total interest of the new loan.</p> <code>interest_delta</code> <code>float</code> <p>Interest difference between new and current loans.</p> <code>five_year_npv</code> <code>float</code> <p>NPV of savings over five years.</p> <code>cumulative_savings</code> <code>list[tuple[int, float, float]]</code> <p>Cumulative savings timeline.</p> <code>current_after_tax_payment</code> <code>float</code> <p>Current payment after tax benefit.</p> <code>new_after_tax_payment</code> <code>float</code> <p>New payment after tax benefit.</p> <code>after_tax_monthly_savings</code> <code>float</code> <p>After-tax monthly savings.</p> <code>after_tax_simple_breakeven_months</code> <code>float | None</code> <p>After-tax simple breakeven.</p> <code>after_tax_npv_breakeven_months</code> <code>int | None</code> <p>After-tax NPV breakeven.</p> <code>after_tax_npv</code> <code>float</code> <p>After-tax NPV of savings.</p> <code>current_after_tax_total_interest</code> <code>float</code> <p>Current loan interest after tax.</p> <code>new_after_tax_total_interest</code> <code>float</code> <p>New loan interest after tax.</p> <code>after_tax_interest_delta</code> <code>float</code> <p>Interest delta after tax.</p> <code>new_loan_balance</code> <code>float</code> <p>Balance of the new loan.</p> <code>cash_out_amount</code> <code>float</code> <p>Cash out amount included in the refinance.</p> <code>accelerated_months</code> <code>int | None</code> <p>Months to payoff when maintaining payment.</p> <code>accelerated_total_interest</code> <code>float | None</code> <p>Total interest when accelerating payoff.</p> <code>accelerated_interest_savings</code> <code>float | None</code> <p>Interest savings from acceleration.</p> <code>accelerated_time_savings_months</code> <code>int | None</code> <p>Months saved by accelerating payoff.</p> <code>current_total_cost_npv</code> <code>float</code> <p>NPV of the current loan total cost.</p> <code>new_total_cost_npv</code> <code>float</code> <p>NPV of the new loan total cost.</p> <code>total_cost_npv_advantage</code> <code>float</code> <p>NPV advantage of refinancing.</p> Source code in <code>src/refi_calculator/core/models.py</code> <pre><code>@dataclass\nclass RefinanceAnalysis:\n    \"\"\"Results of refinance breakeven analysis.\n\n    Attributes:\n        current_payment: Current monthly payment.\n        new_payment: New monthly payment.\n        monthly_savings: Monthly savings from refinancing.\n        simple_breakeven_months: Months to simple breakeven (nominal).\n        npv_breakeven_months: Months to NPV breakeven.\n        current_total_interest: Total interest of the current loan.\n        new_total_interest: Total interest of the new loan.\n        interest_delta: Interest difference between new and current loans.\n        five_year_npv: NPV of savings over five years.\n        cumulative_savings: Cumulative savings timeline.\n        current_after_tax_payment: Current payment after tax benefit.\n        new_after_tax_payment: New payment after tax benefit.\n        after_tax_monthly_savings: After-tax monthly savings.\n        after_tax_simple_breakeven_months: After-tax simple breakeven.\n        after_tax_npv_breakeven_months: After-tax NPV breakeven.\n        after_tax_npv: After-tax NPV of savings.\n        current_after_tax_total_interest: Current loan interest after tax.\n        new_after_tax_total_interest: New loan interest after tax.\n        after_tax_interest_delta: Interest delta after tax.\n        new_loan_balance: Balance of the new loan.\n        cash_out_amount: Cash out amount included in the refinance.\n        accelerated_months: Months to payoff when maintaining payment.\n        accelerated_total_interest: Total interest when accelerating payoff.\n        accelerated_interest_savings: Interest savings from acceleration.\n        accelerated_time_savings_months: Months saved by accelerating payoff.\n        current_total_cost_npv: NPV of the current loan total cost.\n        new_total_cost_npv: NPV of the new loan total cost.\n        total_cost_npv_advantage: NPV advantage of refinancing.\n    \"\"\"\n\n    current_payment: float\n    new_payment: float\n    monthly_savings: float\n    simple_breakeven_months: float | None\n    npv_breakeven_months: int | None\n    current_total_interest: float\n    new_total_interest: float\n    interest_delta: float\n    five_year_npv: float\n    cumulative_savings: list[tuple[int, float, float]]\n    current_after_tax_payment: float\n    new_after_tax_payment: float\n    after_tax_monthly_savings: float\n    after_tax_simple_breakeven_months: float | None\n    after_tax_npv_breakeven_months: int | None\n    after_tax_npv: float\n    current_after_tax_total_interest: float\n    new_after_tax_total_interest: float\n    after_tax_interest_delta: float\n    new_loan_balance: float\n    cash_out_amount: float\n    accelerated_months: int | None\n    accelerated_total_interest: float | None\n    accelerated_interest_savings: float | None\n    accelerated_time_savings_months: int | None\n    current_total_cost_npv: float\n    new_total_cost_npv: float\n    total_cost_npv_advantage: float\n</code></pre>"},{"location":"reference/refi_calculator/core/market/constants/","title":"constants","text":"<p>Constants for market data processing in the ReFi calculator.</p>"},{"location":"reference/refi_calculator/core/market/fred/","title":"fred","text":"<p>FRED API helpers for borrowing-rate data.</p>"},{"location":"reference/refi_calculator/core/market/fred/#refi_calculator.core.market.fred.fetch_fred_series","title":"<code>fetch_fred_series(series_id, api_key, limit=None)</code>","text":"<p>Fetch a stationary FRED series and return (date, value) pairs.</p> <p>Parameters:</p> Name Type Description Default <code>series_id</code> <code>str</code> <p>FRED series identifier (e.g., \"MORTGAGE30US\").</p> required <code>api_key</code> <code>str</code> <p>Your FRED API key.</p> required <code>limit</code> <code>int | None</code> <p>Maximum number of observations to fetch. Defaults to the service limit.</p> <code>None</code> <p>Returns:</p> Type Description <code>list[tuple[str, float]]</code> <p>Observations sorted newest-first, (date, float value).</p> Source code in <code>src/refi_calculator/core/market/fred.py</code> <pre><code>def fetch_fred_series(\n    series_id: str,\n    api_key: str,\n    limit: int | None = None,\n) -&gt; list[tuple[str, float]]:\n    \"\"\"Fetch a stationary FRED series and return (date, value) pairs.\n\n    Args:\n        series_id: FRED series identifier (e.g., \"MORTGAGE30US\").\n        api_key: Your FRED API key.\n        limit: Maximum number of observations to fetch. Defaults to the service limit.\n\n    Returns:\n        Observations sorted newest-first, (date, float value).\n    \"\"\"\n    params: dict[str, str] = {\n        \"series_id\": series_id,\n        \"api_key\": api_key,\n        \"file_type\": \"json\",\n        \"sort_order\": \"desc\",\n    }\n    if limit:\n        params[\"limit\"] = str(limit)\n\n    url = f\"https://api.stlouisfed.org/fred/series/observations?{urllib.parse.urlencode(params)}\"\n\n    try:\n        with urllib.request.urlopen(url, timeout=10) as resp:\n            payload = json.load(resp)\n    except (urllib.error.URLError, urllib.error.HTTPError, json.JSONDecodeError) as exc:\n        raise RuntimeError(\"Failed to fetch FRED series\") from exc\n\n    observations = payload.get(\"observations\", [])\n    results: list[tuple[str, float]] = []\n    for obs in observations:\n        date = obs.get(\"date\")\n        value = obs.get(\"value\")\n        if date is None or value is None or value == \".\":\n            continue\n        try:\n            parsed = float(value)\n        except ValueError:\n            continue\n        results.append((date, parsed))\n    return results\n</code></pre>"},{"location":"reference/refi_calculator/gui/app/","title":"app","text":"<p>Refinance breakeven GUI components.</p>"},{"location":"reference/refi_calculator/gui/app/#refi_calculator.gui.app.RefinanceCalculatorApp","title":"<code>RefinanceCalculatorApp</code>","text":"<p>Refinance Calculator Application.</p> <p>Attributes:</p> Name Type Description <code>root</code> <code>Tk</code> <p>Root Tkinter window</p> <code>current_analysis</code> <code>RefinanceAnalysis | None</code> <p>Current refinance analysis results</p> <code>sensitivity_data</code> <code>list[dict]</code> <p>Sensitivity analysis data</p> <code>holding_period_data</code> <code>list[dict]</code> <p>Holding period analysis data</p> <code>amortization_data</code> <code>list[dict]</code> <p>Amortization comparison data</p> <code>amortization_balance_chart</code> <code>AmortizationChart | None</code> <p>Amortization chart comparing loan balances</p> <code>current_amortization_schedule</code> <code>list[dict]</code> <p>Monthly schedule for the current loan</p> <code>new_amortization_schedule</code> <code>list[dict]</code> <p>Monthly schedule for the new loan</p> <code>current_balance</code> <code>StringVar</code> <p>Current loan balance input</p> <code>current_rate</code> <code>StringVar</code> <p>Current loan interest rate input</p> <code>current_remaining</code> <code>StringVar</code> <p>Current loan remaining term input</p> <code>new_rate</code> <code>StringVar</code> <p>New loan interest rate input</p> <code>new_term</code> <code>StringVar</code> <p>New loan term input</p> <code>closing_costs</code> <code>StringVar</code> <p>Closing costs input</p> <code>cash_out</code> <code>StringVar</code> <p>Cash-out amount input</p> <code>opportunity_rate</code> <code>StringVar</code> <p>Opportunity cost rate input</p> <code>marginal_tax_rate</code> <code>StringVar</code> <p>Marginal tax rate input</p> <code>npv_window_years</code> <code>StringVar</code> <p>NPV calculation window input</p> <code>chart_horizon_years</code> <code>StringVar</code> <p>Chart horizon years input</p> <code>sensitivity_max_reduction</code> <code>StringVar</code> <p>Sensitivity max rate reduction input</p> <code>sensitivity_step</code> <code>StringVar</code> <p>Sensitivity rate step input</p> <code>maintain_payment</code> <code>BooleanVar</code> <p>Maintain current payment option</p> <code>fred_api_key</code> <code>str | None</code> <p>FRED API key for market data (if available)</p> <code>market_series_data</code> <code>dict[str, list[tuple[datetime, float]]]</code> <p>Historical rate observations keyed by series id</p> <code>market_series_errors</code> <code>dict[str, str | None]</code> <p>Load errors keyed by series id</p> <code>market_cache_timestamps</code> <code>dict[str, datetime | None]</code> <p>Cache timestamps keyed by series id</p> <code>market_period_var</code> <code>StringVar</code> <p>Selected history window (months)</p> <code>market_chart</code> <code>MarketChart | None</code> <p>Chart widget displaying all series</p> <code>market_tree</code> <code>Treeview | None</code> <p>Table showing side-by-side tenor values</p> <code>_market_status_label</code> <code>Label | None</code> <p>Label describing market data status</p> <code>_market_cache_indicator</code> <code>Label | None</code> <p>Cache freshness badge</p> <code>_calc_canvas</code> <code>Canvas</code> <p>Canvas for the calculator tab</p> <code>sens_tree</code> <code>Treeview</code> <p>Treeview for sensitivity analysis</p> <code>holding_tree</code> <code>Treeview</code> <p>Treeview for holding period analysis</p> <code>amort_tree</code> <code>Treeview</code> <p>Treeview for amortization comparison</p> <code>_background_canvas</code> <code>Canvas</code> <p>Canvas for background info tab</p> <code>_help_canvas</code> <code>Canvas</code> <p>Canvas for help info tab</p> <code>chart</code> <code>SavingsChart</code> <p>Savings chart component</p> <code>pay_frame</code> <code>Frame</code> <p>Frame for payment results</p> <code>balance_frame</code> <code>Frame</code> <p>Frame for balance results</p> <code>current_pmt_label</code> <code>Label</code> <p>Label for current payment result</p> <code>new_pmt_label</code> <code>Label</code> <p>Label for new payment result</p> <code>savings_label</code> <code>Label</code> <p>Label for monthly savings result</p> <code>new_balance_label</code> <code>Label</code> <p>Label for new loan balance result</p> <code>cash_out_label</code> <code>Label</code> <p>Label for cash-out amount result</p> <code>simple_be_label</code> <code>Label</code> <p>Label for simple breakeven result</p> <code>npv_be_label</code> <code>Label</code> <p>Label for NPV breakeven result</p> <code>curr_int_label</code> <code>Label</code> <p>Label for current total interest result</p> <code>new_int_label</code> <code>Label</code> <p>Label for new total interest result</p> <code>int_delta_label</code> <code>Label</code> <p>Label for interest delta result</p> <code>tax_section_label</code> <code>Label</code> <p>Label for after-tax section title</p> <code>at_current_pmt_label</code> <code>Label</code> <p>Label for after-tax current payment result</p> <code>at_new_pmt_label</code> <code>Label</code> <p>Label for after-tax new payment result</p> <code>at_savings_label</code> <code>Label</code> <p>Label for after-tax monthly savings result</p> <code>at_simple_be_label</code> <code>Label</code> <p>Label for after-tax simple breakeven result</p> <code>at_npv_be_label</code> <code>Label</code> <p>Label for after-tax NPV breakeven result</p> <code>at_int_delta_label</code> <code>Label</code> <p>Label for after-tax interest delta result</p> <code>npv_title_label</code> <code>Label</code> <p>Label for NPV title</p> <code>five_yr_npv_label</code> <code>Label</code> <p>Label for 5-year NPV result</p> <code>accel_section_frame</code> <code>Frame</code> <p>Frame for accelerated payoff section</p> <code>accel_section_label</code> <code>Label</code> <p>Label for accelerated payoff section title</p> <code>accel_months_label</code> <code>Label</code> <p>Label for accelerated months result</p> <code>accel_time_saved_label</code> <code>Label</code> <p>Label for accelerated time saved result</p> <code>accel_interest_saved_label</code> <code>Label</code> <p>Label for accelerated interest saved result</p> <code>current_cost_npv_label</code> <code>Label</code> <p>Label for current total cost NPV result</p> <code>new_cost_npv_label</code> <code>Label</code> <p>Label for new total cost NPV result</p> <code>cost_npv_advantage_label</code> <code>Label</code> <p>Label for total cost NPV advantage result</p> <code>amort_curr_total_int</code> <code>Label</code> <p>Label for amortization current total interest</p> <code>amort_new_total_int</code> <code>Label</code> <p>Label for amortization new total interest</p> <code>amort_int_savings</code> <code>Label</code> <p>Label for amortization interest savings</p> Source code in <code>src/refi_calculator/gui/app.py</code> <pre><code>class RefinanceCalculatorApp:\n    \"\"\"Refinance Calculator Application.\n\n    Attributes:\n        root: Root Tkinter window\n        current_analysis: Current refinance analysis results\n        sensitivity_data: Sensitivity analysis data\n        holding_period_data: Holding period analysis data\n        amortization_data: Amortization comparison data\n        amortization_balance_chart: Amortization chart comparing loan balances\n        current_amortization_schedule: Monthly schedule for the current loan\n        new_amortization_schedule: Monthly schedule for the new loan\n        current_balance: Current loan balance input\n        current_rate: Current loan interest rate input\n        current_remaining: Current loan remaining term input\n        new_rate: New loan interest rate input\n        new_term: New loan term input\n        closing_costs: Closing costs input\n        cash_out: Cash-out amount input\n        opportunity_rate: Opportunity cost rate input\n        marginal_tax_rate: Marginal tax rate input\n        npv_window_years: NPV calculation window input\n        chart_horizon_years: Chart horizon years input\n        sensitivity_max_reduction: Sensitivity max rate reduction input\n        sensitivity_step: Sensitivity rate step input\n        maintain_payment: Maintain current payment option\n        fred_api_key: FRED API key for market data (if available)\n        market_series_data: Historical rate observations keyed by series id\n        market_series_errors: Load errors keyed by series id\n        market_cache_timestamps: Cache timestamps keyed by series id\n        market_period_var: Selected history window (months)\n        market_chart: Chart widget displaying all series\n        market_tree: Table showing side-by-side tenor values\n        _market_status_label: Label describing market data status\n        _market_cache_indicator: Cache freshness badge\n        _calc_canvas: Canvas for the calculator tab\n        sens_tree: Treeview for sensitivity analysis\n        holding_tree: Treeview for holding period analysis\n        amort_tree: Treeview for amortization comparison\n        _background_canvas: Canvas for background info tab\n        _help_canvas: Canvas for help info tab\n        chart: Savings chart component\n        pay_frame: Frame for payment results\n        balance_frame: Frame for balance results\n        current_pmt_label: Label for current payment result\n        new_pmt_label: Label for new payment result\n        savings_label: Label for monthly savings result\n        new_balance_label: Label for new loan balance result\n        cash_out_label: Label for cash-out amount result\n        simple_be_label: Label for simple breakeven result\n        npv_be_label: Label for NPV breakeven result\n        curr_int_label: Label for current total interest result\n        new_int_label: Label for new total interest result\n        int_delta_label: Label for interest delta result\n        tax_section_label: Label for after-tax section title\n        at_current_pmt_label: Label for after-tax current payment result\n        at_new_pmt_label: Label for after-tax new payment result\n        at_savings_label: Label for after-tax monthly savings result\n        at_simple_be_label: Label for after-tax simple breakeven result\n        at_npv_be_label: Label for after-tax NPV breakeven result\n        at_int_delta_label: Label for after-tax interest delta result\n        npv_title_label: Label for NPV title\n        five_yr_npv_label: Label for 5-year NPV result\n        accel_section_frame: Frame for accelerated payoff section\n        accel_section_label: Label for accelerated payoff section title\n        accel_months_label: Label for accelerated months result\n        accel_time_saved_label: Label for accelerated time saved result\n        accel_interest_saved_label: Label for accelerated interest saved result\n        current_cost_npv_label: Label for current total cost NPV result\n        new_cost_npv_label: Label for new total cost NPV result\n        cost_npv_advantage_label: Label for total cost NPV advantage result\n        amort_curr_total_int: Label for amortization current total interest\n        amort_new_total_int: Label for amortization new total interest\n        amort_int_savings: Label for amortization interest savings\n    \"\"\"\n\n    root: tk.Tk\n    current_analysis: RefinanceAnalysis | None\n    sensitivity_data: list[dict]\n    holding_period_data: list[dict]\n    amortization_data: list[dict]\n    amortization_balance_chart: AmortizationChart | None\n    current_amortization_schedule: list[dict]\n    new_amortization_schedule: list[dict]\n    current_balance: tk.StringVar\n    current_rate: tk.StringVar\n    current_remaining: tk.StringVar\n    new_rate: tk.StringVar\n    new_term: tk.StringVar\n    closing_costs: tk.StringVar\n    cash_out: tk.StringVar\n    opportunity_rate: tk.StringVar\n    marginal_tax_rate: tk.StringVar\n    npv_window_years: tk.StringVar\n    chart_horizon_years: tk.StringVar\n    sensitivity_max_reduction: tk.StringVar\n    sensitivity_step: tk.StringVar\n    maintain_payment: tk.BooleanVar\n    fred_api_key: str | None\n    market_series_data: dict[str, list[tuple[datetime, float]]]\n    market_series_errors: dict[str, str | None]\n    market_cache_timestamps: dict[str, datetime | None]\n    market_period_var: tk.StringVar\n    market_chart: MarketChart | None\n    market_tree: ttk.Treeview | None\n    _market_status_label: ttk.Label | None\n    _market_cache_indicator: ttk.Label | None\n    _calc_canvas: tk.Canvas\n    sens_tree: ttk.Treeview\n    holding_tree: ttk.Treeview\n    amort_tree: ttk.Treeview\n    _background_canvas: tk.Canvas\n    _help_canvas: tk.Canvas\n    chart: SavingsChart\n    pay_frame: ttk.Frame\n    balance_frame: ttk.Frame\n    current_pmt_label: ttk.Label\n    new_pmt_label: ttk.Label\n    savings_label: ttk.Label\n    new_balance_label: ttk.Label\n    cash_out_label: ttk.Label\n    simple_be_label: ttk.Label\n    npv_be_label: ttk.Label\n    curr_int_label: ttk.Label\n    new_int_label: ttk.Label\n    int_delta_label: ttk.Label\n    tax_section_label: ttk.Label\n    at_current_pmt_label: ttk.Label\n    at_new_pmt_label: ttk.Label\n    at_savings_label: ttk.Label\n    at_simple_be_label: ttk.Label\n    at_npv_be_label: ttk.Label\n    at_int_delta_label: ttk.Label\n    npv_title_label: ttk.Label\n    five_yr_npv_label: ttk.Label\n    accel_section_frame: ttk.Frame\n    accel_section_label: ttk.Label\n    accel_months_label: ttk.Label\n    accel_time_saved_label: ttk.Label\n    accel_interest_saved_label: ttk.Label\n    current_cost_npv_label: ttk.Label\n    new_cost_npv_label: ttk.Label\n    cost_npv_advantage_label: ttk.Label\n    amort_curr_total_int: ttk.Label\n    amort_new_total_int: ttk.Label\n    amort_int_savings: ttk.Label\n\n    def __init__(\n        self,\n        root: tk.Tk,\n    ):\n        \"\"\"Initialize RefinanceCalculatorApp.\n\n        Args:\n            root: Root Tkinter window\n        \"\"\"\n        self.root = root\n        self.root.title(\"Refinance Breakeven Calculator\")\n        self.root.configure(bg=\"#f5f5f5\")\n\n        self.current_analysis: RefinanceAnalysis | None = None\n        self.sensitivity_data: list[dict] = []\n        self.holding_period_data: list[dict] = []\n        self.amortization_data: list[dict] = []\n        self.current_amortization_schedule: list[dict] = []\n        self.new_amortization_schedule: list[dict] = []\n        self.amortization_balance_chart: AmortizationChart | None = None\n\n        self.current_balance = tk.StringVar(value=\"400000\")\n        self.current_rate = tk.StringVar(value=\"6.5\")\n        self.current_remaining = tk.StringVar(value=\"25\")\n        self.new_rate = tk.StringVar(value=\"5.75\")\n        self.new_term = tk.StringVar(value=\"30\")\n        self.closing_costs = tk.StringVar(value=\"8000\")\n        self.cash_out = tk.StringVar(value=\"0\")\n        self.opportunity_rate = tk.StringVar(value=\"5.0\")\n        self.marginal_tax_rate = tk.StringVar(value=\"0\")\n\n        self.npv_window_years = tk.StringVar(value=\"5\")\n        self.chart_horizon_years = tk.StringVar(value=\"10\")\n        self.sensitivity_max_reduction = tk.StringVar(value=\"2.5\")\n        self.sensitivity_step = tk.StringVar(value=\"0.125\")\n        self.maintain_payment = tk.BooleanVar(value=False)\n\n        self.fred_api_key = os.getenv(\"FRED_API_KEY\")\n        self.market_series_data: dict[str, list[tuple[datetime, float]]] = {\n            series_id: [] for _, series_id in MARKET_SERIES\n        }\n        self.market_series_errors: dict[str, str | None] = {\n            series_id: None for _, series_id in MARKET_SERIES\n        }\n        self.market_cache_timestamps: dict[str, datetime | None] = {\n            series_id: None for _, series_id in MARKET_SERIES\n        }\n        self.market_chart: MarketChart | None = None\n        self.market_tree: ttk.Treeview | None = None\n        self._market_status_label: ttk.Label | None = None\n        self._market_cache_indicator: ttk.Label | None = None\n        self.market_period_var = tk.StringVar(value=MARKET_DEFAULT_PERIOD)\n\n        self._load_all_market_data(force=True)\n        self._build_ui()\n        self._calculate()\n\n    def _build_ui(self):\n        \"\"\"Build the main UI components.\"\"\"\n        # Style notebook tabs so the active one stands out\n        style = ttk.Style()\n        style.configure(\"TNotebook.Tab\", padding=(12, 6))\n        style.map(\"TNotebook.Tab\", font=[(\"selected\", (\"Segoe UI\", 9, \"bold\"))])\n\n        self.notebook = ttk.Notebook(self.root)\n        self.notebook.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)\n\n        # Main calculator (scrollable)\n        main_tab = ttk.Frame(self.notebook, padding=0)\n        self.notebook.add(main_tab, text=\"Calculator\")\n\n        self._calc_canvas = tk.Canvas(main_tab, highlightthickness=0)\n        calc_scrollbar = ttk.Scrollbar(main_tab, orient=\"vertical\", command=self._calc_canvas.yview)\n        calc_scroll_frame = ttk.Frame(self._calc_canvas, padding=10)\n\n        calc_scroll_frame.bind(\n            \"&lt;Configure&gt;\",\n            lambda e: self._calc_canvas.configure(scrollregion=self._calc_canvas.bbox(\"all\")),\n        )\n        calc_canvas_window = self._calc_canvas.create_window(\n            (0, 0),\n            window=calc_scroll_frame,\n            anchor=\"nw\",\n        )\n        self._calc_canvas.configure(yscrollcommand=calc_scrollbar.set)\n\n        def on_calc_canvas_configure(event):\n            self._calc_canvas.itemconfig(calc_canvas_window, width=event.width)\n\n        self._calc_canvas.bind(\"&lt;Configure&gt;\", on_calc_canvas_configure)\n\n        self._calc_canvas.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)\n        calc_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)\n\n        # Analysis group: sensitivity + holding period\n        analysis_tab = ttk.Frame(self.notebook, padding=10)\n        self.notebook.add(analysis_tab, text=\"Analysis\")\n        self.analysis_notebook = ttk.Notebook(analysis_tab)\n        self.analysis_notebook.pack(fill=tk.BOTH, expand=True)\n        sens_tab = ttk.Frame(self.analysis_notebook, padding=10)\n        holding_tab = ttk.Frame(self.analysis_notebook, padding=10)\n        self.analysis_notebook.add(sens_tab, text=\"Rate Sensitivity\")\n        self.analysis_notebook.add(holding_tab, text=\"Holding Period\")\n\n        # Visuals group: amortization + chart\n        visuals_tab = ttk.Frame(self.notebook, padding=10)\n        self.notebook.add(visuals_tab, text=\"Loan Visualizations\")\n        self.visuals_notebook = ttk.Notebook(visuals_tab)\n        self.visuals_notebook.pack(fill=tk.BOTH, expand=True)\n        amort_tab = ttk.Frame(self.visuals_notebook, padding=10)\n        chart_tab = ttk.Frame(self.visuals_notebook, padding=10)\n        self.visuals_notebook.add(amort_tab, text=\"Amortization\")\n        self.visuals_notebook.add(chart_tab, text=\"Chart\")\n\n        # Market data tab\n        market_tab = ttk.Frame(self.notebook, padding=10)\n        self.notebook.add(market_tab, text=\"Market\")\n        build_market_tab(self, market_tab)\n        self._populate_market_tab()\n\n        # Options remain a top-level tab\n        options_tab = ttk.Frame(self.notebook, padding=10)\n        self.notebook.add(options_tab, text=\"Options\")\n\n        # Info group: background + help\n        info_tab = ttk.Frame(self.notebook, padding=10)\n        self.notebook.add(info_tab, text=\"Info\")\n        self.info_notebook = ttk.Notebook(info_tab)\n        self.info_notebook.pack(fill=tk.BOTH, expand=True)\n        background_tab = ttk.Frame(self.info_notebook, padding=10)\n        help_tab = ttk.Frame(self.info_notebook, padding=10)\n        self.info_notebook.add(background_tab, text=\"Background\")\n        self.info_notebook.add(help_tab, text=\"Help\")\n\n        build_main_tab(self, calc_scroll_frame)\n        build_sensitivity_tab(self, sens_tab)\n        build_holding_period_tab(self, holding_tab)\n        build_amortization_tab(self, amort_tab)\n        build_chart_tab(self, chart_tab)\n        build_options_tab(self, options_tab)\n        build_background_tab(self, background_tab)\n        build_help_tab(self, help_tab)\n\n        # Global mouse wheel handler that routes scrolling based on active tab\n        def on_mousewheel(event):\n            delta = int(-1 * (event.delta / 120))\n            top_index = self.notebook.index(self.notebook.select())\n\n            # Calculator tab\n            if top_index == CALCULATOR_TAB_INDEX and hasattr(self, \"_calc_canvas\"):\n                self._calc_canvas.yview_scroll(delta, \"units\")\n            elif top_index == ANALYSIS_TAB_INDEX and hasattr(self, \"analysis_notebook\"):\n                # Analysis tab\n                sub_index = self.analysis_notebook.index(self.analysis_notebook.select())\n                if sub_index == 0 and hasattr(self, \"sens_tree\"):\n                    self.sens_tree.yview_scroll(delta, \"units\")\n                elif sub_index == 1 and hasattr(self, \"holding_tree\"):\n                    self.holding_tree.yview_scroll(delta, \"units\")\n            elif top_index == VISUALS_TAB_INDEX and hasattr(self, \"visuals_notebook\"):\n                # Visuals tab\n                sub_index = self.visuals_notebook.index(self.visuals_notebook.select())\n                if sub_index == 0 and hasattr(self, \"amort_tree\"):\n                    self.amort_tree.yview_scroll(delta, \"units\")\n                # Chart tab has no vertical scroll\n            elif top_index == MARKET_TAB_INDEX and self.market_tree:\n                self.market_tree.yview_scroll(delta, \"units\")\n            elif top_index == INFO_TAB_INDEX and hasattr(self, \"info_notebook\"):\n                # Info tab\n                sub_index = self.info_notebook.index(self.info_notebook.select())\n                if sub_index == 0 and hasattr(self, \"_background_canvas\"):\n                    self._background_canvas.yview_scroll(delta, \"units\")\n                elif sub_index == 1 and hasattr(self, \"_help_canvas\"):\n                    self._help_canvas.yview_scroll(delta, \"units\")\n\n        self.root.bind_all(\"&lt;MouseWheel&gt;\", on_mousewheel)\n\n    def _load_market_series(self, series_id: str, *, force: bool = False) -&gt; None:\n        \"\"\"Fetch a named FRED series, reusing cache if it is still fresh.\"\"\"\n        now = datetime.now()\n        cache_timestamp = self.market_cache_timestamps.get(series_id)\n        cached_values = self.market_series_data.get(series_id)\n        if (\n            not force\n            and cached_values\n            and cache_timestamp\n            and now - cache_timestamp &lt; MARKET_CACHE_TTL\n        ):\n            logger.debug(\"Using cached market observation data for %s\", series_id)\n            self.market_series_errors[series_id] = None\n            return\n\n        if not self.fred_api_key:\n            self.market_series_errors[series_id] = (\n                \"FRED_API_KEY is not configured; market history is disabled.\"\n            )\n            logger.info(\n                \"Skipping market fetch for %s: %s\",\n                series_id,\n                self.market_series_errors[series_id],\n            )\n            return\n\n        try:\n            observations = fetch_fred_series(series_id, self.fred_api_key, limit=600)\n        except RuntimeError as exc:\n            logger.exception(\"Failed to fetch market rates from FRED for %s\", series_id)\n            self.market_series_errors[series_id] = f\"Unable to load mortgage rate data: {exc}\"\n            return\n\n        if not observations:\n            self.market_series_errors[series_id] = (\n                \"FRED returned no observations for the selected series.\"\n            )\n            logger.warning(self.market_series_errors[series_id])\n            return\n\n        processed: list[tuple[datetime, float]] = []\n        for date_str, value in observations:\n            try:\n                parsed = datetime.strptime(date_str, \"%Y-%m-%d\")\n            except ValueError:\n                continue\n            processed.append((parsed, value))\n\n        self.market_series_data[series_id] = processed\n        self.market_cache_timestamps[series_id] = now\n        self.market_series_errors[series_id] = None\n\n        if series_id == \"MORTGAGE30US\" and processed:\n            latest_rate = processed[0][1]\n            self.new_rate.set(f\"{latest_rate:.3f}\")\n\n    def _load_all_market_data(self, *, force: bool = False) -&gt; None:\n        \"\"\"Ensure every configured series has fresh data.\"\"\"\n        for _, series_id in MARKET_SERIES:\n            self._load_market_series(series_id, force=force)\n\n    def _refresh_market_data(self) -&gt; None:\n        \"\"\"Refresh market rates and update the corresponding tab.\"\"\"\n        self._load_all_market_data(force=True)\n        self._populate_market_tab()\n        if self.market_series_data.get(\"MORTGAGE30US\"):\n            self._calculate()\n\n    def _populate_market_tab(self) -&gt; None:\n        \"\"\"Update the market tab tree with the latest observations.\"\"\"\n        if not self._market_status_label:\n            return\n\n        if self.market_tree:\n            for row in self.market_tree.get_children():\n                self.market_tree.delete(row)\n\n            merged = self._merged_market_rows()\n            for row in merged:\n                self.market_tree.insert(\"\", tk.END, values=row)\n\n        if self.market_chart:\n            chart_data = {\n                label: self._filtered_series_data(series_id) for label, series_id in MARKET_SERIES\n            }\n            self.market_chart.plot(chart_data)\n\n        self._update_market_status_display()\n\n    def _market_period_months(self) -&gt; int | None:\n        \"\"\"Return the selected period in months, using None for 'All'.\"\"\"\n        value = self.market_period_var.get()\n        try:\n            months = int(value)\n        except (TypeError, ValueError):\n            return None\n        return None if months &lt;= 0 else months\n\n    def _filtered_series_data(self, series_id: str) -&gt; list[tuple[datetime, float]]:\n        \"\"\"Return the rate observations truncated to the selected period.\"\"\"\n        rows = self.market_series_data.get(series_id, [])\n        months = self._market_period_months()\n        if not rows or months is None:\n            return rows\n\n        latest = rows[0][0]\n        threshold = latest - timedelta(days=months * 30)\n        return [row for row in rows if row[0] &gt;= threshold]\n\n    def _merged_market_rows(self) -&gt; list[tuple[str, ...]]:\n        \"\"\"Combine each series into a table-ready row.\"\"\"\n        filtered_map = {\n            series_id: self._filtered_series_data(series_id) for _, series_id in MARKET_SERIES\n        }\n        series_value_map: dict[str, dict[datetime, float]] = {\n            series_id: {dt: rate for dt, rate in rows} for series_id, rows in filtered_map.items()\n        }\n\n        all_dates = sorted(\n            {dt for rates in series_value_map.values() for dt in rates},\n            reverse=True,\n        )\n        result: list[tuple[str, ...]] = []\n        for dt in all_dates:\n            row = [dt.strftime(\"%Y-%m-%d\")]\n            for _, series_id in MARKET_SERIES:\n                rate = series_value_map.get(series_id, {}).get(dt)\n                row.append(f\"{rate:.3f}%\" if rate is not None else \"\u2014\")\n            result.append(tuple(row))\n        return result\n\n    def _update_market_status_display(self) -&gt; None:\n        \"\"\"Refresh the market status text and cache indicator for the selected series.\"\"\"\n        if not self._market_status_label:\n            return\n\n        parts: list[str] = []\n        timestamps: list[datetime] = []\n        for label, series_id in MARKET_SERIES:\n            rows = self._filtered_series_data(series_id)\n            error = self.market_series_errors.get(series_id)\n\n            if not rows:\n                parts.append(f\"{label}: {error or 'unavailable'}\")\n                continue\n\n            latest_date, latest_rate = rows[0]\n            parts.append(f\"{label}: {latest_rate:.3f}% ({latest_date:%Y-%m-%d})\")\n            timestamp = self.market_cache_timestamps.get(series_id)\n            if timestamp:\n                timestamps.append(timestamp)\n\n        status_text = \" | \".join(parts) if parts else \"Market data is not available.\"\n        if timestamps:\n            latest_ts = max(timestamps)\n            status_text += f\" - refreshed {latest_ts:%Y-%m-%d %H:%M}\"\n\n        self._market_status_label.config(\n            text=status_text,\n            foreground=\"black\" if parts else \"red\",\n        )\n        self._update_market_cache_indicator(max(timestamps) if timestamps else None)\n\n    def _update_market_cache_indicator(self, timestamp: datetime | None = None) -&gt; None:\n        \"\"\"Update the cache status indicator label below the Market tab header.\"\"\"\n        if not self._market_cache_indicator:\n            return\n\n        if timestamp is None:\n            timestamps = [ts for ts in self.market_cache_timestamps.values() if ts is not None]\n            timestamp = max(timestamps) if timestamps else None\n        if not timestamp:\n            self._market_cache_indicator.config(\n                text=\"Cache: not populated\",\n                foreground=\"#666\",\n            )\n            return\n\n        age = datetime.now() - timestamp\n        status = \"fresh\" if age &lt; MARKET_CACHE_TTL else \"stale\"\n        minutes = int(age.total_seconds() / 60)\n        suffix = \"just now\" if minutes == 0 else f\"{minutes} min ago\"\n        color = \"green\" if status == \"fresh\" else \"orange\"\n        self._market_cache_indicator.config(\n            text=f\"Cache ({status}): {suffix}\",\n            foreground=color,\n        )\n\n    def _calculate(self) -&gt; None:\n        \"\"\"Perform refinance analysis and update all results and charts.\"\"\"\n        try:\n            npv_years = int(float(self.npv_window_years.get() or 5))\n            chart_years = int(float(self.chart_horizon_years.get() or 10))\n            sens_max = float(self.sensitivity_max_reduction.get() or 2.0)\n            sens_step = float(self.sensitivity_step.get() or 0.25)\n\n            params = {\n                \"current_balance\": float(self.current_balance.get()),\n                \"current_rate\": float(self.current_rate.get()) / 100,\n                \"current_remaining_years\": float(self.current_remaining.get()),\n                \"new_rate\": float(self.new_rate.get()) / 100,\n                \"new_term_years\": float(self.new_term.get()),\n                \"closing_costs\": float(self.closing_costs.get()),\n                \"cash_out\": float(self.cash_out.get() or 0),\n                \"opportunity_rate\": float(self.opportunity_rate.get()) / 100,\n                \"npv_window_years\": npv_years,\n                \"chart_horizon_years\": chart_years,\n                \"marginal_tax_rate\": float(self.marginal_tax_rate.get() or 0) / 100,\n                \"maintain_payment\": self.maintain_payment.get(),\n            }\n\n            self.current_analysis = analyze_refinance(**params)\n            self._update_results(self.current_analysis, npv_years)\n\n            current_rate_pct = float(self.current_rate.get())\n            rate_steps = []\n            r = sens_step\n            max_scenarios = 20\n            while r &lt;= sens_max + 0.001 and len(rate_steps) &lt; max_scenarios:\n                new_rate = current_rate_pct - r\n                if new_rate &gt; 0:\n                    rate_steps.append(new_rate / 100)\n                r += sens_step\n\n            self.sensitivity_data = run_sensitivity(\n                params[\"current_balance\"],\n                params[\"current_rate\"],\n                params[\"current_remaining_years\"],\n                params[\"new_term_years\"],\n                params[\"closing_costs\"],\n                params[\"opportunity_rate\"],\n                rate_steps,\n                npv_years,\n            )\n            self._update_sensitivity(npv_years)\n\n            holding_periods = [1, 2, 3, 4, 5, 6, 7, 8, 10, 12, 15, 20]\n            self.holding_period_data = run_holding_period_analysis(\n                params[\"current_balance\"],\n                params[\"current_rate\"],\n                params[\"current_remaining_years\"],\n                params[\"new_rate\"],\n                params[\"new_term_years\"],\n                params[\"closing_costs\"],\n                params[\"opportunity_rate\"],\n                params[\"marginal_tax_rate\"],\n                holding_periods,\n                params[\"cash_out\"],\n            )\n            self._update_holding_period()\n\n            (\n                current_schedule,\n                new_schedule,\n            ) = generate_amortization_schedule_pair(\n                current_balance=params[\"current_balance\"],\n                current_rate=params[\"current_rate\"],\n                current_remaining_years=params[\"current_remaining_years\"],\n                new_rate=params[\"new_rate\"],\n                new_term_years=params[\"new_term_years\"],\n                closing_costs=params[\"closing_costs\"],\n                cash_out=params[\"cash_out\"],\n                maintain_payment=params[\"maintain_payment\"],\n            )\n            self.current_amortization_schedule = current_schedule\n            self.new_amortization_schedule = new_schedule\n\n            self.amortization_data = generate_comparison_schedule(\n                current_balance=params[\"current_balance\"],\n                current_rate=params[\"current_rate\"],\n                current_remaining_years=params[\"current_remaining_years\"],\n                new_rate=params[\"new_rate\"],\n                new_term_years=params[\"new_term_years\"],\n                closing_costs=params[\"closing_costs\"],\n                cash_out=params[\"cash_out\"],\n                maintain_payment=params[\"maintain_payment\"],\n            )\n            self._update_amortization()\n            self._update_amortization_balance_chart()\n\n            self.chart.plot(\n                self.current_analysis.cumulative_savings,\n                self.current_analysis.npv_breakeven_months,\n            )\n\n        except ValueError:\n            pass\n\n    def _update_results(\n        self,\n        a: RefinanceAnalysis,\n        npv_years: int = 5,\n    ) -&gt; None:\n        \"\"\"Update result labels based on the given analysis.\n\n        Args:\n            a: RefinanceAnalysis object with calculation results\n            npv_years: NPV time horizon in years\n        \"\"\"\n\n        def fmt(v: float) -&gt; str:\n            return f\"${v:,.0f}\"\n\n        def fmt_months(m: float | None) -&gt; str:\n            if m is None:\n                return \"N/A\"\n            return f\"{m:.0f} mo ({m / 12:.1f} yr)\"\n\n        self.current_pmt_label.config(text=fmt(a.current_payment))\n        self.new_pmt_label.config(text=fmt(a.new_payment))\n\n        savings_text = fmt(abs(a.monthly_savings))\n        if a.monthly_savings &gt;= 0:\n            self.savings_label.config(text=f\"-{savings_text}\", foreground=\"green\")\n        else:\n            self.savings_label.config(text=f\"+{savings_text}\", foreground=\"red\")\n\n        if a.cash_out_amount &gt; 0:\n            self.balance_frame.pack(fill=tk.X, pady=(0, 8), after=self.pay_frame)\n            self.new_balance_label.config(text=fmt(a.new_loan_balance))\n            self.cash_out_label.config(text=fmt(a.cash_out_amount), foreground=\"blue\")\n        else:\n            self.balance_frame.pack_forget()\n\n        self.simple_be_label.config(text=fmt_months(a.simple_breakeven_months))\n        self.npv_be_label.config(text=fmt_months(a.npv_breakeven_months))\n\n        self.curr_int_label.config(text=fmt(a.current_total_interest))\n        self.new_int_label.config(text=fmt(a.new_total_interest))\n\n        delta_text = fmt(abs(a.interest_delta))\n        if a.interest_delta &lt; 0:\n            self.int_delta_label.config(text=f\"-{delta_text}\", foreground=\"green\")\n        else:\n            self.int_delta_label.config(text=f\"+{delta_text}\", foreground=\"red\")\n\n        self.npv_title_label.config(text=f\"{npv_years}-Year NPV of Refinancing\")\n\n        tax_rate_pct = float(self.marginal_tax_rate.get() or 0)\n        self.tax_section_label.config(\n            text=f\"After-Tax Analysis ({tax_rate_pct:.0f}% marginal rate)\",\n        )\n\n        self.at_current_pmt_label.config(text=fmt(a.current_after_tax_payment))\n        self.at_new_pmt_label.config(text=fmt(a.new_after_tax_payment))\n\n        at_savings_text = fmt(abs(a.after_tax_monthly_savings))\n        if a.after_tax_monthly_savings &gt;= 0:\n            self.at_savings_label.config(text=f\"-{at_savings_text}\", foreground=\"green\")\n        else:\n            self.at_savings_label.config(text=f\"+{at_savings_text}\", foreground=\"red\")\n\n        self.at_simple_be_label.config(text=fmt_months(a.after_tax_simple_breakeven_months))\n        self.at_npv_be_label.config(text=fmt_months(a.after_tax_npv_breakeven_months))\n\n        at_int_delta_text = fmt(abs(a.after_tax_interest_delta))\n        if a.after_tax_interest_delta &lt; 0:\n            self.at_int_delta_label.config(text=f\"-{at_int_delta_text}\", foreground=\"green\")\n        else:\n            self.at_int_delta_label.config(text=f\"+{at_int_delta_text}\", foreground=\"red\")\n\n        npv_text = fmt(abs(a.five_year_npv))\n        if a.five_year_npv &gt;= 0:\n            self.five_yr_npv_label.config(text=f\"+{npv_text}\", foreground=\"green\")\n        else:\n            self.five_yr_npv_label.config(text=f\"-{npv_text}\", foreground=\"red\")\n\n        # Accelerated payoff section\n        if self.maintain_payment.get() and a.accelerated_months:\n            self.accel_section_frame.pack(\n                fill=tk.X,\n                pady=(0, 8),\n                before=self.npv_title_label.master,\n            )\n\n            years = a.accelerated_months / 12\n            self.accel_months_label.config(text=f\"{a.accelerated_months} mo ({years:.1f} yr)\")\n\n            if a.accelerated_time_savings_months:\n                saved_years = a.accelerated_time_savings_months / 12\n                self.accel_time_saved_label.config(\n                    text=f\"{a.accelerated_time_savings_months} mo ({saved_years:.1f} yr)\",\n                    foreground=\"green\",\n                )\n\n            if a.accelerated_interest_savings:\n                self.accel_interest_saved_label.config(\n                    text=fmt(a.accelerated_interest_savings),\n                    foreground=\"green\",\n                )\n        else:\n            self.accel_section_frame.pack_forget()\n\n        # Total Cost NPV\n        self.current_cost_npv_label.config(text=fmt(a.current_total_cost_npv))\n        self.new_cost_npv_label.config(text=fmt(a.new_total_cost_npv))\n\n        adv_text = fmt(abs(a.total_cost_npv_advantage))\n        if a.total_cost_npv_advantage &gt;= 0:\n            self.cost_npv_advantage_label.config(text=f\"+{adv_text}\", foreground=\"green\")\n        else:\n            self.cost_npv_advantage_label.config(text=f\"-{adv_text}\", foreground=\"red\")\n\n    def _update_sensitivity(\n        self,\n        npv_years: int = 5,\n    ) -&gt; None:\n        \"\"\"Update sensitivity analysis table.\n\n        Args:\n            npv_years: NPV time horizon in years\n        \"\"\"\n        self.sens_tree.heading(\"npv_5yr\", text=f\"{npv_years}-Yr NPV\")\n\n        for row in self.sens_tree.get_children():\n            self.sens_tree.delete(row)\n\n        for row in self.sensitivity_data:\n            simple = f\"{row['simple_be']:.0f} mo\" if row[\"simple_be\"] else \"N/A\"\n            npv = f\"{row['npv_be']} mo\" if row[\"npv_be\"] else \"N/A\"\n            self.sens_tree.insert(\n                \"\",\n                tk.END,\n                values=(\n                    f\"{row['new_rate']:.2f}%\",\n                    f\"${row['monthly_savings']:,.0f}\",\n                    simple,\n                    npv,\n                    f\"${row['five_yr_npv']:,.0f}\",\n                ),\n            )\n\n    def _update_holding_period(self) -&gt; None:\n        \"\"\"Update holding period analysis table.\"\"\"\n        for row in self.holding_tree.get_children():\n            self.holding_tree.delete(row)\n\n        for row in self.holding_period_data:\n            tag = row[\"recommendation\"].lower().replace(\" \", \"_\")\n            self.holding_tree.insert(\n                \"\",\n                tk.END,\n                values=(\n                    f\"{row['years']} yr\",\n                    f\"${row['nominal_savings']:,.0f}\",\n                    f\"${row['npv']:,.0f}\",\n                    f\"${row['npv_after_tax']:,.0f}\",\n                    row[\"recommendation\"],\n                ),\n                tags=(tag,),\n            )\n\n        self.holding_tree.tag_configure(\"strong_yes\", foreground=\"green\")\n        self.holding_tree.tag_configure(\"yes\", foreground=\"darkgreen\")\n        self.holding_tree.tag_configure(\"marginal\", foreground=\"orange\")\n        self.holding_tree.tag_configure(\"no\", foreground=\"red\")\n\n    def _update_amortization(self) -&gt; None:\n        \"\"\"Update amortization comparison table.\"\"\"\n        for row in self.amort_tree.get_children():\n            self.amort_tree.delete(row)\n\n        cumulative_curr_interest = 0\n        cumulative_new_interest = 0\n        cumulative_interest_diff = 0\n\n        for row in self.amortization_data:\n            cumulative_curr_interest += row[\"current_interest\"]\n            cumulative_new_interest += row[\"new_interest\"]\n\n            int_diff = row[\"interest_diff\"]\n            cumulative_interest_diff += int_diff\n            tag = \"savings\" if int_diff &lt; 0 else \"cost\"\n\n            self.amort_tree.insert(\n                \"\",\n                tk.END,\n                values=(\n                    row[\"year\"],\n                    f\"${row['current_principal']:,.0f}\",\n                    f\"${row['current_interest']:,.0f}\",\n                    f\"${row['current_balance']:,.0f}\",\n                    f\"${row['new_principal']:,.0f}\",\n                    f\"${row['new_interest']:,.0f}\",\n                    f\"${row['new_balance']:,.0f}\",\n                    f\"${int_diff:+,.0f}\",\n                    f\"${cumulative_interest_diff:+,.0f}\",\n                ),\n                tags=(tag,),\n            )\n\n        self.amort_tree.tag_configure(\"savings\", foreground=\"green\")\n        self.amort_tree.tag_configure(\"cost\", foreground=\"red\")\n\n        total_savings = cumulative_curr_interest - cumulative_new_interest\n\n        self.amort_curr_total_int.config(text=f\"${cumulative_curr_interest:,.0f}\")\n        self.amort_new_total_int.config(text=f\"${cumulative_new_interest:,.0f}\")\n\n        if total_savings &gt;= 0:\n            self.amort_int_savings.config(text=f\"${total_savings:,.0f}\", foreground=\"green\")\n        else:\n            self.amort_int_savings.config(text=f\"-${abs(total_savings):,.0f}\", foreground=\"red\")\n\n    def _update_amortization_balance_chart(self) -&gt; None:\n        \"\"\"Update loan balance comparison chart.\"\"\"\n        if not self.amortization_balance_chart:\n            return\n        self.amortization_balance_chart.plot(\n            self.current_amortization_schedule,\n            self.new_amortization_schedule,\n        )\n\n    def _export_csv(self) -&gt; None:\n        \"\"\"Export main analysis data to CSV file.\"\"\"\n        if not self.current_analysis:\n            messagebox.showwarning(\"No Data\", \"Run a calculation first.\")\n            return\n\n        filepath = filedialog.asksaveasfilename(\n            defaultextension=\".csv\",\n            filetypes=[(\"CSV files\", \"*.csv\")],\n            initialfile=f\"refi_analysis_{datetime.now():%Y%m%d_%H%M%S}.csv\",\n        )\n        if not filepath:\n            return\n\n        with open(filepath, \"w\", newline=\"\") as f:\n            w = csv.DictWriter(\n                f,\n                fieldnames=[\"new_rate\", \"monthly_savings\", \"simple_be\", \"npv_be\", \"five_yr_npv\"],\n            )\n            w.writeheader()\n            w.writerows(self.sensitivity_data)\n\n        messagebox.showinfo(\"Exported\", f\"Saved to {filepath}\")\n\n    def _export_sensitivity_csv(self) -&gt; None:\n        \"\"\"Export sensitivity analysis data to CSV file.\"\"\"\n        if not self.sensitivity_data:\n            messagebox.showwarning(\"No Data\", \"Run a calculation first.\")\n            return\n\n        filepath = filedialog.asksaveasfilename(\n            defaultextension=\".csv\",\n            filetypes=[(\"CSV files\", \"*.csv\")],\n            initialfile=f\"refi_sensitivity_{datetime.now():%Y%m%d_%H%M%S}.csv\",\n        )\n        if not filepath:\n            return\n\n        with open(filepath, \"w\", newline=\"\") as f:\n            w = csv.DictWriter(\n                f,\n                fieldnames=[\"new_rate\", \"monthly_savings\", \"simple_be\", \"npv_be\", \"five_yr_npv\"],\n            )\n            w.writeheader()\n            w.writerows(self.sensitivity_data)\n\n        messagebox.showinfo(\"Exported\", f\"Saved to {filepath}\")\n\n    def _export_holding_csv(self) -&gt; None:\n        \"\"\"Export holding period analysis data to CSV file.\"\"\"\n        if not self.holding_period_data:\n            messagebox.showwarning(\"No Data\", \"Run a calculation first.\")\n            return\n\n        filepath = filedialog.asksaveasfilename(\n            defaultextension=\".csv\",\n            filetypes=[(\"CSV files\", \"*.csv\")],\n            initialfile=f\"refi_holding_period_{datetime.now():%Y%m%d_%H%M%S}.csv\",\n        )\n        if not filepath:\n            return\n\n        with open(filepath, \"w\", newline=\"\") as f:\n            w = csv.DictWriter(\n                f,\n                fieldnames=[\"years\", \"nominal_savings\", \"npv\", \"npv_after_tax\", \"recommendation\"],\n            )\n            w.writeheader()\n            w.writerows(self.holding_period_data)\n\n        messagebox.showinfo(\"Exported\", f\"Saved to {filepath}\")\n\n    def _export_amortization_csv(self) -&gt; None:\n        \"\"\"Export amortization comparison data to CSV file.\"\"\"\n        if not self.amortization_data:\n            messagebox.showwarning(\"No Data\", \"Run a calculation first.\")\n            return\n\n        filepath = filedialog.asksaveasfilename(\n            defaultextension=\".csv\",\n            filetypes=[(\"CSV files\", \"*.csv\")],\n            initialfile=f\"refi_amortization_{datetime.now():%Y%m%d_%H%M%S}.csv\",\n        )\n        if not filepath:\n            return\n\n        with open(filepath, \"w\", newline=\"\") as f:\n            w = csv.DictWriter(\n                f,\n                fieldnames=[\n                    \"year\",\n                    \"current_principal\",\n                    \"current_interest\",\n                    \"current_balance\",\n                    \"new_principal\",\n                    \"new_interest\",\n                    \"new_balance\",\n                    \"principal_diff\",\n                    \"interest_diff\",\n                    \"balance_diff\",\n                ],\n            )\n            w.writeheader()\n            w.writerows(self.amortization_data)\n\n        messagebox.showinfo(\"Exported\", f\"Saved to {filepath}\")\n</code></pre>"},{"location":"reference/refi_calculator/gui/app/#refi_calculator.gui.app.RefinanceCalculatorApp.__init__","title":"<code>__init__(root)</code>","text":"<p>Initialize RefinanceCalculatorApp.</p> <p>Parameters:</p> Name Type Description Default <code>root</code> <code>Tk</code> <p>Root Tkinter window</p> required Source code in <code>src/refi_calculator/gui/app.py</code> <pre><code>def __init__(\n    self,\n    root: tk.Tk,\n):\n    \"\"\"Initialize RefinanceCalculatorApp.\n\n    Args:\n        root: Root Tkinter window\n    \"\"\"\n    self.root = root\n    self.root.title(\"Refinance Breakeven Calculator\")\n    self.root.configure(bg=\"#f5f5f5\")\n\n    self.current_analysis: RefinanceAnalysis | None = None\n    self.sensitivity_data: list[dict] = []\n    self.holding_period_data: list[dict] = []\n    self.amortization_data: list[dict] = []\n    self.current_amortization_schedule: list[dict] = []\n    self.new_amortization_schedule: list[dict] = []\n    self.amortization_balance_chart: AmortizationChart | None = None\n\n    self.current_balance = tk.StringVar(value=\"400000\")\n    self.current_rate = tk.StringVar(value=\"6.5\")\n    self.current_remaining = tk.StringVar(value=\"25\")\n    self.new_rate = tk.StringVar(value=\"5.75\")\n    self.new_term = tk.StringVar(value=\"30\")\n    self.closing_costs = tk.StringVar(value=\"8000\")\n    self.cash_out = tk.StringVar(value=\"0\")\n    self.opportunity_rate = tk.StringVar(value=\"5.0\")\n    self.marginal_tax_rate = tk.StringVar(value=\"0\")\n\n    self.npv_window_years = tk.StringVar(value=\"5\")\n    self.chart_horizon_years = tk.StringVar(value=\"10\")\n    self.sensitivity_max_reduction = tk.StringVar(value=\"2.5\")\n    self.sensitivity_step = tk.StringVar(value=\"0.125\")\n    self.maintain_payment = tk.BooleanVar(value=False)\n\n    self.fred_api_key = os.getenv(\"FRED_API_KEY\")\n    self.market_series_data: dict[str, list[tuple[datetime, float]]] = {\n        series_id: [] for _, series_id in MARKET_SERIES\n    }\n    self.market_series_errors: dict[str, str | None] = {\n        series_id: None for _, series_id in MARKET_SERIES\n    }\n    self.market_cache_timestamps: dict[str, datetime | None] = {\n        series_id: None for _, series_id in MARKET_SERIES\n    }\n    self.market_chart: MarketChart | None = None\n    self.market_tree: ttk.Treeview | None = None\n    self._market_status_label: ttk.Label | None = None\n    self._market_cache_indicator: ttk.Label | None = None\n    self.market_period_var = tk.StringVar(value=MARKET_DEFAULT_PERIOD)\n\n    self._load_all_market_data(force=True)\n    self._build_ui()\n    self._calculate()\n</code></pre>"},{"location":"reference/refi_calculator/gui/app/#refi_calculator.gui.app.main","title":"<code>main()</code>","text":"<p>Main driver function to run the refinance calculator app.</p> Source code in <code>src/refi_calculator/gui/app.py</code> <pre><code>def main() -&gt; None:\n    \"\"\"Main driver function to run the refinance calculator app.\"\"\"\n    root = tk.Tk()\n    root.geometry(\"1100x1040\")\n    root.resizable(True, True)\n    root.minsize(940, 900)\n    RefinanceCalculatorApp(root)\n    root.mainloop()\n</code></pre>"},{"location":"reference/refi_calculator/gui/chart/","title":"chart","text":"<p>Chart components for the refinance GUI.</p>"},{"location":"reference/refi_calculator/gui/chart/#refi_calculator.gui.chart.AmortizationChart","title":"<code>AmortizationChart</code>","text":"<p>               Bases: <code>Canvas</code></p> <p>Chart showing remaining balances for current and new loans.</p> <p>Attributes:</p> Name Type Description <code>width</code> <code>int</code> <p>Canvas width.</p> <code>height</code> <code>int</code> <p>Canvas height.</p> <code>padding</code> <code>dict[str, int]</code> <p>Plot padding.</p> Source code in <code>src/refi_calculator/gui/chart.py</code> <pre><code>class AmortizationChart(tk.Canvas):\n    \"\"\"Chart showing remaining balances for current and new loans.\n\n    Attributes:\n        width: Canvas width.\n        height: Canvas height.\n        padding: Plot padding.\n    \"\"\"\n\n    width: int\n    height: int\n    padding: dict[str, int]\n\n    def __init__(\n        self,\n        parent: tk.Misc,\n        width: int = 400,\n        height: int = 220,\n    ):\n        \"\"\"Initialize AmortizationChart.\n\n        Args:\n            parent: Parent Tkinter widget (any widget subclass).\n            width: Canvas width.\n            height: Canvas height.\n        \"\"\"\n        super().__init__(\n            parent,\n            width=width,\n            height=height,\n            bg=\"white\",\n            highlightthickness=1,\n            highlightbackground=\"#ccc\",\n        )\n        self.width = width\n        self.height = height\n        self.padding = {\n            \"left\": 60,\n            \"right\": 20,\n            \"top\": 30,\n            \"bottom\": 40,\n        }\n\n    def plot(\n        self,\n        current_schedule: list[dict],\n        new_schedule: list[dict],\n    ) -&gt; None:\n        \"\"\"Plot remaining balances for both loans.\n\n        Args:\n            current_schedule: Monthly data for the current loan.\n            new_schedule: Monthly data for the new loan.\n        \"\"\"\n        self.delete(\"all\")\n        if not current_schedule or not new_schedule:\n            return\n\n        current_months = [row[\"month\"] for row in current_schedule]\n        current_balances = [row[\"balance\"] for row in current_schedule]\n        new_months = [row[\"month\"] for row in new_schedule]\n        new_balances = [row[\"balance\"] for row in new_schedule]\n\n        max_month = max(current_months[-1], new_months[-1])\n        if max_month == 0:\n            max_month = 1\n\n        all_balances = [0.0]\n        all_balances.extend(current_balances)\n        all_balances.extend(new_balances)\n        max_balance = max(all_balances)\n        y_min = 0.0\n        y_max = max_balance if max_balance &gt; 0 else 1.0\n        y_range = y_max - y_min if y_max != y_min else 1.0\n\n        plot_w = self.width - self.padding[\"left\"] - self.padding[\"right\"]\n        plot_h = self.height - self.padding[\"top\"] - self.padding[\"bottom\"]\n\n        def to_canvas(month: int, balance: float) -&gt; tuple[float, float]:\n            x = self.padding[\"left\"] + (month / max_month) * plot_w\n            y = self.padding[\"top\"] + (1 - (balance - y_min) / y_range) * plot_h\n            return x, y\n\n        current_points = [to_canvas(m, b) for m, b in zip(current_months, current_balances)]\n        new_points = [to_canvas(m, b) for m, b in zip(new_months, new_balances)]\n\n        if len(current_points) &gt; 1:\n            self.create_line(\n                *[value for point in current_points for value in point],\n                fill=\"#dc2626\",\n                width=2,\n                smooth=True,\n            )\n        if len(new_points) &gt; 1:\n            self.create_line(\n                *[value for point in new_points for value in point],\n                fill=\"#2563eb\",\n                width=2,\n                smooth=True,\n            )\n\n        left = self.padding[\"left\"]\n        bottom = self.height - self.padding[\"bottom\"]\n        right = self.width - self.padding[\"right\"]\n\n        self.create_line(left, self.padding[\"top\"], left, bottom, fill=\"#333\")\n        self.create_line(left, bottom, right, bottom, fill=\"#333\")\n\n        for month in build_month_ticks(max_month):\n            x = left + (month / max_month) * plot_w\n            self.create_line(x, bottom, x, bottom + 5, fill=\"#999\")\n            self.create_text(\n                x,\n                bottom + 12,\n                text=f\"{month} mo\",\n                anchor=tk.N,\n                font=(\"Segoe UI\", 7),\n                fill=\"#666\",\n            )\n\n        for value in build_linear_ticks(y_min, y_max):\n            y = self.padding[\"top\"] + (1 - (value - y_min) / y_range) * plot_h\n            self.create_line(left - 5, y, left, y, fill=\"#999\")\n            self.create_text(\n                left - 8,\n                y,\n                text=f\"${value / 1000:.0f}k\",\n                anchor=tk.E,\n                font=(\"Segoe UI\", 7),\n                fill=\"#666\",\n            )\n\n        self.create_text(\n            self.padding[\"left\"],\n            self.padding[\"top\"] - 6,\n            text=\"Remaining Balance\",\n            anchor=tk.SW,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n        self.create_text(\n            self.width // 2,\n            self.height - 8,\n            text=\"Months\",\n            font=(\"Segoe UI\", 8),\n            fill=\"#666\",\n        )\n\n        legend_x = self.width - self.padding[\"right\"] - 90\n        self.create_line(legend_x, 14, legend_x + 24, 14, fill=\"#dc2626\", width=2)\n        self.create_text(\n            legend_x + 28,\n            14,\n            text=\"Current\",\n            anchor=tk.W,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n        self.create_line(legend_x, 26, legend_x + 24, 26, fill=\"#2563eb\", width=2)\n        self.create_text(\n            legend_x + 28,\n            26,\n            text=\"New\",\n            anchor=tk.W,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n</code></pre>"},{"location":"reference/refi_calculator/gui/chart/#refi_calculator.gui.chart.AmortizationChart.__init__","title":"<code>__init__(parent, width=400, height=220)</code>","text":"<p>Initialize AmortizationChart.</p> <p>Parameters:</p> Name Type Description Default <code>parent</code> <code>Misc</code> <p>Parent Tkinter widget (any widget subclass).</p> required <code>width</code> <code>int</code> <p>Canvas width.</p> <code>400</code> <code>height</code> <code>int</code> <p>Canvas height.</p> <code>220</code> Source code in <code>src/refi_calculator/gui/chart.py</code> <pre><code>def __init__(\n    self,\n    parent: tk.Misc,\n    width: int = 400,\n    height: int = 220,\n):\n    \"\"\"Initialize AmortizationChart.\n\n    Args:\n        parent: Parent Tkinter widget (any widget subclass).\n        width: Canvas width.\n        height: Canvas height.\n    \"\"\"\n    super().__init__(\n        parent,\n        width=width,\n        height=height,\n        bg=\"white\",\n        highlightthickness=1,\n        highlightbackground=\"#ccc\",\n    )\n    self.width = width\n    self.height = height\n    self.padding = {\n        \"left\": 60,\n        \"right\": 20,\n        \"top\": 30,\n        \"bottom\": 40,\n    }\n</code></pre>"},{"location":"reference/refi_calculator/gui/chart/#refi_calculator.gui.chart.AmortizationChart.plot","title":"<code>plot(current_schedule, new_schedule)</code>","text":"<p>Plot remaining balances for both loans.</p> <p>Parameters:</p> Name Type Description Default <code>current_schedule</code> <code>list[dict]</code> <p>Monthly data for the current loan.</p> required <code>new_schedule</code> <code>list[dict]</code> <p>Monthly data for the new loan.</p> required Source code in <code>src/refi_calculator/gui/chart.py</code> <pre><code>def plot(\n    self,\n    current_schedule: list[dict],\n    new_schedule: list[dict],\n) -&gt; None:\n    \"\"\"Plot remaining balances for both loans.\n\n    Args:\n        current_schedule: Monthly data for the current loan.\n        new_schedule: Monthly data for the new loan.\n    \"\"\"\n    self.delete(\"all\")\n    if not current_schedule or not new_schedule:\n        return\n\n    current_months = [row[\"month\"] for row in current_schedule]\n    current_balances = [row[\"balance\"] for row in current_schedule]\n    new_months = [row[\"month\"] for row in new_schedule]\n    new_balances = [row[\"balance\"] for row in new_schedule]\n\n    max_month = max(current_months[-1], new_months[-1])\n    if max_month == 0:\n        max_month = 1\n\n    all_balances = [0.0]\n    all_balances.extend(current_balances)\n    all_balances.extend(new_balances)\n    max_balance = max(all_balances)\n    y_min = 0.0\n    y_max = max_balance if max_balance &gt; 0 else 1.0\n    y_range = y_max - y_min if y_max != y_min else 1.0\n\n    plot_w = self.width - self.padding[\"left\"] - self.padding[\"right\"]\n    plot_h = self.height - self.padding[\"top\"] - self.padding[\"bottom\"]\n\n    def to_canvas(month: int, balance: float) -&gt; tuple[float, float]:\n        x = self.padding[\"left\"] + (month / max_month) * plot_w\n        y = self.padding[\"top\"] + (1 - (balance - y_min) / y_range) * plot_h\n        return x, y\n\n    current_points = [to_canvas(m, b) for m, b in zip(current_months, current_balances)]\n    new_points = [to_canvas(m, b) for m, b in zip(new_months, new_balances)]\n\n    if len(current_points) &gt; 1:\n        self.create_line(\n            *[value for point in current_points for value in point],\n            fill=\"#dc2626\",\n            width=2,\n            smooth=True,\n        )\n    if len(new_points) &gt; 1:\n        self.create_line(\n            *[value for point in new_points for value in point],\n            fill=\"#2563eb\",\n            width=2,\n            smooth=True,\n        )\n\n    left = self.padding[\"left\"]\n    bottom = self.height - self.padding[\"bottom\"]\n    right = self.width - self.padding[\"right\"]\n\n    self.create_line(left, self.padding[\"top\"], left, bottom, fill=\"#333\")\n    self.create_line(left, bottom, right, bottom, fill=\"#333\")\n\n    for month in build_month_ticks(max_month):\n        x = left + (month / max_month) * plot_w\n        self.create_line(x, bottom, x, bottom + 5, fill=\"#999\")\n        self.create_text(\n            x,\n            bottom + 12,\n            text=f\"{month} mo\",\n            anchor=tk.N,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n\n    for value in build_linear_ticks(y_min, y_max):\n        y = self.padding[\"top\"] + (1 - (value - y_min) / y_range) * plot_h\n        self.create_line(left - 5, y, left, y, fill=\"#999\")\n        self.create_text(\n            left - 8,\n            y,\n            text=f\"${value / 1000:.0f}k\",\n            anchor=tk.E,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n\n    self.create_text(\n        self.padding[\"left\"],\n        self.padding[\"top\"] - 6,\n        text=\"Remaining Balance\",\n        anchor=tk.SW,\n        font=(\"Segoe UI\", 7),\n        fill=\"#666\",\n    )\n    self.create_text(\n        self.width // 2,\n        self.height - 8,\n        text=\"Months\",\n        font=(\"Segoe UI\", 8),\n        fill=\"#666\",\n    )\n\n    legend_x = self.width - self.padding[\"right\"] - 90\n    self.create_line(legend_x, 14, legend_x + 24, 14, fill=\"#dc2626\", width=2)\n    self.create_text(\n        legend_x + 28,\n        14,\n        text=\"Current\",\n        anchor=tk.W,\n        font=(\"Segoe UI\", 7),\n        fill=\"#666\",\n    )\n    self.create_line(legend_x, 26, legend_x + 24, 26, fill=\"#2563eb\", width=2)\n    self.create_text(\n        legend_x + 28,\n        26,\n        text=\"New\",\n        anchor=tk.W,\n        font=(\"Segoe UI\", 7),\n        fill=\"#666\",\n    )\n</code></pre>"},{"location":"reference/refi_calculator/gui/chart/#refi_calculator.gui.chart.SavingsChart","title":"<code>SavingsChart</code>","text":"<p>               Bases: <code>Canvas</code></p> <p>Canvas that draws cumulative savings / NPV trends.</p> <p>Attributes:</p> Name Type Description <code>width</code> <code>int</code> <p>Canvas width.</p> <code>height</code> <code>int</code> <p>Canvas height.</p> <code>padding</code> <code>dict[str, int]</code> <p>Padding around the plot area.</p> Source code in <code>src/refi_calculator/gui/chart.py</code> <pre><code>class SavingsChart(tk.Canvas):\n    \"\"\"Canvas that draws cumulative savings / NPV trends.\n\n    Attributes:\n        width: Canvas width.\n        height: Canvas height.\n        padding: Padding around the plot area.\n    \"\"\"\n\n    width: int\n    height: int\n    padding: dict[str, int]\n\n    def __init__(\n        self,\n        parent: tk.Misc,\n        width: int = 400,\n        height: int = 200,\n    ):\n        \"\"\"Initialize SavingsChart.\n\n        Args:\n            parent: Parent Tkinter widget (any widget subclass).\n            width: Canvas width.\n            height: Canvas height.\n        \"\"\"\n        super().__init__(\n            parent,\n            width=width,\n            height=height,\n            bg=\"white\",\n            highlightthickness=1,\n            highlightbackground=\"#ccc\",\n        )\n        self.width = width\n        self.height = height\n        self.padding = {\n            \"left\": 60,\n            \"right\": 20,\n            \"top\": 20,\n            \"bottom\": 40,\n        }\n\n    def plot(\n        self,\n        data: list[tuple[int, float, float]],\n        breakeven: int | None,\n    ) -&gt; None:\n        \"\"\"Plot cumulative savings tuples and optional breakeven marker.\n\n        Args:\n            data: List of (month, nominal savings, NPV savings) tuples.\n            breakeven: Optional breakeven month to mark on the chart.\n        \"\"\"\n        self.delete(\"all\")\n        min_number_of_data_points = 2\n        if len(data) &lt; min_number_of_data_points:\n            return\n\n        months = [d[0] for d in data]\n        nominal = [d[1] for d in data]\n        npv = [d[2] for d in data]\n\n        all_values = nominal + npv\n        y_min, y_max = min(all_values), max(all_values)\n        if y_min == y_max:\n            expansion = abs(y_max) or 1.0\n            y_min -= expansion / 2\n            y_max += expansion / 2\n        y_range = y_max - y_min\n        if y_range == 0:\n            y_range = 1.0\n\n        plot_w = self.width - self.padding[\"left\"] - self.padding[\"right\"]\n        plot_h = self.height - self.padding[\"top\"] - self.padding[\"bottom\"]\n\n        max_month = max(months)\n        if max_month == 0:\n            max_month = 1\n\n        def to_canvas(month: int, value: float) -&gt; tuple[float, float]:\n            x = self.padding[\"left\"] + (month / max_month) * plot_w\n            y = self.padding[\"top\"] + (1 - (value - y_min) / y_range) * plot_h\n            return x, y\n\n        if y_min &lt; 0 &lt; y_max:\n            self._draw_zero_reference(to_canvas)\n\n        if breakeven and breakeven &lt;= max_month:\n            self._draw_breakeven_line(breakeven, to_canvas)\n\n        nominal_points = self._canvas_points(months, nominal, to_canvas)\n        npv_points = self._canvas_points(months, npv, to_canvas)\n\n        self._render_series(nominal_points, \"#2563eb\")\n        self._render_series(npv_points, \"#16a34a\")\n\n        left = self.padding[\"left\"]\n        right = self.width - self.padding[\"right\"]\n        bottom = self.height - self.padding[\"bottom\"]\n\n        self._draw_axis_lines(left, bottom, right)\n        self._draw_month_ticks(left, bottom, plot_w, max_month)\n        self._draw_value_ticks(left, plot_h, bottom, y_min, y_max, y_range)\n        self._draw_range_labels(left, bottom, y_min, y_max)\n        self._draw_legend()\n\n    def _draw_zero_reference(\n        self,\n        to_canvas: Callable[[int, float], tuple[float, float]],\n    ) -&gt; None:\n        _, zero_y = to_canvas(0, 0)\n        self.create_line(\n            self.padding[\"left\"],\n            zero_y,\n            self.width - self.padding[\"right\"],\n            zero_y,\n            fill=\"#ccc\",\n            dash=(4, 2),\n        )\n        self.create_text(\n            self.padding[\"left\"] + 4,\n            zero_y - 5,\n            text=\"0 cumulative savings\",\n            anchor=tk.SW,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n\n    def _draw_breakeven_line(\n        self,\n        breakeven: int,\n        to_canvas: Callable[[int, float], tuple[float, float]],\n    ) -&gt; None:\n        be_x, _ = to_canvas(breakeven, 0)\n        self.create_line(\n            be_x,\n            self.padding[\"top\"],\n            be_x,\n            self.height - self.padding[\"bottom\"],\n            fill=\"#888\",\n            dash=(2, 2),\n        )\n        self.create_text(\n            be_x,\n            self.padding[\"top\"] - 5,\n            text=f\"BE: {breakeven}mo\",\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n\n    def _canvas_points(\n        self,\n        months: list[int],\n        values: list[float],\n        to_canvas: Callable[[int, float], tuple[float, float]],\n    ) -&gt; list[tuple[float, float]]:\n        return [to_canvas(month, value) for month, value in zip(months, values)]\n\n    def _render_series(self, points: list[tuple[float, float]], color: str) -&gt; None:\n        if len(points) &gt; 1:\n            self.create_line(\n                *[coord for point in points for coord in point],\n                fill=color,\n                width=2,\n                smooth=True,\n            )\n\n    def _draw_axis_lines(self, left: float, bottom: float, right: float) -&gt; None:\n        self.create_line(\n            left,\n            self.padding[\"top\"],\n            left,\n            bottom,\n            fill=\"#333\",\n        )\n        self.create_line(\n            left,\n            bottom,\n            right,\n            bottom,\n            fill=\"#333\",\n        )\n\n    def _draw_month_ticks(\n        self,\n        left: float,\n        bottom: float,\n        plot_width: float,\n        max_month: int,\n    ) -&gt; None:\n        for month in build_month_ticks(max_month):\n            x = left + (month / max_month) * plot_width\n            self.create_line(x, bottom, x, bottom + 5, fill=\"#999\")\n            self.create_text(\n                x,\n                bottom + 12,\n                text=f\"{month} mo\",\n                anchor=tk.N,\n                font=(\"Segoe UI\", 7),\n                fill=\"#666\",\n            )\n\n    def _draw_value_ticks(\n        self,\n        left: float,\n        plot_height: float,\n        bottom: float,\n        y_min: float,\n        y_max: float,\n        y_range: float,\n    ) -&gt; None:\n        top = self.padding[\"top\"]\n        for value in build_linear_ticks(y_min, y_max):\n            y = top + (1 - (value - y_min) / y_range) * plot_height\n            self.create_line(left - 5, y, left, y, fill=\"#999\")\n            self.create_text(\n                left - 8,\n                y,\n                text=f\"${value / 1000:.0f}k\",\n                anchor=tk.E,\n                font=(\"Segoe UI\", 7),\n                fill=\"#666\",\n            )\n\n    def _draw_range_labels(self, left: float, bottom: float, y_min: float, y_max: float) -&gt; None:\n        self.create_text(\n            self.width // 2,\n            self.height - 8,\n            text=\"Months\",\n            font=(\"Segoe UI\", 8),\n            fill=\"#666\",\n        )\n        self.create_text(\n            left - 5,\n            self.padding[\"top\"],\n            text=f\"${y_max / 1000:.0f}k\",\n            anchor=tk.E,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n        self.create_text(\n            left - 5,\n            bottom,\n            text=f\"${y_min / 1000:.0f}k\",\n            anchor=tk.E,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n\n    def _draw_legend(self) -&gt; None:\n        legend_x = self.width - self.padding[\"right\"] - 90\n        self.create_line(legend_x, 14, legend_x + 24, 14, fill=\"#2563eb\", width=2)\n        self.create_text(\n            legend_x + 28,\n            14,\n            text=\"Nominal\",\n            anchor=tk.W,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n        self.create_line(legend_x, 26, legend_x + 24, 26, fill=\"#16a34a\", width=2)\n        self.create_text(\n            legend_x + 28,\n            26,\n            text=\"NPV\",\n            anchor=tk.W,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n</code></pre>"},{"location":"reference/refi_calculator/gui/chart/#refi_calculator.gui.chart.SavingsChart.__init__","title":"<code>__init__(parent, width=400, height=200)</code>","text":"<p>Initialize SavingsChart.</p> <p>Parameters:</p> Name Type Description Default <code>parent</code> <code>Misc</code> <p>Parent Tkinter widget (any widget subclass).</p> required <code>width</code> <code>int</code> <p>Canvas width.</p> <code>400</code> <code>height</code> <code>int</code> <p>Canvas height.</p> <code>200</code> Source code in <code>src/refi_calculator/gui/chart.py</code> <pre><code>def __init__(\n    self,\n    parent: tk.Misc,\n    width: int = 400,\n    height: int = 200,\n):\n    \"\"\"Initialize SavingsChart.\n\n    Args:\n        parent: Parent Tkinter widget (any widget subclass).\n        width: Canvas width.\n        height: Canvas height.\n    \"\"\"\n    super().__init__(\n        parent,\n        width=width,\n        height=height,\n        bg=\"white\",\n        highlightthickness=1,\n        highlightbackground=\"#ccc\",\n    )\n    self.width = width\n    self.height = height\n    self.padding = {\n        \"left\": 60,\n        \"right\": 20,\n        \"top\": 20,\n        \"bottom\": 40,\n    }\n</code></pre>"},{"location":"reference/refi_calculator/gui/chart/#refi_calculator.gui.chart.SavingsChart.plot","title":"<code>plot(data, breakeven)</code>","text":"<p>Plot cumulative savings tuples and optional breakeven marker.</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>list[tuple[int, float, float]]</code> <p>List of (month, nominal savings, NPV savings) tuples.</p> required <code>breakeven</code> <code>int | None</code> <p>Optional breakeven month to mark on the chart.</p> required Source code in <code>src/refi_calculator/gui/chart.py</code> <pre><code>def plot(\n    self,\n    data: list[tuple[int, float, float]],\n    breakeven: int | None,\n) -&gt; None:\n    \"\"\"Plot cumulative savings tuples and optional breakeven marker.\n\n    Args:\n        data: List of (month, nominal savings, NPV savings) tuples.\n        breakeven: Optional breakeven month to mark on the chart.\n    \"\"\"\n    self.delete(\"all\")\n    min_number_of_data_points = 2\n    if len(data) &lt; min_number_of_data_points:\n        return\n\n    months = [d[0] for d in data]\n    nominal = [d[1] for d in data]\n    npv = [d[2] for d in data]\n\n    all_values = nominal + npv\n    y_min, y_max = min(all_values), max(all_values)\n    if y_min == y_max:\n        expansion = abs(y_max) or 1.0\n        y_min -= expansion / 2\n        y_max += expansion / 2\n    y_range = y_max - y_min\n    if y_range == 0:\n        y_range = 1.0\n\n    plot_w = self.width - self.padding[\"left\"] - self.padding[\"right\"]\n    plot_h = self.height - self.padding[\"top\"] - self.padding[\"bottom\"]\n\n    max_month = max(months)\n    if max_month == 0:\n        max_month = 1\n\n    def to_canvas(month: int, value: float) -&gt; tuple[float, float]:\n        x = self.padding[\"left\"] + (month / max_month) * plot_w\n        y = self.padding[\"top\"] + (1 - (value - y_min) / y_range) * plot_h\n        return x, y\n\n    if y_min &lt; 0 &lt; y_max:\n        self._draw_zero_reference(to_canvas)\n\n    if breakeven and breakeven &lt;= max_month:\n        self._draw_breakeven_line(breakeven, to_canvas)\n\n    nominal_points = self._canvas_points(months, nominal, to_canvas)\n    npv_points = self._canvas_points(months, npv, to_canvas)\n\n    self._render_series(nominal_points, \"#2563eb\")\n    self._render_series(npv_points, \"#16a34a\")\n\n    left = self.padding[\"left\"]\n    right = self.width - self.padding[\"right\"]\n    bottom = self.height - self.padding[\"bottom\"]\n\n    self._draw_axis_lines(left, bottom, right)\n    self._draw_month_ticks(left, bottom, plot_w, max_month)\n    self._draw_value_ticks(left, plot_h, bottom, y_min, y_max, y_range)\n    self._draw_range_labels(left, bottom, y_min, y_max)\n    self._draw_legend()\n</code></pre>"},{"location":"reference/refi_calculator/gui/market_chart/","title":"market_chart","text":"<p>Canvas for plotting historical market rates.</p>"},{"location":"reference/refi_calculator/gui/market_chart/#refi_calculator.gui.market_chart.MarketChart","title":"<code>MarketChart</code>","text":"<p>               Bases: <code>Canvas</code></p> <p>Simple line chart for market rate series.</p> <p>Attributes:</p> Name Type Description <code>width</code> <code>int</code> <p>Canvas width.</p> <code>height</code> <code>int</code> <p>Canvas height.</p> <code>padding</code> <code>dict[str, int]</code> <p>Chart padding.</p> Source code in <code>src/refi_calculator/gui/market_chart.py</code> <pre><code>class MarketChart(tk.Canvas):\n    \"\"\"Simple line chart for market rate series.\n\n    Attributes:\n        width: Canvas width.\n        height: Canvas height.\n        padding: Chart padding.\n    \"\"\"\n\n    width: int\n    height: int\n    padding: dict[str, int]\n\n    def __init__(self, parent: tk.Misc, width: int = 780, height: int = 220):\n        \"\"\"Initialize the canvas.\n\n        Args:\n            parent: Parent widget for the chart.\n            width: Chart width in pixels.\n            height: Chart height in pixels.\n        \"\"\"\n        super().__init__(\n            parent,\n            width=width,\n            height=height,\n            bg=\"white\",\n            highlightthickness=1,\n            highlightbackground=\"#ccc\",\n        )\n        self.width = width\n        self.height = height\n        self.padding = {\"left\": 70, \"right\": 20, \"top\": 20, \"bottom\": 40}\n\n    def plot(self, series_data: dict[str, list[tuple[datetime, float]]]) -&gt; None:\n        \"\"\"Draw a multi-line chart for the supplied rate series.\n\n        Args:\n            series_data: Mapping of series label to date/rate pairs (newest-first).\n        \"\"\"\n        self.delete(\"all\")\n        filtered = {\n            label: list(reversed(points)) for label, points in series_data.items() if points\n        }\n        if not filtered:\n            return\n\n        all_values = [rate for points in filtered.values() for _, rate in points]\n        if not all_values:\n            return\n\n        min_rate = min(all_values)\n        max_rate = max(all_values)\n        rate_range = max_rate - min_rate if max_rate != min_rate else 1\n\n        plot_width = self.width - self.padding[\"left\"] - self.padding[\"right\"]\n        plot_height = self.height - self.padding[\"top\"] - self.padding[\"bottom\"]\n\n        def x_coord(idx: int, total: int) -&gt; float:\n            return self.padding[\"left\"] + (idx / max(total - 1, 1)) * plot_width\n\n        def y_coord(value: float) -&gt; float:\n            return self.padding[\"top\"] + (1 - (value - min_rate) / rate_range) * plot_height\n\n        colors = [\"#2563eb\", \"#ec4899\", \"#16a34a\", \"#f59e0b\"]\n        for idx, (label, points) in enumerate(filtered.items()):\n            coords = [\n                (x_coord(i, len(points)), y_coord(rate)) for i, (_, rate) in enumerate(points)\n            ]\n            min_coords = 2\n            if len(coords) &lt; min_coords:\n                continue\n            self.create_line(\n                *[component for point in coords for component in point],\n                fill=colors[idx % len(colors)],\n                width=2,\n            )\n\n        self.create_line(\n            self.padding[\"left\"],\n            self.padding[\"top\"],\n            self.padding[\"left\"],\n            self.height - self.padding[\"bottom\"],\n            fill=\"#333\",\n        )\n        self.create_line(\n            self.padding[\"left\"],\n            self.height - self.padding[\"bottom\"],\n            self.width - self.padding[\"right\"],\n            self.height - self.padding[\"bottom\"],\n            fill=\"#333\",\n        )\n\n        # Y-axis ticks\n        tick_count_y = 4\n        for idx in range(tick_count_y + 1):\n            rate_value = min_rate + (rate_range / tick_count_y) * idx\n            y = y_coord(rate_value)\n            self.create_line(\n                self.padding[\"left\"] - 8,\n                y,\n                self.padding[\"left\"],\n                y,\n                fill=\"#333\",\n            )\n            self.create_text(\n                self.padding[\"left\"] - 14,\n                y,\n                text=f\"{rate_value:.2f}%\",\n                anchor=tk.E,\n                font=(\"Segoe UI\", 7),\n                fill=\"#666\",\n            )\n\n        # X-axis ticks\n        sample_points = next(iter(filtered.values()))\n        total_points = len(sample_points)\n        tick_step = max(1, total_points // 5)\n        tick_indices = list(range(0, total_points, tick_step))\n        if total_points - 1 not in tick_indices:\n            tick_indices.append(total_points - 1)\n\n        for idx in tick_indices:\n            x = x_coord(idx, total_points)\n            self.create_line(\n                x,\n                self.height - self.padding[\"bottom\"],\n                x,\n                self.height - self.padding[\"bottom\"] + 4,\n                fill=\"#333\",\n            )\n            date_label = sample_points[idx][0].strftime(\"%Y-%m-%d\")\n            self.create_text(\n                x,\n                self.height - self.padding[\"bottom\"] + 14,\n                text=date_label,\n                anchor=tk.N,\n                font=(\"Segoe UI\", 7),\n                fill=\"#666\",\n            )\n\n        # Axis labels\n        self.create_text(\n            self.width // 2,\n            self.height - 10,\n            text=\"Date (oldest \u2192 newest)\",\n            font=(\"Segoe UI\", 8, \"bold\"),\n            fill=\"#444\",\n        )\n        self.create_text(\n            self.padding[\"left\"] - 55,\n            (self.height + self.padding[\"top\"] - self.padding[\"bottom\"]) // 2,\n            text=\"Rate (%)\",\n            angle=90,\n            font=(\"Segoe UI\", 8, \"bold\"),\n            fill=\"#444\",\n        )\n\n        legend_x = self.width - self.padding[\"right\"] - 110\n        legend_y = self.padding[\"top\"] + 10\n        for idx, label in enumerate(filtered.keys()):\n            color = colors[idx % len(colors)]\n            self.create_line(\n                legend_x,\n                legend_y + idx * 16,\n                legend_x + 20,\n                legend_y + idx * 16,\n                fill=color,\n                width=2,\n            )\n            self.create_text(\n                legend_x + 25,\n                legend_y + idx * 16,\n                text=label,\n                anchor=tk.W,\n                font=(\"Segoe UI\", 8),\n                fill=\"#444\",\n            )\n</code></pre>"},{"location":"reference/refi_calculator/gui/market_chart/#refi_calculator.gui.market_chart.MarketChart.__init__","title":"<code>__init__(parent, width=780, height=220)</code>","text":"<p>Initialize the canvas.</p> <p>Parameters:</p> Name Type Description Default <code>parent</code> <code>Misc</code> <p>Parent widget for the chart.</p> required <code>width</code> <code>int</code> <p>Chart width in pixels.</p> <code>780</code> <code>height</code> <code>int</code> <p>Chart height in pixels.</p> <code>220</code> Source code in <code>src/refi_calculator/gui/market_chart.py</code> <pre><code>def __init__(self, parent: tk.Misc, width: int = 780, height: int = 220):\n    \"\"\"Initialize the canvas.\n\n    Args:\n        parent: Parent widget for the chart.\n        width: Chart width in pixels.\n        height: Chart height in pixels.\n    \"\"\"\n    super().__init__(\n        parent,\n        width=width,\n        height=height,\n        bg=\"white\",\n        highlightthickness=1,\n        highlightbackground=\"#ccc\",\n    )\n    self.width = width\n    self.height = height\n    self.padding = {\"left\": 70, \"right\": 20, \"top\": 20, \"bottom\": 40}\n</code></pre>"},{"location":"reference/refi_calculator/gui/market_chart/#refi_calculator.gui.market_chart.MarketChart.plot","title":"<code>plot(series_data)</code>","text":"<p>Draw a multi-line chart for the supplied rate series.</p> <p>Parameters:</p> Name Type Description Default <code>series_data</code> <code>dict[str, list[tuple[datetime, float]]]</code> <p>Mapping of series label to date/rate pairs (newest-first).</p> required Source code in <code>src/refi_calculator/gui/market_chart.py</code> <pre><code>def plot(self, series_data: dict[str, list[tuple[datetime, float]]]) -&gt; None:\n    \"\"\"Draw a multi-line chart for the supplied rate series.\n\n    Args:\n        series_data: Mapping of series label to date/rate pairs (newest-first).\n    \"\"\"\n    self.delete(\"all\")\n    filtered = {\n        label: list(reversed(points)) for label, points in series_data.items() if points\n    }\n    if not filtered:\n        return\n\n    all_values = [rate for points in filtered.values() for _, rate in points]\n    if not all_values:\n        return\n\n    min_rate = min(all_values)\n    max_rate = max(all_values)\n    rate_range = max_rate - min_rate if max_rate != min_rate else 1\n\n    plot_width = self.width - self.padding[\"left\"] - self.padding[\"right\"]\n    plot_height = self.height - self.padding[\"top\"] - self.padding[\"bottom\"]\n\n    def x_coord(idx: int, total: int) -&gt; float:\n        return self.padding[\"left\"] + (idx / max(total - 1, 1)) * plot_width\n\n    def y_coord(value: float) -&gt; float:\n        return self.padding[\"top\"] + (1 - (value - min_rate) / rate_range) * plot_height\n\n    colors = [\"#2563eb\", \"#ec4899\", \"#16a34a\", \"#f59e0b\"]\n    for idx, (label, points) in enumerate(filtered.items()):\n        coords = [\n            (x_coord(i, len(points)), y_coord(rate)) for i, (_, rate) in enumerate(points)\n        ]\n        min_coords = 2\n        if len(coords) &lt; min_coords:\n            continue\n        self.create_line(\n            *[component for point in coords for component in point],\n            fill=colors[idx % len(colors)],\n            width=2,\n        )\n\n    self.create_line(\n        self.padding[\"left\"],\n        self.padding[\"top\"],\n        self.padding[\"left\"],\n        self.height - self.padding[\"bottom\"],\n        fill=\"#333\",\n    )\n    self.create_line(\n        self.padding[\"left\"],\n        self.height - self.padding[\"bottom\"],\n        self.width - self.padding[\"right\"],\n        self.height - self.padding[\"bottom\"],\n        fill=\"#333\",\n    )\n\n    # Y-axis ticks\n    tick_count_y = 4\n    for idx in range(tick_count_y + 1):\n        rate_value = min_rate + (rate_range / tick_count_y) * idx\n        y = y_coord(rate_value)\n        self.create_line(\n            self.padding[\"left\"] - 8,\n            y,\n            self.padding[\"left\"],\n            y,\n            fill=\"#333\",\n        )\n        self.create_text(\n            self.padding[\"left\"] - 14,\n            y,\n            text=f\"{rate_value:.2f}%\",\n            anchor=tk.E,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n\n    # X-axis ticks\n    sample_points = next(iter(filtered.values()))\n    total_points = len(sample_points)\n    tick_step = max(1, total_points // 5)\n    tick_indices = list(range(0, total_points, tick_step))\n    if total_points - 1 not in tick_indices:\n        tick_indices.append(total_points - 1)\n\n    for idx in tick_indices:\n        x = x_coord(idx, total_points)\n        self.create_line(\n            x,\n            self.height - self.padding[\"bottom\"],\n            x,\n            self.height - self.padding[\"bottom\"] + 4,\n            fill=\"#333\",\n        )\n        date_label = sample_points[idx][0].strftime(\"%Y-%m-%d\")\n        self.create_text(\n            x,\n            self.height - self.padding[\"bottom\"] + 14,\n            text=date_label,\n            anchor=tk.N,\n            font=(\"Segoe UI\", 7),\n            fill=\"#666\",\n        )\n\n    # Axis labels\n    self.create_text(\n        self.width // 2,\n        self.height - 10,\n        text=\"Date (oldest \u2192 newest)\",\n        font=(\"Segoe UI\", 8, \"bold\"),\n        fill=\"#444\",\n    )\n    self.create_text(\n        self.padding[\"left\"] - 55,\n        (self.height + self.padding[\"top\"] - self.padding[\"bottom\"]) // 2,\n        text=\"Rate (%)\",\n        angle=90,\n        font=(\"Segoe UI\", 8, \"bold\"),\n        fill=\"#444\",\n    )\n\n    legend_x = self.width - self.padding[\"right\"] - 110\n    legend_y = self.padding[\"top\"] + 10\n    for idx, label in enumerate(filtered.keys()):\n        color = colors[idx % len(colors)]\n        self.create_line(\n            legend_x,\n            legend_y + idx * 16,\n            legend_x + 20,\n            legend_y + idx * 16,\n            fill=color,\n            width=2,\n        )\n        self.create_text(\n            legend_x + 25,\n            legend_y + idx * 16,\n            text=label,\n            anchor=tk.W,\n            font=(\"Segoe UI\", 8),\n            fill=\"#444\",\n        )\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/analysis_tab/","title":"analysis_tab","text":"<p>Analysis tab builders.</p>"},{"location":"reference/refi_calculator/gui/builders/analysis_tab/#refi_calculator.gui.builders.analysis_tab.build_holding_period_tab","title":"<code>build_holding_period_tab(app, parent)</code>","text":"<p>Build the holding period analysis tree.</p> <p>Parameters:</p> Name Type Description Default <code>app</code> <code>RefinanceCalculatorApp</code> <p>App instance owning the holding period data.</p> required <code>parent</code> <code>Frame</code> <p>Container frame for the holding period tab.</p> required Source code in <code>src/refi_calculator/gui/builders/analysis_tab.py</code> <pre><code>def build_holding_period_tab(\n    app: RefinanceCalculatorApp,\n    parent: ttk.Frame,\n) -&gt; None:\n    \"\"\"Build the holding period analysis tree.\n\n    Args:\n        app: App instance owning the holding period data.\n        parent: Container frame for the holding period tab.\n    \"\"\"\n    ttk.Label(parent, text=\"NPV by Holding Period\", font=(\"Segoe UI\", 10, \"bold\")).pack(\n        anchor=tk.W,\n        pady=(0, 10),\n    )\n\n    columns = (\"years\", \"nominal_savings\", \"npv\", \"npv_after_tax\", \"recommendation\")\n    app.holding_tree = ttk.Treeview(parent, columns=columns, show=\"headings\", height=12)\n\n    app.holding_tree.heading(\"years\", text=\"Hold (Years)\")\n    app.holding_tree.heading(\"nominal_savings\", text=\"Nominal Savings\")\n    app.holding_tree.heading(\"npv\", text=\"NPV\")\n    app.holding_tree.heading(\"npv_after_tax\", text=\"NPV (After-Tax)\")\n    app.holding_tree.heading(\"recommendation\", text=\"Recommendation\")\n\n    app.holding_tree.column(\"years\", width=80, anchor=tk.CENTER)\n    app.holding_tree.column(\"nominal_savings\", width=100, anchor=tk.CENTER)\n    app.holding_tree.column(\"npv\", width=90, anchor=tk.CENTER)\n    app.holding_tree.column(\"npv_after_tax\", width=100, anchor=tk.CENTER)\n    app.holding_tree.column(\"recommendation\", width=110, anchor=tk.CENTER)\n\n    app.holding_tree.pack(fill=tk.BOTH, expand=True)\n    ttk.Button(parent, text=\"Export Holding Period CSV\", command=app._export_holding_csv).pack(\n        pady=10,\n    )\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/analysis_tab/#refi_calculator.gui.builders.analysis_tab.build_sensitivity_tab","title":"<code>build_sensitivity_tab(app, parent)</code>","text":"<p>Build the sensitivity analysis tree.</p> <p>Parameters:</p> Name Type Description Default <code>app</code> <code>RefinanceCalculatorApp</code> <p>App instance owning the sensitivity data.</p> required <code>parent</code> <code>Frame</code> <p>Container frame for the sensitivity tab.</p> required Source code in <code>src/refi_calculator/gui/builders/analysis_tab.py</code> <pre><code>def build_sensitivity_tab(\n    app: RefinanceCalculatorApp,\n    parent: ttk.Frame,\n) -&gt; None:\n    \"\"\"Build the sensitivity analysis tree.\n\n    Args:\n        app: App instance owning the sensitivity data.\n        parent: Container frame for the sensitivity tab.\n    \"\"\"\n    ttk.Label(\n        parent,\n        text=\"Sensitivity: Breakeven by New Rate\",\n        font=(\"Segoe UI\", 10, \"bold\"),\n    ).pack(anchor=tk.W, pady=(0, 10))\n\n    columns = (\"rate\", \"savings\", \"simple_be\", \"npv_be\", \"npv_5yr\")\n    app.sens_tree = ttk.Treeview(parent, columns=columns, show=\"headings\", height=10)\n\n    app.sens_tree.heading(\"rate\", text=\"New Rate\")\n    app.sens_tree.heading(\"savings\", text=\"Monthly Savings\")\n    app.sens_tree.heading(\"simple_be\", text=\"Simple BE\")\n    app.sens_tree.heading(\"npv_be\", text=\"NPV BE\")\n    app.sens_tree.heading(\"npv_5yr\", text=\"5-Yr NPV\")\n\n    for col in columns:\n        app.sens_tree.column(col, width=90, anchor=tk.CENTER)\n\n    app.sens_tree.pack(fill=tk.BOTH, expand=True)\n    ttk.Button(\n        parent,\n        text=\"Export Sensitivity CSV\",\n        command=app._export_sensitivity_csv,\n    ).pack(pady=10)\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/helpers/","title":"helpers","text":"<p>Common helpers for building UI tabs.</p>"},{"location":"reference/refi_calculator/gui/builders/helpers/#refi_calculator.gui.builders.helpers.add_input","title":"<code>add_input(parent, label, var, row, on_change)</code>","text":"<p>Add a labeled entry bound to the provided StringVar.</p> <p>Parameters:</p> Name Type Description Default <code>parent</code> <code>Misc</code> <p>Parent frame hosting the entry row.</p> required <code>label</code> <code>str</code> <p>Text displayed next to the entry.</p> required <code>var</code> <code>StringVar</code> <p>StringVar that stores the entry value.</p> required <code>row</code> <code>int</code> <p>Grid row for the label/entry pair.</p> required <code>on_change</code> <code>Callable[[], None]</code> <p>Callback invoked when the value changes.</p> required Source code in <code>src/refi_calculator/gui/builders/helpers.py</code> <pre><code>def add_input(\n    parent: tk.Misc,\n    label: str,\n    var: tk.StringVar,\n    row: int,\n    on_change: Callable[[], None],\n) -&gt; None:\n    \"\"\"Add a labeled entry bound to the provided StringVar.\n\n    Args:\n        parent: Parent frame hosting the entry row.\n        label: Text displayed next to the entry.\n        var: StringVar that stores the entry value.\n        row: Grid row for the label/entry pair.\n        on_change: Callback invoked when the value changes.\n    \"\"\"\n    ttk.Label(parent, text=label).grid(row=row, column=0, sticky=tk.W, pady=3)\n    entry = ttk.Entry(parent, textvariable=var, width=14)\n    entry.grid(row=row, column=1, sticky=tk.E, pady=3, padx=(10, 0))\n    entry.bind(\"&lt;Return&gt;\", lambda e: on_change())\n    entry.bind(\"&lt;FocusOut&gt;\", lambda e: on_change())\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/helpers/#refi_calculator.gui.builders.helpers.add_option","title":"<code>add_option(parent, label, var, row, tooltip)</code>","text":"<p>Add a labeled option input with descriptive tooltip.</p> <p>Parameters:</p> Name Type Description Default <code>parent</code> <code>Misc</code> <p>Parent frame used for the input row.</p> required <code>label</code> <code>str</code> <p>Label text describing the option.</p> required <code>var</code> <code>StringVar</code> <p>StringVar associated with the option entry.</p> required <code>row</code> <code>int</code> <p>Row index inside the grid layout.</p> required <code>tooltip</code> <code>str</code> <p>Supplemental explanation shown alongside input.</p> required Source code in <code>src/refi_calculator/gui/builders/helpers.py</code> <pre><code>def add_option(\n    parent: tk.Misc,\n    label: str,\n    var: tk.StringVar,\n    row: int,\n    tooltip: str,\n) -&gt; None:\n    \"\"\"Add a labeled option input with descriptive tooltip.\n\n    Args:\n        parent: Parent frame used for the input row.\n        label: Label text describing the option.\n        var: StringVar associated with the option entry.\n        row: Row index inside the grid layout.\n        tooltip: Supplemental explanation shown alongside input.\n    \"\"\"\n    ttk.Label(parent, text=label).grid(row=row, column=0, sticky=tk.W, pady=6)\n    entry = ttk.Entry(parent, textvariable=var, width=10)\n    entry.grid(row=row, column=1, sticky=tk.W, pady=6, padx=(10, 15))\n    ttk.Label(parent, text=tooltip, font=(\"Segoe UI\", 8), foreground=\"#666\").grid(\n        row=row,\n        column=2,\n        sticky=tk.W,\n    )\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/helpers/#refi_calculator.gui.builders.helpers.result_block","title":"<code>result_block(parent, title, col)</code>","text":"<p>Create a title + value display block within a row.</p> <p>Parameters:</p> Name Type Description Default <code>parent</code> <code>Frame</code> <p>Parent frame that hosts the result block.</p> required <code>title</code> <code>str</code> <p>Title text displayed above the value.</p> required <code>col</code> <code>int</code> <p>Column index used for layout (unused but maintained for parity).</p> required <p>Returns:</p> Type Description <code>Label</code> <p>The label that shows the numeric value.</p> Source code in <code>src/refi_calculator/gui/builders/helpers.py</code> <pre><code>def result_block(\n    parent: ttk.Frame,\n    title: str,\n    col: int,\n) -&gt; ttk.Label:\n    \"\"\"Create a title + value display block within a row.\n\n    Args:\n        parent: Parent frame that hosts the result block.\n        title: Title text displayed above the value.\n        col: Column index used for layout (unused but maintained for parity).\n\n    Returns:\n        The label that shows the numeric value.\n    \"\"\"\n    frame = ttk.Frame(parent)\n    frame.pack(side=tk.LEFT, expand=True, fill=tk.X)\n    ttk.Label(frame, text=title, style=\"Header.TLabel\").pack()\n    label = ttk.Label(frame, text=\"\u2014\", style=\"Result.TLabel\")\n    label.pack(pady=2)\n    return label\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/info_tab/","title":"info_tab","text":"<p>Background and help info tab builders.</p>"},{"location":"reference/refi_calculator/gui/builders/info_tab/#refi_calculator.gui.builders.info_tab.build_background_tab","title":"<code>build_background_tab(app, parent)</code>","text":"<p>Build background information scroll area.</p> <p>Parameters:</p> Name Type Description Default <code>app</code> <code>RefinanceCalculatorApp</code> <p>Application instance that displays the background text.</p> required <code>parent</code> <code>Frame</code> <p>Frame that hosts the scrollable background content.</p> required Source code in <code>src/refi_calculator/gui/builders/info_tab.py</code> <pre><code>def build_background_tab(\n    app: RefinanceCalculatorApp,\n    parent: ttk.Frame,\n) -&gt; None:\n    \"\"\"Build background information scroll area.\n\n    Args:\n        app: Application instance that displays the background text.\n        parent: Frame that hosts the scrollable background content.\n    \"\"\"\n    canvas = tk.Canvas(parent, highlightthickness=0)\n    scrollbar = ttk.Scrollbar(parent, orient=\"vertical\", command=canvas.yview)\n    scroll_frame = ttk.Frame(canvas)\n\n    scroll_frame.bind(\n        \"&lt;Configure&gt;\",\n        lambda e: canvas.configure(scrollregion=canvas.bbox(\"all\")),\n    )\n    canvas_window = canvas.create_window((0, 0), window=scroll_frame, anchor=\"nw\")\n    canvas.configure(yscrollcommand=scrollbar.set)\n\n    def on_canvas_configure(event):\n        canvas.itemconfig(canvas_window, width=event.width)\n\n    canvas.bind(\"&lt;Configure&gt;\", on_canvas_configure)\n\n    canvas.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)\n    scrollbar.pack(side=tk.RIGHT, fill=tk.Y)\n\n    app._background_canvas = canvas\n    content = scroll_frame\n\n    ttk.Label(\n        content,\n        text=\"Refinancing: Background &amp; Concepts\",\n        font=(\"Segoe UI\", 12, \"bold\"),\n    ).pack(anchor=tk.W, pady=(0, 15))\n\n    sections = [\n        (\n            \"What is Refinancing?\",\n            \"Refinancing replaces your existing mortgage with a new loan, typically to secure a lower interest rate, change the loan term, or access home equity (cash-out refinance). The new loan pays off your old mortgage, and you begin making payments on the new terms.\\n\\nCommon reasons to refinance:\\n\u2022 Lower your interest rate and monthly payment\\n\u2022 Shorten your loan term to pay off faster\\n\u2022 Switch from adjustable-rate to fixed-rate (or vice versa)\\n\u2022 Access equity for major expenses (cash-out refi)\\n\u2022 Remove private mortgage insurance (PMI)\",\n        ),\n        (\n            \"Key Costs to Consider\",\n            \"Refinancing isn't free. Typical closing costs run 2-5% of the loan amount and may include:\\n\\n\u2022 Origination fees (lender charges)\\n\u2022 Appraisal fee ($300-$700)\\n\u2022 Title search and insurance\\n\u2022 Recording fees\\n\u2022 Credit report fee\\n\u2022 Prepaid interest, taxes, and insurance\\n\\nThese costs can be paid upfront, rolled into the loan balance, or covered by accepting a slightly higher rate (\\\"no-cost\\\" refi). Rolling costs into the loan means you'll pay interest on them over time.\",\n        ),\n        (\n            \"The Breakeven Concept\",\n            \"The fundamental question: How long until your monthly savings recoup the closing costs?\\n\\nSimple Breakeven = Closing Costs \u00f7 Monthly Savings\\n\\nExample: $6,000 in costs with $200/month savings = 30 months to breakeven.\\n\\nIf you plan to stay in the home longer than the breakeven period, refinancing likely makes sense. If you might move or refinance again before breakeven, you'll lose money on the transaction.\\n\\nImportant caveat: Simple breakeven ignores the time value of money. A dollar saved three years from now is worth less than a dollar today.\",\n        ),\n        (\n            \"Net Present Value (NPV)\",\n            'NPV provides a more sophisticated analysis by discounting future savings to today\\'s dollars. It accounts for the \"opportunity cost\" of your closing costs \u2014 what you could have earned by investing that money instead.\\n\\nNPV = -Closing Costs + \u03a3 (Monthly Savings / (1 + r)^n)\\n\\nWhere r is the monthly discount rate and n is the month number.\\n\\nA positive NPV means refinancing creates value even after accounting for opportunity cost. The higher the NPV, the more clearly beneficial the refinance.',\n        ),\n        (\n            \"The Term Reset Problem\",\n            \"A critical nuance many borrowers miss: refinancing often resets your amortization clock.\\n\\nExample: You're 5 years into a 30-year mortgage (25 years remaining). If you refinance into a new 30-year loan, you've added 5 years to your payoff timeline \u2014 even if your rate dropped.\\n\\nThis can dramatically increase total interest paid over the life of the loan, even with a lower rate. Solutions:\\n\u2022 Refinance into a shorter term (e.g., 20 or 15 years)\\n\u2022 Make extra principal payments to maintain your original payoff date\\n\u2022 Compare total interest paid, not just monthly payment\",\n        ),\n        (\n            \"Tax Implications\",\n            \"Mortgage interest is tax-deductible if you itemize deductions. This effectively reduces your true interest rate:\\n\\nAfter-Tax Rate = Nominal Rate \u00d7 (1 - Marginal Tax Rate)\\n\\nExample: 6% rate with 24% marginal bracket = 4.56% effective rate\\n\\nNote: The 2017 tax law changes increased the standard deduction significantly, meaning fewer homeowners now itemize. If you take the standard deduction, there's no mortgage interest tax benefit.\",\n        ),\n        (\n            \"Cash-Out Refinancing\",\n            \"A cash-out refi lets you borrow against your home equity, receiving the difference as cash. Your new loan balance equals your old balance plus the cash withdrawn plus closing costs.\\n\\nConsiderations:\\n\u2022 You're converting home equity into debt\\n\u2022 Monthly payment will likely increase even with a lower rate\\n\u2022 Interest on cash-out amounts above original loan may not be tax-deductible\\n\u2022 Good for consolidating high-interest debt or funding investments\\n\u2022 Risky if used for consumption or if home values decline\",\n        ),\n        (\n            \"When NOT to Refinance\",\n            \"Refinancing isn't always beneficial:\\n\\n\u2022 Short holding period: If you'll move before breakeven\\n\u2022 Small rate reduction: Less than 0.5-0.75% often doesn't justify costs\\n\u2022 Extended payoff: If resetting to 30 years significantly increases total interest\\n\u2022 High closing costs: Some lenders charge excessive fees\\n\u2022 Credit issues: Poor credit may mean higher rates or denial\\n\u2022 Equity constraints: Most lenders require 20%+ equity for best rates\\n\\nRule of thumb: A 1% rate reduction with typical costs usually breaks even in 2-3 years.\",\n        ),\n    ]\n\n    for title, text in sections:\n        ttk.Label(content, text=title, font=(\"Segoe UI\", 10, \"bold\")).pack(\n            anchor=tk.W,\n            pady=(10, 5),\n        )\n        ttk.Label(\n            content,\n            text=text,\n            wraplength=450,\n            justify=tk.LEFT,\n            font=(\"Segoe UI\", 9),\n        ).pack(anchor=tk.W, padx=(10, 0), pady=(0, 5))\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/info_tab/#refi_calculator.gui.builders.info_tab.build_help_tab","title":"<code>build_help_tab(app, parent)</code>","text":"<p>Build help info tab UI.</p> <p>Parameters:</p> Name Type Description Default <code>app</code> <code>RefinanceCalculatorApp</code> <p>Application instance that displays the help text.</p> required <code>parent</code> <code>Frame</code> <p>Frame that hosts the scrollable help content.</p> required Source code in <code>src/refi_calculator/gui/builders/info_tab.py</code> <pre><code>def build_help_tab(\n    app: RefinanceCalculatorApp,\n    parent: ttk.Frame,\n) -&gt; None:\n    \"\"\"Build help info tab UI.\n\n    Args:\n        app: Application instance that displays the help text.\n        parent: Frame that hosts the scrollable help content.\n    \"\"\"\n    canvas = tk.Canvas(parent, highlightthickness=0)\n    scrollbar = ttk.Scrollbar(parent, orient=\"vertical\", command=canvas.yview)\n    scroll_frame = ttk.Frame(canvas)\n\n    scroll_frame.bind(\n        \"&lt;Configure&gt;\",\n        lambda e: canvas.configure(scrollregion=canvas.bbox(\"all\")),\n    )\n    canvas_window = canvas.create_window((0, 0), window=scroll_frame, anchor=\"nw\")\n    canvas.configure(yscrollcommand=scrollbar.set)\n\n    def on_canvas_configure(event):\n        canvas.itemconfig(canvas_window, width=event.width)\n\n    canvas.bind(\"&lt;Configure&gt;\", on_canvas_configure)\n\n    canvas.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)\n    scrollbar.pack(side=tk.RIGHT, fill=tk.Y)\n\n    app._help_canvas = canvas\n    content = scroll_frame\n\n    ttk.Label(content, text=\"Application Help\", font=(\"Segoe UI\", 12, \"bold\")).pack(\n        anchor=tk.W,\n        pady=(0, 15),\n    )\n\n    sections = [\n        (\n            \"Overview\",\n            \"This calculator helps you analyze whether refinancing your mortgage makes financial sense. It goes beyond simple breakeven calculations to provide NPV analysis, tax-adjusted figures, sensitivity tables, and visualizations.\\n\\nAll calculations update automatically when you change inputs or press Enter.\",\n        ),\n        (\n            \"Calculator Tab\",\n            \"The main analysis screen with inputs and results.\\n\\nINPUTS - Current Loan:\\n\u2022 Balance ($): Your remaining mortgage principal\\n\u2022 Rate (%): Current annual interest rate\\n\u2022 Years Remaining: Time left on your current loan\\n\\nINPUTS - New Loan:\\n\u2022 Rate (%): Proposed new interest rate\\n\u2022 Term (years): Length of new loan (typically 15, 20, or 30)\\n\u2022 Closing Costs ($): Total refinance fees\\n\u2022 Cash Out ($): Additional amount to borrow (0 for rate-only refi)\\n\u2022 Opportunity Rate (%): Expected return on alternative investments\\n\u2022 Marginal Tax Rate (%): Your tax bracket (0 if you don't itemize)\",\n        ),\n        (\n            \"Rate Sensitivity Tab\",\n            'Shows how breakeven and NPV change at different new interest rates.\\n\\nThe table displays scenarios from your current rate down to the maximum reduction specified in Options (default: 2% in 0.25% steps).\\n\\nUse this to answer questions like:\\n\u2022 \"Should I wait for rates to drop further?\"\\n\u2022 \"How much does each 0.25% reduction improve my outcome?\"',\n        ),\n        (\n            \"Holding Period Tab\",\n            \"Shows NPV at various holding periods (1-20 years).\\n\\nThis helps when you're uncertain how long you'll stay in the home. The recommendation column provides guidance:\\n\u2022 Strong Yes (green): NPV &gt; $5,000\\n\u2022 Yes (dark green): NPV &gt; $0\\n\u2022 Marginal (orange): NPV between -$2,000 and $0\\n\u2022 No (red): NPV &lt; -$2,000\",\n        ),\n        (\n            \"Loan Visualizations Tab\",\n            \"The Loan Visualizations tab contains the annual amortization comparison table, which now includes a cumulative interest \u0394 column alongside colored savings/cost indicators so you can track how the refinance affects total interest year over year.\",\n        ),\n        (\n            \"Charts within Loan Visualizations\",\n            \"Two charts live on the Loan Visualizations tab:\\n\\n\"\n            \"1. Cumulative Savings Chart \u2014 shows nominal (blue) and NPV-adjusted (green) savings with monthly ticks, a labeled zero line, and a dashed vertical line marking the NPV breakeven point.\\n\"\n            \"2. Loan Balance Comparison Chart \u2014 plots the remaining balances for the current (red) and new (blue) loans so you can see how the term reset or accelerated payoff affects your timeline.\",\n        ),\n        (\n            \"Options Tab\",\n            \"Customize calculation parameters:\\n\\n\u2022 NPV Window (years): Time horizon for NPV calculation displayed on main tab\\n\u2022 Chart Horizon (years): How many years shown on the chart\\n\u2022 Max Rate Reduction (%): How far below current rate to show in sensitivity table\\n\u2022 Rate Step (%): Increment between rows in sensitivity table\",\n        ),\n        (\n            \"Exporting Data\",\n            \"Export buttons are available on Calculator, Rate Sensitivity, Holding Period, and Amortization tabs. Files are saved with timestamps to avoid overwriting.\",\n        ),\n    ]\n\n    for title, text in sections:\n        ttk.Label(content, text=title, font=(\"Segoe UI\", 10, \"bold\")).pack(\n            anchor=tk.W,\n            pady=(10, 5),\n        )\n        ttk.Label(\n            content,\n            text=text,\n            wraplength=450,\n            justify=tk.LEFT,\n            font=(\"Segoe UI\", 9),\n        ).pack(anchor=tk.W, padx=(10, 0), pady=(0, 5))\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/main_tab/","title":"main_tab","text":"<p>Main calculator tab builder.</p>"},{"location":"reference/refi_calculator/gui/builders/main_tab/#refi_calculator.gui.builders.main_tab.build_main_tab","title":"<code>build_main_tab(app, parent)</code>","text":"<p>Build the calculator tab inputs and result panels.</p> <p>Parameters:</p> Name Type Description Default <code>app</code> <code>RefinanceCalculatorApp</code> <p>Application instance that owns the tab data.</p> required <code>parent</code> <code>Frame</code> <p>Frame that hosts the calculator elements.</p> required Source code in <code>src/refi_calculator/gui/builders/main_tab.py</code> <pre><code>def build_main_tab(\n    app: RefinanceCalculatorApp,\n    parent: ttk.Frame,\n) -&gt; None:\n    \"\"\"Build the calculator tab inputs and result panels.\n\n    Args:\n        app: Application instance that owns the tab data.\n        parent: Frame that hosts the calculator elements.\n    \"\"\"\n    input_frame = ttk.Frame(parent)\n    input_frame.pack(fill=tk.X, pady=(0, 10))\n\n    current_frame = ttk.LabelFrame(input_frame, text=\"Current Loan\", padding=10)\n    current_frame.pack(side=tk.LEFT, fill=tk.BOTH, expand=True, padx=(0, 5))\n\n    add_input(current_frame, \"Balance ($):\", app.current_balance, 0, app._calculate)\n    add_input(current_frame, \"Rate (%):\", app.current_rate, 1, app._calculate)\n    add_input(current_frame, \"Years Remaining:\", app.current_remaining, 2, app._calculate)\n\n    new_frame = ttk.LabelFrame(input_frame, text=\"New Loan\", padding=10)\n    new_frame.pack(side=tk.LEFT, fill=tk.BOTH, expand=True, padx=(5, 0))\n\n    add_input(new_frame, \"Rate (%):\", app.new_rate, 0, app._calculate)\n    add_input(new_frame, \"Term (years):\", app.new_term, 1, app._calculate)\n    add_input(new_frame, \"Closing Costs ($):\", app.closing_costs, 2, app._calculate)\n    add_input(new_frame, \"Cash Out ($):\", app.cash_out, 3, app._calculate)\n    add_input(new_frame, \"Opportunity Rate (%):\", app.opportunity_rate, 4, app._calculate)\n    add_input(new_frame, \"Marginal Tax Rate (%):\", app.marginal_tax_rate, 5, app._calculate)\n\n    maintain_frame = ttk.Frame(new_frame)\n    maintain_frame.grid(row=6, column=0, columnspan=2, sticky=tk.W, pady=(8, 0))\n    ttk.Checkbutton(\n        maintain_frame,\n        text=\"Maintain current payment (extra \u2192 principal)\",\n        variable=app.maintain_payment,\n        command=app._calculate,\n    ).pack(anchor=tk.W)\n\n    btn_frame = ttk.Frame(parent)\n    btn_frame.pack(pady=8)\n    ttk.Button(btn_frame, text=\"Calculate\", command=app._calculate).pack(side=tk.LEFT, padx=5)\n    ttk.Button(btn_frame, text=\"Export CSV\", command=app._export_csv).pack(\n        side=tk.LEFT,\n        padx=5,\n    )\n\n    results_frame = ttk.LabelFrame(parent, text=\"Analysis Results\", padding=12)\n    results_frame.pack(fill=tk.BOTH, expand=True)\n\n    style = ttk.Style()\n    style.configure(\"Header.TLabel\", font=(\"Segoe UI\", 9, \"bold\"))\n    style.configure(\"Result.TLabel\", font=(\"Segoe UI\", 10))\n    style.configure(\"Big.TLabel\", font=(\"Segoe UI\", 13, \"bold\"))\n\n    app.pay_frame = ttk.Frame(results_frame)\n    app.pay_frame.pack(fill=tk.X, pady=(0, 8))\n    app.current_pmt_label = result_block(app.pay_frame, \"Current Payment\", 0)\n    app.new_pmt_label = result_block(app.pay_frame, \"New Payment\", 1)\n    app.savings_label = result_block(app.pay_frame, \"Monthly \u0394\", 2)\n\n    app.balance_frame = ttk.Frame(results_frame)\n    app.balance_frame.pack(fill=tk.X, pady=(0, 8))\n    app.new_balance_label = result_block(app.balance_frame, \"New Loan Balance\", 0)\n    app.cash_out_label = result_block(app.balance_frame, \"Cash Out\", 1)\n    result_block(app.balance_frame, \"\", 2)\n    app.balance_frame.pack_forget()\n\n    ttk.Separator(results_frame, orient=tk.HORIZONTAL).pack(fill=tk.X, pady=6)\n\n    be_frame = ttk.Frame(results_frame)\n    be_frame.pack(fill=tk.X, pady=(0, 8))\n    app.simple_be_label = result_block(be_frame, \"Simple Breakeven\", 0)\n    app.npv_be_label = result_block(be_frame, \"NPV Breakeven\", 1)\n\n    ttk.Separator(results_frame, orient=tk.HORIZONTAL).pack(fill=tk.X, pady=6)\n\n    int_frame = ttk.Frame(results_frame)\n    int_frame.pack(fill=tk.X, pady=(0, 8))\n    app.curr_int_label = result_block(int_frame, \"Current Total Interest\", 0)\n    app.new_int_label = result_block(int_frame, \"New Total Interest\", 1)\n    app.int_delta_label = result_block(int_frame, \"Interest \u0394\", 2)\n\n    ttk.Separator(results_frame, orient=tk.HORIZONTAL).pack(fill=tk.X, pady=6)\n\n    app.tax_section_label = ttk.Label(\n        results_frame,\n        text=\"After-Tax Analysis (0% marginal rate)\",\n        style=\"Header.TLabel\",\n    )\n    app.tax_section_label.pack(anchor=tk.W, pady=(0, 6))\n\n    tax_pay_frame = ttk.Frame(results_frame)\n    tax_pay_frame.pack(fill=tk.X, pady=(0, 8))\n    app.at_current_pmt_label = result_block(tax_pay_frame, \"Current (After-Tax)\", 0)\n    app.at_new_pmt_label = result_block(tax_pay_frame, \"New (After-Tax)\", 1)\n    app.at_savings_label = result_block(tax_pay_frame, \"Monthly \u0394 (A-T)\", 2)\n\n    tax_be_frame = ttk.Frame(results_frame)\n    tax_be_frame.pack(fill=tk.X, pady=(0, 8))\n    app.at_simple_be_label = result_block(tax_be_frame, \"Simple BE (A-T)\", 0)\n    app.at_npv_be_label = result_block(tax_be_frame, \"NPV BE (A-T)\", 1)\n    app.at_int_delta_label = result_block(tax_be_frame, \"Interest \u0394 (A-T)\", 2)\n\n    ttk.Separator(results_frame, orient=tk.HORIZONTAL).pack(fill=tk.X, pady=6)\n\n    app.accel_section_frame = ttk.Frame(results_frame)\n    app.accel_section_label = ttk.Label(\n        app.accel_section_frame,\n        text=\"Accelerated Payoff (Maintain Payment)\",\n        style=\"Header.TLabel\",\n    )\n    app.accel_section_label.pack(anchor=tk.W, pady=(0, 6))\n\n    accel_row1 = ttk.Frame(app.accel_section_frame)\n    accel_row1.pack(fill=tk.X, pady=(0, 8))\n    app.accel_months_label = result_block(accel_row1, \"Payoff Time\", 0)\n    app.accel_time_saved_label = result_block(accel_row1, \"Time Saved\", 1)\n    app.accel_interest_saved_label = result_block(accel_row1, \"Interest Saved\", 2)\n\n    ttk.Separator(app.accel_section_frame, orient=tk.HORIZONTAL).pack(fill=tk.X, pady=6)\n\n    npv_cost_frame = ttk.Frame(results_frame)\n    npv_cost_frame.pack(fill=tk.X, pady=(0, 8))\n\n    ttk.Label(results_frame, text=\"Total Cost NPV Analysis\", style=\"Header.TLabel\").pack(\n        anchor=tk.W,\n        pady=(0, 6),\n    )\n\n    npv_cost_row = ttk.Frame(results_frame)\n    npv_cost_row.pack(fill=tk.X, pady=(0, 8))\n    app.current_cost_npv_label = result_block(npv_cost_row, \"Current Loan NPV\", 0)\n    app.new_cost_npv_label = result_block(npv_cost_row, \"New Loan NPV\", 1)\n    app.cost_npv_advantage_label = result_block(npv_cost_row, \"NPV Advantage\", 2)\n\n    ttk.Separator(results_frame, orient=tk.HORIZONTAL).pack(fill=tk.X, pady=6)\n\n    npv_frame = ttk.Frame(results_frame)\n    npv_frame.pack(fill=tk.X)\n    app.npv_title_label = ttk.Label(\n        npv_frame,\n        text=\"5-Year NPV of Refinancing\",\n        style=\"Header.TLabel\",\n    )\n    app.npv_title_label.pack()\n    app.five_yr_npv_label = ttk.Label(npv_frame, text=\"$0\", style=\"Big.TLabel\")\n    app.five_yr_npv_label.pack(pady=3)\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/market_tab/","title":"market_tab","text":"<p>Builders for the market data tab.</p>"},{"location":"reference/refi_calculator/gui/builders/market_tab/#refi_calculator.gui.builders.market_tab.build_market_tab","title":"<code>build_market_tab(app, parent)</code>","text":"<p>Construct the market history tab in the main notebook.</p> <p>Parameters:</p> Name Type Description Default <code>app</code> <code>RefinanceCalculatorApp</code> <p>Application instance that owns the Tkinter state.</p> required <code>parent</code> <code>Frame</code> <p>Container frame that hosts the market history elements.</p> required Source code in <code>src/refi_calculator/gui/builders/market_tab.py</code> <pre><code>def build_market_tab(\n    app: RefinanceCalculatorApp,\n    parent: ttk.Frame,\n) -&gt; None:\n    \"\"\"Construct the market history tab in the main notebook.\n\n    Args:\n        app: Application instance that owns the Tkinter state.\n        parent: Container frame that hosts the market history elements.\n    \"\"\"\n    ttk.Label(\n        parent,\n        text=\"Historical Mortgage Rates\",\n        font=(\"Segoe UI\", 11, \"bold\"),\n    ).pack(anchor=tk.W, pady=(0, 6))\n\n    status_label = ttk.Label(\n        parent,\n        wraplength=720,\n        text=\"Loading market data...\",\n    )\n    status_label.pack(anchor=tk.W, pady=(0, 6))\n\n    cache_indicator = ttk.Label(\n        parent,\n        text=\"Cache: initializing...\",\n        font=(\"Segoe UI\", 8),\n        foreground=\"#666\",\n    )\n    cache_indicator.pack(anchor=tk.W, pady=(0, 6))\n\n    period_frame = ttk.Frame(parent)\n    period_frame.pack(fill=tk.X, pady=(0, 6))\n    ttk.Label(period_frame, text=\"Range:\").pack(side=tk.LEFT)\n    for label, value in MARKET_PERIOD_OPTIONS:\n        ttk.Radiobutton(\n            period_frame,\n            text=label,\n            variable=app.market_period_var,\n            value=value,\n            command=app._populate_market_tab,\n        ).pack(side=tk.LEFT, padx=(6, 0))\n\n    action_frame = ttk.Frame(parent)\n    action_frame.pack(fill=tk.X, pady=(0, 6))\n    ttk.Button(\n        action_frame,\n        text=\"Refresh Market Rates\",\n        command=app._refresh_market_data,\n    ).pack(side=tk.LEFT)\n\n    chart = MarketChart(parent)\n    chart.pack(fill=tk.X, pady=(0, 8))\n\n    table_frame = ttk.Frame(parent)\n    table_frame.pack(fill=tk.BOTH, expand=True)\n\n    labels = [\"Date\"] + [label for label, _ in MARKET_SERIES]\n    columns = (\"date\",) + tuple(label.lower().replace(\" \", \"_\") for label in labels[1:])\n    tree = ttk.Treeview(table_frame, columns=columns, show=\"headings\", height=12)\n    tree.heading(\"date\", text=\"Date\")\n    tree.column(\"date\", width=130, anchor=tk.W)\n    for label, column in zip(labels[1:], columns[1:]):\n        tree.heading(column, text=label)\n        tree.column(column, width=100, anchor=tk.E)\n\n    scrollbar = ttk.Scrollbar(table_frame, orient=\"vertical\", command=tree.yview)\n    tree.configure(yscrollcommand=scrollbar.set)\n    tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)\n    scrollbar.pack(side=tk.RIGHT, fill=tk.Y)\n\n    legend_frame = ttk.Frame(parent)\n    legend_frame.pack(anchor=tk.W, pady=(6, 0))\n    colors = [\"#2563eb\", \"#ec4899\", \"#16a34a\", \"#f59e0b\"]\n    for idx, (label, _) in enumerate(MARKET_SERIES):\n        swatch = tk.Label(\n            legend_frame,\n            text=\" \",\n            width=2,\n            bg=colors[idx % len(colors)],\n            relief=tk.SUNKEN,\n        )\n        swatch.pack(side=tk.LEFT, padx=(0, 2))\n        ttk.Label(\n            legend_frame,\n            text=label,\n            font=(\"Segoe UI\", 8),\n        ).pack(side=tk.LEFT, padx=(0, 8))\n\n    app.market_chart = chart\n    app.market_tree = tree\n    app._market_status_label = status_label\n    app._market_cache_indicator = cache_indicator\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/options_tab/","title":"options_tab","text":"<p>Options tab builder.</p>"},{"location":"reference/refi_calculator/gui/builders/options_tab/#refi_calculator.gui.builders.options_tab.build_options_tab","title":"<code>build_options_tab(app, parent)</code>","text":"<p>Build the options tab for NPV/chart settings.</p> <p>Parameters:</p> Name Type Description Default <code>app</code> <code>RefinanceCalculatorApp</code> <p>Application instance with option state.</p> required <code>parent</code> <code>Frame</code> <p>Frame that hosts the options controls.</p> required Source code in <code>src/refi_calculator/gui/builders/options_tab.py</code> <pre><code>def build_options_tab(\n    app: RefinanceCalculatorApp,\n    parent: ttk.Frame,\n) -&gt; None:\n    \"\"\"Build the options tab for NPV/chart settings.\n\n    Args:\n        app: Application instance with option state.\n        parent: Frame that hosts the options controls.\n    \"\"\"\n    ttk.Label(parent, text=\"Application Options\", font=(\"Segoe UI\", 10, \"bold\")).pack(\n        anchor=tk.W,\n        pady=(0, 15),\n    )\n\n    options_frame = ttk.LabelFrame(parent, text=\"NPV &amp; Chart Settings\", padding=15)\n    options_frame.pack(fill=tk.X, pady=(0, 10))\n\n    add_option(\n        options_frame,\n        \"NPV Window (years):\",\n        app.npv_window_years,\n        0,\n        \"Time horizon for NPV calculation (e.g., 5 = 5-Year NPV)\",\n    )\n    add_option(\n        options_frame,\n        \"Chart Horizon (years):\",\n        app.chart_horizon_years,\n        1,\n        \"How many years to display on the cumulative savings chart\",\n    )\n\n    sens_frame = ttk.LabelFrame(parent, text=\"Sensitivity Analysis\", padding=15)\n    sens_frame.pack(fill=tk.X, pady=(0, 10))\n\n    add_option(\n        sens_frame,\n        \"Max Rate Reduction (%):\",\n        app.sensitivity_max_reduction,\n        0,\n        \"How far below current rate to analyze (e.g., 2.0 = current - 2%)\",\n    )\n    add_option(\n        sens_frame,\n        \"Rate Step (%):\",\n        app.sensitivity_step,\n        1,\n        \"Increment between rate scenarios (e.g., 0.25)\",\n    )\n\n    ttk.Button(parent, text=\"Apply &amp; Recalculate\", command=app._calculate).pack(pady=15)\n    ttk.Label(\n        parent,\n        text=\"Changes take effect after clicking 'Apply &amp; Recalculate' or running a new calculation.\",\n        font=(\"Segoe UI\", 8),\n        foreground=\"#666\",\n    ).pack(anchor=tk.W)\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/visuals_tab/","title":"visuals_tab","text":"<p>Visual tab builders for amortization and chart views.</p>"},{"location":"reference/refi_calculator/gui/builders/visuals_tab/#refi_calculator.gui.builders.visuals_tab.build_amortization_tab","title":"<code>build_amortization_tab(app, parent)</code>","text":"<p>Build amortization comparison tree and summary.</p> <p>Parameters:</p> Name Type Description Default <code>app</code> <code>RefinanceCalculatorApp</code> <p>Application instance owning the amortization data.</p> required <code>parent</code> <code>Frame</code> <p>Frame that contains amortization widgets.</p> required Source code in <code>src/refi_calculator/gui/builders/visuals_tab.py</code> <pre><code>def build_amortization_tab(\n    app: RefinanceCalculatorApp,\n    parent: ttk.Frame,\n) -&gt; None:\n    \"\"\"Build amortization comparison tree and summary.\n\n    Args:\n        app: Application instance owning the amortization data.\n        parent: Frame that contains amortization widgets.\n    \"\"\"\n    ttk.Label(\n        parent,\n        text=\"Amortization Schedule Comparison (Annual)\",\n        font=(\"Segoe UI\", 10, \"bold\"),\n    ).pack(anchor=tk.W, pady=(0, 10))\n\n    tree_frame = ttk.Frame(parent)\n    tree_frame.pack(fill=tk.BOTH, expand=True)\n\n    columns = (\n        \"year\",\n        \"curr_principal\",\n        \"curr_interest\",\n        \"curr_balance\",\n        \"new_principal\",\n        \"new_interest\",\n        \"new_balance\",\n        \"int_diff\",\n        \"cum_interest_diff\",\n    )\n    app.amort_tree = ttk.Treeview(tree_frame, columns=columns, show=\"headings\", height=15)\n\n    app.amort_tree.heading(\"year\", text=\"Year\")\n    app.amort_tree.heading(\"curr_principal\", text=\"Curr Principal\")\n    app.amort_tree.heading(\"curr_interest\", text=\"Curr Interest\")\n    app.amort_tree.heading(\"curr_balance\", text=\"Curr Balance\")\n    app.amort_tree.heading(\"new_principal\", text=\"New Principal\")\n    app.amort_tree.heading(\"new_interest\", text=\"New Interest\")\n    app.amort_tree.heading(\"new_balance\", text=\"New Balance\")\n    app.amort_tree.heading(\"int_diff\", text=\"Interest \u0394\")\n    app.amort_tree.heading(\"cum_interest_diff\", text=\"Cumulative Interest \u0394\")\n\n    app.amort_tree.column(\"year\", width=45, anchor=tk.CENTER)\n    app.amort_tree.column(\"curr_principal\", width=85, anchor=tk.E)\n    app.amort_tree.column(\"curr_interest\", width=80, anchor=tk.E)\n    app.amort_tree.column(\"curr_balance\", width=85, anchor=tk.E)\n    app.amort_tree.column(\"new_principal\", width=85, anchor=tk.E)\n    app.amort_tree.column(\"new_interest\", width=80, anchor=tk.E)\n    app.amort_tree.column(\"new_balance\", width=85, anchor=tk.E)\n    app.amort_tree.column(\"int_diff\", width=70, anchor=tk.E)\n    app.amort_tree.column(\"cum_interest_diff\", width=105, anchor=tk.E)\n\n    y_scroll = ttk.Scrollbar(tree_frame, orient=\"vertical\", command=app.amort_tree.yview)\n    app.amort_tree.configure(yscrollcommand=y_scroll.set)\n\n    app.amort_tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)\n    y_scroll.pack(side=tk.RIGHT, fill=tk.Y)\n\n    summary_frame = ttk.LabelFrame(parent, text=\"Cumulative Totals\", padding=10)\n    summary_frame.pack(fill=tk.X, pady=(10, 5))\n\n    summary_cols = ttk.Frame(summary_frame)\n    summary_cols.pack(fill=tk.X)\n\n    app.amort_curr_total_int = result_block(summary_cols, \"Current Total Interest\", 0)\n    app.amort_new_total_int = result_block(summary_cols, \"New Total Interest\", 1)\n    app.amort_int_savings = result_block(summary_cols, \"Interest Savings\", 2)\n\n    ttk.Button(\n        parent,\n        text=\"Export Amortization CSV\",\n        command=app._export_amortization_csv,\n    ).pack(pady=10)\n</code></pre>"},{"location":"reference/refi_calculator/gui/builders/visuals_tab/#refi_calculator.gui.builders.visuals_tab.build_chart_tab","title":"<code>build_chart_tab(app, parent)</code>","text":"<p>Build cumulative savings chart tab.</p> <p>Parameters:</p> Name Type Description Default <code>app</code> <code>RefinanceCalculatorApp</code> <p>App instance providing chart parameters.</p> required <code>parent</code> <code>Frame</code> <p>Frame used for the chart canvas.</p> required Source code in <code>src/refi_calculator/gui/builders/visuals_tab.py</code> <pre><code>def build_chart_tab(\n    app: RefinanceCalculatorApp,\n    parent: ttk.Frame,\n) -&gt; None:\n    \"\"\"Build cumulative savings chart tab.\n\n    Args:\n        app: App instance providing chart parameters.\n        parent: Frame used for the chart canvas.\n    \"\"\"\n    chart_years = int(float(app.chart_horizon_years.get() or 10))\n    ttk.Label(\n        parent,\n        text=f\"Cumulative Savings Over Time ({chart_years} Years)\",\n        font=(\"Segoe UI\", 10, \"bold\"),\n    ).pack(anchor=tk.W, pady=(0, 10))\n\n    app.chart = SavingsChart(parent, width=480, height=280)\n    app.chart.pack(fill=tk.BOTH, expand=True)\n\n    ttk.Label(\n        parent,\n        text=\"Loan Balance Comparison\",\n        font=(\"Segoe UI\", 10, \"bold\"),\n    ).pack(anchor=tk.W, pady=(18, 6))\n\n    app.amortization_balance_chart = AmortizationChart(parent, width=480, height=240)\n    app.amortization_balance_chart.pack(fill=tk.BOTH, expand=True)\n</code></pre>"},{"location":"reference/refi_calculator/web/app/","title":"app","text":"<p>Streamlit web interface for the refinance calculator.</p>"},{"location":"reference/refi_calculator/web/app/#refi_calculator.web.app.main","title":"<code>main()</code>","text":"<p>Render the refinance calculator Streamlit application.</p> Source code in <code>src/refi_calculator/web/app.py</code> <pre><code>def main() -&gt; None:\n    \"\"\"Render the refinance calculator Streamlit application.\"\"\"\n    logger.debug(\"Rendering Streamlit refinance calculator main screen.\")\n    ensure_option_state()\n    st.set_page_config(\n        page_title=\"Refinance Calculator\",\n        layout=\"wide\",\n    )\n\n    st.title(\"Refinance Calculator\")\n    st.write(\n        \"Use the inputs below to compare refinancing scenarios, cash-out needs, \"\n        \"and after-tax impacts before reviewing the cumulative savings timeline.\",\n    )\n\n    calc_tab, analysis_tab, visuals_tab, market_tab, options_tab, info_tab = st.tabs(\n        [\n            \"Calculator\",\n            \"Analysis\",\n            \"Loan Visualizations\",\n            \"Market\",\n            \"Options\",\n            \"Info\",\n        ],\n    )\n\n    inputs: CalculatorInputs | None = None\n    analysis: RefinanceAnalysis | None = None\n\n    with calc_tab:\n        inputs = collect_inputs()\n        analysis = run_analysis(inputs)\n        render_results(inputs, analysis)\n\n    if inputs is None or analysis is None:\n        return\n\n    sensitivity_data, holding_period_data, amortization_data = prepare_auxiliary_data(inputs)\n\n    with analysis_tab:\n        render_analysis_tab(inputs, sensitivity_data, holding_period_data)\n\n    with visuals_tab:\n        render_loan_visualizations_tab(analysis, amortization_data)\n\n    with market_tab:\n        render_market_tab()\n\n    with options_tab:\n        render_options_tab(inputs)\n\n    with info_tab:\n        render_info_tab()\n</code></pre>"},{"location":"reference/refi_calculator/web/calculator/","title":"calculator","text":"<p>Helpers for gathering calculator inputs and orchestrating core analysis.</p>"},{"location":"reference/refi_calculator/web/calculator/#refi_calculator.web.calculator.CalculatorInputs","title":"<code>CalculatorInputs</code>  <code>dataclass</code>","text":"<p>Inputs collected from the Streamlit UI.</p> <p>Attributes:</p> Name Type Description <code>current_balance</code> <code>float</code> <p>Current loan balance.</p> <code>current_rate</code> <code>float</code> <p>Current percentage rate on the existing loan.</p> <code>current_remaining_years</code> <code>float</code> <p>Remaining years on the current mortgage.</p> <code>new_rate</code> <code>float</code> <p>Candidate refinance rate percentage.</p> <code>new_term_years</code> <code>float</code> <p>Term for the new loan in years.</p> <code>closing_costs</code> <code>float</code> <p>Expected closing costs for the refinance.</p> <code>cash_out</code> <code>float</code> <p>Cash out amount requested with the refinance.</p> <code>opportunity_rate</code> <code>float</code> <p>Discount rate for NPV computations (percent).</p> <code>marginal_tax_rate</code> <code>float</code> <p>Marginal tax rate for after-tax calculations (percent).</p> <code>npv_window_years</code> <code>int</code> <p>Horizon used to compute NPV savings.</p> <code>chart_horizon_years</code> <code>int</code> <p>Years displayed on the cumulative savings chart.</p> <code>maintain_payment</code> <code>bool</code> <p>Whether the borrower maintains the current payment level.</p> <code>sensitivity_max_reduction</code> <code>float</code> <p>Max reduction below the current rate for sensitivity scenarios.</p> <code>sensitivity_step</code> <code>float</code> <p>Step size between successive sensitivity scenarios.</p> Source code in <code>src/refi_calculator/web/calculator.py</code> <pre><code>@dataclass\nclass CalculatorInputs:\n    \"\"\"Inputs collected from the Streamlit UI.\n\n    Attributes:\n        current_balance: Current loan balance.\n        current_rate: Current percentage rate on the existing loan.\n        current_remaining_years: Remaining years on the current mortgage.\n        new_rate: Candidate refinance rate percentage.\n        new_term_years: Term for the new loan in years.\n        closing_costs: Expected closing costs for the refinance.\n        cash_out: Cash out amount requested with the refinance.\n        opportunity_rate: Discount rate for NPV computations (percent).\n        marginal_tax_rate: Marginal tax rate for after-tax calculations (percent).\n        npv_window_years: Horizon used to compute NPV savings.\n        chart_horizon_years: Years displayed on the cumulative savings chart.\n        maintain_payment: Whether the borrower maintains the current payment level.\n        sensitivity_max_reduction: Max reduction below the current rate for sensitivity scenarios.\n        sensitivity_step: Step size between successive sensitivity scenarios.\n    \"\"\"\n\n    current_balance: float\n    current_rate: float\n    current_remaining_years: float\n    new_rate: float\n    new_term_years: float\n    closing_costs: float\n    cash_out: float\n    opportunity_rate: float\n    marginal_tax_rate: float\n    npv_window_years: int\n    chart_horizon_years: int\n    maintain_payment: bool\n    sensitivity_max_reduction: float\n    sensitivity_step: float\n</code></pre>"},{"location":"reference/refi_calculator/web/calculator/#refi_calculator.web.calculator.collect_inputs","title":"<code>collect_inputs()</code>","text":"<p>Gather user inputs from Streamlit widgets.</p> <p>Returns:</p> Type Description <code>CalculatorInputs</code> <p>CalculatorInputs populated with the current values.</p> Source code in <code>src/refi_calculator/web/calculator.py</code> <pre><code>def collect_inputs() -&gt; CalculatorInputs:\n    \"\"\"Gather user inputs from Streamlit widgets.\n\n    Returns:\n        CalculatorInputs populated with the current values.\n    \"\"\"\n    st.subheader(\"Loan Inputs\")\n    current_col, new_col = st.columns(2)\n\n    with current_col:\n        current_balance = st.number_input(\n            \"Balance ($)\",\n            min_value=0.0,\n            value=DEFAULT_CURRENT_BALANCE,\n            step=1_000.0,\n        )\n        current_rate = st.number_input(\n            \"Rate (%):\",\n            min_value=0.0,\n            value=DEFAULT_CURRENT_RATE,\n            step=0.01,\n        )\n        current_remaining_years = st.number_input(\n            \"Years Remaining\",\n            min_value=0.5,\n            value=DEFAULT_CURRENT_REMAINING,\n            step=0.5,\n        )\n\n    with new_col:\n        new_rate = st.number_input(\n            \"New Rate (%):\",\n            min_value=0.0,\n            value=DEFAULT_NEW_RATE,\n            step=0.01,\n        )\n        new_term_years = st.number_input(\n            \"Term (years)\",\n            min_value=1.0,\n            value=DEFAULT_NEW_TERM,\n            step=0.5,\n        )\n        closing_costs = st.number_input(\n            \"Closing Costs ($)\",\n            min_value=0.0,\n            value=DEFAULT_CLOSING_COSTS,\n            step=500.0,\n        )\n        cash_out = st.number_input(\n            \"Cash Out ($)\",\n            min_value=0.0,\n            value=DEFAULT_CASH_OUT,\n            step=500.0,\n        )\n\n    with st.expander(\"Advanced options\", expanded=False):\n        opportunity_rate = st.number_input(\n            \"Opportunity Rate (%)\",\n            min_value=0.0,\n            max_value=100.0,\n            value=st.session_state[\"opportunity_rate\"],\n            step=0.1,\n            key=\"opportunity_rate\",\n        )\n        marginal_tax_rate = st.number_input(\n            \"Marginal Tax Rate (%)\",\n            min_value=0.0,\n            max_value=100.0,\n            value=st.session_state[\"marginal_tax_rate\"],\n            step=0.1,\n            key=\"marginal_tax_rate\",\n        )\n        npv_window_years = int(\n            st.number_input(\n                \"NPV Window (years)\",\n                min_value=1,\n                max_value=30,\n                value=st.session_state[\"npv_window_years\"],\n                step=1,\n                key=\"npv_window_years\",\n            ),\n        )\n        maintain_payment = st.checkbox(\n            \"Maintain current payment (extra \u2192 principal)\",\n            value=st.session_state[\"maintain_payment\"],\n            key=\"maintain_payment\",\n        )\n        st.caption(\"Opportunity cost and tax rate feed into the NPV and savings dashboard.\")\n\n    chart_horizon_years = int(st.session_state[\"chart_horizon_years\"])\n    sensitivity_max_reduction = float(st.session_state[\"sensitivity_max_reduction\"])\n    sensitivity_step = float(st.session_state[\"sensitivity_step\"])\n\n    return CalculatorInputs(\n        current_balance=current_balance,\n        current_rate=current_rate,\n        current_remaining_years=current_remaining_years,\n        new_rate=new_rate,\n        new_term_years=new_term_years,\n        closing_costs=closing_costs,\n        cash_out=cash_out,\n        opportunity_rate=opportunity_rate,\n        marginal_tax_rate=marginal_tax_rate,\n        npv_window_years=npv_window_years,\n        chart_horizon_years=chart_horizon_years,\n        maintain_payment=maintain_payment,\n        sensitivity_max_reduction=sensitivity_max_reduction,\n        sensitivity_step=sensitivity_step,\n    )\n</code></pre>"},{"location":"reference/refi_calculator/web/calculator/#refi_calculator.web.calculator.ensure_option_state","title":"<code>ensure_option_state()</code>","text":"<p>Restore default option values in Streamlit session state.</p> Source code in <code>src/refi_calculator/web/calculator.py</code> <pre><code>def ensure_option_state() -&gt; None:\n    \"\"\"Restore default option values in Streamlit session state.\"\"\"\n    for key, default in OPTION_STATE_DEFAULTS.items():\n        st.session_state.setdefault(key, default)\n    for key, default in ADVANCED_STATE_DEFAULTS.items():\n        st.session_state.setdefault(key, default)\n</code></pre>"},{"location":"reference/refi_calculator/web/calculator/#refi_calculator.web.calculator.prepare_auxiliary_data","title":"<code>prepare_auxiliary_data(inputs)</code>","text":"<p>Compute supporting tables for the analysis tab.</p> <p>Parameters:</p> Name Type Description Default <code>inputs</code> <code>CalculatorInputs</code> <p>Combination of all UI parameters.</p> required <p>Returns:</p> Type Description <code>tuple[list[dict], list[dict], list[dict]]</code> <p>Tuple of sensitivity, holding period, and amortization data.</p> Source code in <code>src/refi_calculator/web/calculator.py</code> <pre><code>def prepare_auxiliary_data(\n    inputs: CalculatorInputs,\n) -&gt; tuple[list[dict], list[dict], list[dict]]:\n    \"\"\"Compute supporting tables for the analysis tab.\n\n    Args:\n        inputs: Combination of all UI parameters.\n\n    Returns:\n        Tuple of sensitivity, holding period, and amortization data.\n    \"\"\"\n    rate_steps = _build_rate_steps(\n        inputs.current_rate,\n        inputs.sensitivity_max_reduction,\n        inputs.sensitivity_step,\n    )\n    sensitivity_data = run_sensitivity(\n        inputs.current_balance,\n        inputs.current_rate / 100,\n        inputs.current_remaining_years,\n        inputs.new_term_years,\n        inputs.closing_costs,\n        inputs.opportunity_rate / 100,\n        rate_steps,\n        inputs.npv_window_years,\n    )\n    holding_period_data = run_holding_period_analysis(\n        inputs.current_balance,\n        inputs.current_rate / 100,\n        inputs.current_remaining_years,\n        inputs.new_rate / 100,\n        inputs.new_term_years,\n        inputs.closing_costs,\n        inputs.opportunity_rate / 100,\n        inputs.marginal_tax_rate / 100,\n        HOLDING_PERIODS,\n        cash_out=inputs.cash_out,\n    )\n    amortization_data = generate_comparison_schedule(\n        inputs.current_balance,\n        inputs.current_rate / 100,\n        inputs.current_remaining_years,\n        inputs.new_rate / 100,\n        inputs.new_term_years,\n        inputs.closing_costs,\n        cash_out=inputs.cash_out,\n        maintain_payment=inputs.maintain_payment,\n    )\n    return sensitivity_data, holding_period_data, amortization_data\n</code></pre>"},{"location":"reference/refi_calculator/web/calculator/#refi_calculator.web.calculator.run_analysis","title":"<code>run_analysis(inputs)</code>","text":"<p>Run the refinance analysis calculations.</p> <p>Parameters:</p> Name Type Description Default <code>inputs</code> <code>CalculatorInputs</code> <p>Inputs captured from the UI.</p> required <p>Returns:</p> Type Description <code>RefinanceAnalysis</code> <p>Analysis results for the provided scenario.</p> Source code in <code>src/refi_calculator/web/calculator.py</code> <pre><code>def run_analysis(inputs: CalculatorInputs) -&gt; RefinanceAnalysis:\n    \"\"\"Run the refinance analysis calculations.\n\n    Args:\n        inputs: Inputs captured from the UI.\n\n    Returns:\n        Analysis results for the provided scenario.\n    \"\"\"\n    return analyze_refinance(\n        current_balance=inputs.current_balance,\n        current_rate=inputs.current_rate / 100,\n        current_remaining_years=inputs.current_remaining_years,\n        new_rate=inputs.new_rate / 100,\n        new_term_years=inputs.new_term_years,\n        closing_costs=inputs.closing_costs,\n        cash_out=inputs.cash_out,\n        opportunity_rate=inputs.opportunity_rate / 100,\n        npv_window_years=inputs.npv_window_years,\n        chart_horizon_years=inputs.chart_horizon_years,\n        marginal_tax_rate=inputs.marginal_tax_rate / 100,\n        maintain_payment=inputs.maintain_payment,\n    )\n</code></pre>"},{"location":"reference/refi_calculator/web/formatting/","title":"formatting","text":"<p>Helpers for formatting values displayed in the Streamlit interface.</p>"},{"location":"reference/refi_calculator/web/formatting/#refi_calculator.web.formatting.format_currency","title":"<code>format_currency(value)</code>","text":"<p>Format a numeric value as whole-dollar currency.</p> <p>Parameters:</p> Name Type Description Default <code>value</code> <code>float</code> <p>Numeric value to format.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Dollar-formatted string without decimal cents.</p> Source code in <code>src/refi_calculator/web/formatting.py</code> <pre><code>def format_currency(value: float) -&gt; str:\n    \"\"\"Format a numeric value as whole-dollar currency.\n\n    Args:\n        value: Numeric value to format.\n\n    Returns:\n        Dollar-formatted string without decimal cents.\n    \"\"\"\n    return f\"${value:,.0f}\"\n</code></pre>"},{"location":"reference/refi_calculator/web/formatting/#refi_calculator.web.formatting.format_months","title":"<code>format_months(value)</code>","text":"<p>Describe a month count alongside its equivalent in years.</p> <p>Parameters:</p> Name Type Description Default <code>value</code> <code>float | int | None</code> <p>Number of months to convert.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Human-friendly string or \"N/A\" when value is missing.</p> Source code in <code>src/refi_calculator/web/formatting.py</code> <pre><code>def format_months(value: float | int | None) -&gt; str:\n    \"\"\"Describe a month count alongside its equivalent in years.\n\n    Args:\n        value: Number of months to convert.\n\n    Returns:\n        Human-friendly string or \"N/A\" when value is missing.\n    \"\"\"\n    if value is None:\n        return \"N/A\"\n    months = int(value)\n    years = value / 12\n    return f\"{months} mo ({years:.1f} yr)\"\n</code></pre>"},{"location":"reference/refi_calculator/web/formatting/#refi_calculator.web.formatting.format_optional_currency","title":"<code>format_optional_currency(value)</code>","text":"<p>Format an optional numeric value as currency, falling back to N/A.</p> <p>Parameters:</p> Name Type Description Default <code>value</code> <code>float | None</code> <p>Optional numeric value.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Formatted currency or \"N/A\" when no value is present.</p> Source code in <code>src/refi_calculator/web/formatting.py</code> <pre><code>def format_optional_currency(value: float | None) -&gt; str:\n    \"\"\"Format an optional numeric value as currency, falling back to N/A.\n\n    Args:\n        value: Optional numeric value.\n\n    Returns:\n        Formatted currency or \"N/A\" when no value is present.\n    \"\"\"\n    if value is None:\n        return \"N/A\"\n    return format_currency(value)\n</code></pre>"},{"location":"reference/refi_calculator/web/formatting/#refi_calculator.web.formatting.format_savings_delta","title":"<code>format_savings_delta(value)</code>","text":"<p>Invert savings sign to match user-facing storytelling.</p> <p>Parameters:</p> Name Type Description Default <code>value</code> <code>float</code> <p>Value representing savings.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Signed string reflecting the UX messaging used in the GUI.</p> Source code in <code>src/refi_calculator/web/formatting.py</code> <pre><code>def format_savings_delta(value: float) -&gt; str:\n    \"\"\"Invert savings sign to match user-facing storytelling.\n\n    Args:\n        value: Value representing savings.\n\n    Returns:\n        Signed string reflecting the UX messaging used in the GUI.\n    \"\"\"\n    prefix = \"-\" if value &gt;= 0 else \"+\"\n    return f\"{prefix}{format_currency(abs(value))}\"\n</code></pre>"},{"location":"reference/refi_calculator/web/formatting/#refi_calculator.web.formatting.format_signed_currency","title":"<code>format_signed_currency(value)</code>","text":"<p>Format a signed value with explicit plus/minus.</p> <p>Parameters:</p> Name Type Description Default <code>value</code> <code>float</code> <p>Value to format with sign.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Signed currency string to highlight deltas.</p> Source code in <code>src/refi_calculator/web/formatting.py</code> <pre><code>def format_signed_currency(value: float) -&gt; str:\n    \"\"\"Format a signed value with explicit plus/minus.\n\n    Args:\n        value: Value to format with sign.\n\n    Returns:\n        Signed currency string to highlight deltas.\n    \"\"\"\n    prefix = \"+\" if value &gt;= 0 else \"-\"\n    return f\"{prefix}{format_currency(abs(value))}\"\n</code></pre>"},{"location":"reference/refi_calculator/web/info/","title":"info","text":"<p>Background and help content shared on the informational tab.</p>"},{"location":"reference/refi_calculator/web/info/#refi_calculator.web.info.render_info_tab","title":"<code>render_info_tab()</code>","text":"<p>Render background and help guidance content.</p> Source code in <code>src/refi_calculator/web/info.py</code> <pre><code>def render_info_tab() -&gt; None:\n    \"\"\"Render background and help guidance content.\"\"\"\n    background_tab, help_tab = st.tabs([\"Background\", \"Help\"])\n\n    with background_tab:\n        for title, text in BACKGROUND_SECTIONS:\n            st.markdown(f\"**{title}**\")\n            st.markdown(text)\n            st.divider()\n\n    with help_tab:\n        for title, text in HELP_SECTIONS:\n            st.markdown(f\"**{title}**\")\n            st.markdown(text)\n            st.divider()\n</code></pre>"},{"location":"reference/refi_calculator/web/market/","title":"market","text":"<p>Market data helpers for the refinance calculator interface.</p>"},{"location":"reference/refi_calculator/web/market/#refi_calculator.web.market.fetch_all_series","title":"<code>fetch_all_series(api_key)</code>","text":"<p>Retrieve all configured market series from FRED.</p> <p>Parameters:</p> Name Type Description Default <code>api_key</code> <code>str</code> <p>API key to authenticate with FRED.</p> required <p>Returns:</p> Type Description <code>tuple[dict[str, list[tuple[str, float]]], list[str]]</code> <p>Tuple of raw series data and collection of error messages.</p> Source code in <code>src/refi_calculator/web/market.py</code> <pre><code>def fetch_all_series(api_key: str) -&gt; tuple[dict[str, list[tuple[str, float]]], list[str]]:\n    \"\"\"Retrieve all configured market series from FRED.\n\n    Args:\n        api_key: API key to authenticate with FRED.\n\n    Returns:\n        Tuple of raw series data and collection of error messages.\n    \"\"\"\n    raw_series: dict[str, list[tuple[str, float]]] = {}\n    errors: list[str] = []\n    for label, series_id in MARKET_SERIES:\n        try:\n            observations = _fetch_series(series_id, api_key)\n        except RuntimeError as exc:\n            logger.exception(\"Failed to fetch %s series\", label)\n            errors.append(f\"{label}: {exc}\")\n            observations = []\n        raw_series[label] = observations\n    return raw_series, errors\n</code></pre>"},{"location":"reference/refi_calculator/web/market/#refi_calculator.web.market.get_api_key","title":"<code>get_api_key()</code>","text":"<p>Retrieve the FRED API key stored in Streamlit secrets.</p> Source code in <code>src/refi_calculator/web/market.py</code> <pre><code>def get_api_key() -&gt; str | None:\n    \"\"\"Retrieve the FRED API key stored in Streamlit secrets.\"\"\"\n    return st.secrets.get(\"FRED_API_KEY\")\n</code></pre>"},{"location":"reference/refi_calculator/web/market/#refi_calculator.web.market.render_market_tab","title":"<code>render_market_tab()</code>","text":"<p>Render the market data tab with metrics, range selector, chart, and table.</p> Source code in <code>src/refi_calculator/web/market.py</code> <pre><code>def render_market_tab() -&gt; None:\n    \"\"\"Render the market data tab with metrics, range selector, chart, and table.\"\"\"\n    st.subheader(\"Market Data\")\n\n    api_key = get_api_key()\n    if not api_key:\n        st.warning(\n            \"Add your FRED API key to `st.secrets['FRED_API_KEY']` to view mortgage rate history.\",\n        )\n        return\n\n    raw_series, errors = fetch_all_series(api_key)\n    for err in errors:\n        st.error(err)\n\n    market_df_all = _build_market_dataframe(raw_series)\n    if market_df_all.empty:\n        st.info(\"Market data is not available for the selected range.\")\n        return\n\n    latest_valid = market_df_all.dropna(how=\"all\")\n    if latest_valid.empty:\n        st.info(\"Market data lacks recent observations.\")\n        return\n\n    latest = latest_valid.iloc[-1].dropna()\n    latest_timestamp_raw = latest_valid.index.max()\n    if latest_timestamp_raw is pd.NaT:\n        st.info(\"Market data lacks recent observations.\")\n        return\n    latest_date = cast(pd.Timestamp, latest_timestamp_raw).date()\n    st.markdown(\n        f\"**Current rates (latest available as of {latest_date:%Y-%m-%d})**\",\n    )\n    if not latest.empty:\n        metric_cols = st.columns(len(latest))\n        for col, (label, value) in zip(metric_cols, latest.items()):\n            col.metric(label, f\"{value:.2f}%\")\n\n    options = [label for label, _ in MARKET_PERIOD_OPTIONS]\n    option_mapping = {label: value for label, value in MARKET_PERIOD_OPTIONS}\n    period_label = st.radio(\n        \"Range\",\n        options,\n        horizontal=True,\n        key=\"market_period\",\n    )\n    period_months = _segment_months(option_mapping[period_label])\n\n    market_df = _filter_market_dataframe(market_df_all, period_months)\n    if market_df.empty:\n        st.info(\"Filtered market data is not available for the selected range.\")\n        return\n\n    _render_market_chart(market_df)\n\n    table = market_df.sort_index(ascending=False).head(12).reset_index()\n    table[\"Date\"] = table[\"Date\"].dt.date\n    st.dataframe(table, width=\"stretch\")\n</code></pre>"},{"location":"reference/refi_calculator/web/results/","title":"results","text":"<p>Render refinance analysis output, visuals, and supporting tables.</p>"},{"location":"reference/refi_calculator/web/results/#refi_calculator.web.results.build_holding_display","title":"<code>build_holding_display(data)</code>","text":"<p>Create a holding-period display DataFrame.</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>list[dict]</code> <p>Raw holding period analysis data.</p> required <p>Returns:</p> Type Description <code>DataFrame</code> <p>Formatted DataFrame for the holding period tab.</p> Source code in <code>src/refi_calculator/web/results.py</code> <pre><code>def build_holding_display(data: list[dict]) -&gt; pd.DataFrame:\n    \"\"\"Create a holding-period display DataFrame.\n\n    Args:\n        data: Raw holding period analysis data.\n\n    Returns:\n        Formatted DataFrame for the holding period tab.\n    \"\"\"\n    if not data:\n        return pd.DataFrame()\n\n    df = pd.DataFrame(data)\n    return pd.DataFrame(\n        {\n            \"Years\": df[\"years\"].map(\"{:.0f}\".format),\n            \"Nominal Savings\": df[\"nominal_savings\"].map(format_signed_currency),\n            \"NPV\": df[\"npv\"].map(format_signed_currency),\n            \"NPV (A-T)\": df[\"npv_after_tax\"].map(format_signed_currency),\n            \"Recommendation\": df[\"recommendation\"],\n        },\n    )\n</code></pre>"},{"location":"reference/refi_calculator/web/results/#refi_calculator.web.results.build_sensitivity_display","title":"<code>build_sensitivity_display(data, npv_years)</code>","text":"<p>Produce a display frame for rate sensitivity scenarios.</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>list[dict]</code> <p>Raw sensitivity scenario data.</p> required <code>npv_years</code> <code>int</code> <p>Years window used for NPV calculations.</p> required <p>Returns:</p> Type Description <code>DataFrame</code> <p>Formatted DataFrame for display.</p> Source code in <code>src/refi_calculator/web/results.py</code> <pre><code>def build_sensitivity_display(\n    data: list[dict],\n    npv_years: int,\n) -&gt; pd.DataFrame:\n    \"\"\"Produce a display frame for rate sensitivity scenarios.\n\n    Args:\n        data: Raw sensitivity scenario data.\n        npv_years: Years window used for NPV calculations.\n\n    Returns:\n        Formatted DataFrame for display.\n    \"\"\"\n    if not data:\n        return pd.DataFrame()\n\n    df = pd.DataFrame(data)\n    return pd.DataFrame(\n        {\n            \"New Rate\": df[\"new_rate\"].map(\"{:.2f}%\".format),\n            \"Monthly \u0394\": df[\"monthly_savings\"].map(format_savings_delta),\n            \"Simple Breakeven\": df[\"simple_be\"].map(format_months),\n            \"NPV Breakeven\": df[\"npv_be\"].map(format_months),\n            f\"{npv_years}-Yr NPV\": df[\"five_yr_npv\"].map(format_signed_currency),\n        },\n    )\n</code></pre>"},{"location":"reference/refi_calculator/web/results/#refi_calculator.web.results.render_analysis_tab","title":"<code>render_analysis_tab(inputs, sensitivity_data, holding_period_data)</code>","text":"<p>Render the tables shown in the Analysis tab.</p> <p>Parameters:</p> Name Type Description Default <code>inputs</code> <code>CalculatorInputs</code> <p>Inputs used to drive the scenario.</p> required <code>sensitivity_data</code> <code>list[dict]</code> <p>Precomputed sensitivity data.</p> required <code>holding_period_data</code> <code>list[dict]</code> <p>Precomputed holding period data.</p> required Source code in <code>src/refi_calculator/web/results.py</code> <pre><code>def render_analysis_tab(\n    inputs: CalculatorInputs,\n    sensitivity_data: list[dict],\n    holding_period_data: list[dict],\n) -&gt; None:\n    \"\"\"Render the tables shown in the Analysis tab.\n\n    Args:\n        inputs: Inputs used to drive the scenario.\n        sensitivity_data: Precomputed sensitivity data.\n        holding_period_data: Precomputed holding period data.\n    \"\"\"\n    st.subheader(\"Analysis Tables\")\n    rate_tab, holding_tab = st.tabs([\"Rate Sensitivity\", \"Holding Period\"])\n\n    with rate_tab:\n        display = build_sensitivity_display(sensitivity_data, inputs.npv_window_years)\n        if display.empty:\n            st.info(\"Adjust the sensitivity controls to generate scenarios.\")\n        else:\n            st.dataframe(display.style.hide(axis=\"index\"), width=\"stretch\")\n\n    with holding_tab:\n        display = build_holding_display(holding_period_data)\n        if display.empty:\n            st.info(\"Holding period analysis will populate once inputs are available.\")\n        else:\n            styled = display.style.hide(axis=\"index\").applymap(\n                _recommendation_style,\n                subset=[\"Recommendation\"],\n            )\n            st.dataframe(styled, width=\"stretch\")\n</code></pre>"},{"location":"reference/refi_calculator/web/results/#refi_calculator.web.results.render_balance_comparison_chart","title":"<code>render_balance_comparison_chart(amortization_data)</code>","text":"<p>Plot loan balance comparison lines for current and new schedules.</p> Source code in <code>src/refi_calculator/web/results.py</code> <pre><code>def render_balance_comparison_chart(amortization_data: list[dict]) -&gt; None:\n    \"\"\"Plot loan balance comparison lines for current and new schedules.\"\"\"\n    if not amortization_data:\n        st.info(\"Loan balance comparison will appear after running the calculator.\")\n        return\n\n    df = pd.DataFrame(amortization_data)\n    if df.empty:\n        st.info(\"Loan balance comparison will appear after running the calculator.\")\n        return\n\n    df = df[[\"year\", \"current_balance\", \"new_balance\"]]\n    df.columns = [\"Year\", \"Current Balance\", \"New Balance\"]\n    df[\"Year\"] = df[\"Year\"].astype(int)\n\n    colors = {\n        \"Current Balance\": \"#ef4444\",\n        \"New Balance\": \"#16a34a\",\n    }\n    fig = go.Figure()\n    for loan in [\"Current Balance\", \"New Balance\"]:\n        fig.add_trace(\n            go.Scatter(\n                x=df[\"Year\"],\n                y=df[loan],\n                mode=\"lines\",\n                name=loan,\n                line=dict(color=colors[loan], width=3),\n                hovertemplate=\"Year=%{x}&lt;br&gt;Loan=%{text}&lt;br&gt;Balance=$%{y:,.0f}&lt;extra&gt;&lt;/extra&gt;\",\n                text=[loan] * len(df),\n            ),\n        )\n\n    fig.update_layout(\n        xaxis=dict(\n            title=\"Year\",\n            tickmode=\"linear\",\n            dtick=1,\n            tickformat=\"d\",\n            showgrid=False,\n        ),\n        yaxis=dict(\n            title=\"Loan Balance ($)\",\n            tickprefix=\"$\",\n            tickformat=\",\",\n        ),\n        legend=dict(title=\"Loan\"),\n        margin=dict(t=5, b=30, l=60, r=10),\n        hovermode=\"x\",\n    )\n\n    st.plotly_chart(fig, use_container_width=True)\n</code></pre>"},{"location":"reference/refi_calculator/web/results/#refi_calculator.web.results.render_cumulative_chart","title":"<code>render_cumulative_chart(analysis)</code>","text":"<p>Render the cumulative savings chart for the current scenario.</p> <p>Parameters:</p> Name Type Description Default <code>analysis</code> <code>RefinanceAnalysis</code> <p>Analysis output that contains the savings timeline.</p> required Source code in <code>src/refi_calculator/web/results.py</code> <pre><code>def render_cumulative_chart(analysis: RefinanceAnalysis) -&gt; None:\n    \"\"\"Render the cumulative savings chart for the current scenario.\n\n    Args:\n        analysis: Analysis output that contains the savings timeline.\n    \"\"\"\n    if not analysis.cumulative_savings:\n        st.info(\"Savings chart is not available yet.\")\n        return\n\n    chart_df = pd.DataFrame(\n        [\n            {\n                \"Month\": month,\n                \"Nominal\": nominal,\n                \"NPV\": npv_value,\n            }\n            for month, nominal, npv_value in analysis.cumulative_savings\n        ],\n    ).set_index(\"Month\")\n\n    st.line_chart(chart_df, width=\"stretch\")\n\n    if analysis.npv_breakeven_months:\n        st.caption(\n            f\"NPV breakeven occurs at {analysis.npv_breakeven_months:.0f} months.\",\n        )\n</code></pre>"},{"location":"reference/refi_calculator/web/results/#refi_calculator.web.results.render_loan_visualizations_tab","title":"<code>render_loan_visualizations_tab(analysis, amortization_data)</code>","text":"<p>Render the loan visualization subtabs for charts and tables.</p> <p>Parameters:</p> Name Type Description Default <code>analysis</code> <code>RefinanceAnalysis</code> <p>Analysis output for the current inputs.</p> required <code>amortization_data</code> <code>list[dict]</code> <p>Comparison schedule data.</p> required Source code in <code>src/refi_calculator/web/results.py</code> <pre><code>def render_loan_visualizations_tab(\n    analysis: RefinanceAnalysis,\n    amortization_data: list[dict],\n) -&gt; None:\n    \"\"\"Render the loan visualization subtabs for charts and tables.\n\n    Args:\n        analysis: Analysis output for the current inputs.\n        amortization_data: Comparison schedule data.\n    \"\"\"\n    st.subheader(\"Loan Visualizations\")\n    chart_tab, amort_tab = st.tabs([\"Chart\", \"Amortization\"])\n\n    with chart_tab:\n        st.subheader(\"Cumulative Savings\")\n        render_cumulative_chart(analysis)\n        st.subheader(\"Loan Balance Comparison\")\n        render_balance_comparison_chart(amortization_data)\n\n    with amort_tab:\n        st.subheader(\"Amortization Comparison\")\n        if not amortization_data:\n            st.info(\"Amortization data will appear after running the calculator.\")\n            return\n\n        amort_df = pd.DataFrame(amortization_data)\n        display_df = amort_df.rename(\n            columns={\n                \"year\": \"Year\",\n                \"current_principal\": \"Current Principal\",\n                \"current_interest\": \"Current Interest\",\n                \"current_balance\": \"Current Balance\",\n                \"new_principal\": \"New Principal\",\n                \"new_interest\": \"New Interest\",\n                \"new_balance\": \"New Balance\",\n                \"principal_diff\": \"Principal \u0394\",\n                \"interest_diff\": \"Interest \u0394\",\n                \"balance_diff\": \"Balance \u0394\",\n            },\n        )\n        display_df = display_df.reset_index(drop=True)\n\n        primary_columns = [\n            \"Current Principal\",\n            \"Current Interest\",\n            \"Current Balance\",\n            \"New Principal\",\n            \"New Interest\",\n            \"New Balance\",\n        ]\n        delta_columns = [\"Principal \u0394\", \"Interest \u0394\", \"Balance \u0394\"]\n\n        styler = Styler(display_df)\n        styled = styler.format(\"${:,.0f}\", subset=primary_columns).format(\n            \"${:+,.0f}\",\n            subset=delta_columns,\n        )\n        styled = cast(Styler, styled)\n        styled = styled.applymap(_interest_delta_style, subset=[\"Interest \u0394\"])\n        st.dataframe(styled, width=\"stretch\")\n</code></pre>"},{"location":"reference/refi_calculator/web/results/#refi_calculator.web.results.render_options_tab","title":"<code>render_options_tab(inputs)</code>","text":"<p>Render controls that affect chart and sensitivity behavior.</p> <p>Parameters:</p> Name Type Description Default <code>inputs</code> <code>CalculatorInputs</code> <p>Inputs used to drive the scenario.</p> required Source code in <code>src/refi_calculator/web/results.py</code> <pre><code>def render_options_tab(inputs: CalculatorInputs) -&gt; None:\n    \"\"\"Render controls that affect chart and sensitivity behavior.\n\n    Args:\n        inputs: Inputs used to drive the scenario.\n    \"\"\"\n    st.subheader(\"Application Options\")\n    st.number_input(\n        \"Chart Horizon (years)\",\n        min_value=1,\n        max_value=30,\n        step=1,\n        value=int(st.session_state[\"chart_horizon_years\"]),\n        key=\"chart_horizon_years\",\n    )\n    st.number_input(\n        \"Max Rate Reduction (%)\",\n        min_value=0.0,\n        max_value=5.0,\n        step=0.1,\n        value=float(st.session_state[\"sensitivity_max_reduction\"]),\n        key=\"sensitivity_max_reduction\",\n    )\n    st.number_input(\n        \"Rate Step (%)\",\n        min_value=0.01,\n        max_value=1.0,\n        step=0.01,\n        value=float(st.session_state[\"sensitivity_step\"]),\n        key=\"sensitivity_step\",\n    )\n    st.caption(\n        \"Adjust settings here to explore chart horizons and sensitivity detail; changes \"\n        \"take effect on the next calculation.\",\n    )\n\n    st.divider()\n\n    st.subheader(\"Active Parameters\")\n    cols = st.columns(3)\n    cols[0].metric(\"Opportunity Rate\", f\"{inputs.opportunity_rate:.2f}%\")\n    cols[1].metric(\"Marginal Tax Rate\", f\"{inputs.marginal_tax_rate:.2f}%\")\n    cols[2].metric(\"NPV Window\", f\"{inputs.npv_window_years} years\")\n</code></pre>"},{"location":"reference/refi_calculator/web/results/#refi_calculator.web.results.render_results","title":"<code>render_results(inputs, analysis)</code>","text":"<p>Render the calculator summary metrics for the provided analysis.</p> <p>Parameters:</p> Name Type Description Default <code>inputs</code> <code>CalculatorInputs</code> <p>Inputs used to drive the calculations.</p> required <code>analysis</code> <code>RefinanceAnalysis</code> <p>Computed refinance analysis.</p> required Source code in <code>src/refi_calculator/web/results.py</code> <pre><code>def render_results(\n    inputs: CalculatorInputs,\n    analysis: RefinanceAnalysis,\n) -&gt; None:\n    \"\"\"Render the calculator summary metrics for the provided analysis.\n\n    Args:\n        inputs: Inputs used to drive the calculations.\n        analysis: Computed refinance analysis.\n    \"\"\"\n    st.subheader(\"Analysis Results\")\n\n    payments = st.columns(3)\n    payments[0].metric(\"Current Payment\", format_currency(analysis.current_payment))\n    payments[1].metric(\"New Payment\", format_currency(analysis.new_payment))\n    payments[2].metric(\"Monthly \u0394\", format_savings_delta(analysis.monthly_savings))\n\n    st.divider()\n\n    balances = st.columns(2)\n    balances[0].metric(\"New Loan Balance\", format_currency(analysis.new_loan_balance))\n    balances[1].metric(\"Cash Out\", format_currency(analysis.cash_out_amount))\n\n    st.divider()\n\n    breakeven = st.columns(2)\n    breakeven[0].metric(\n        \"Simple Breakeven\",\n        format_months(analysis.simple_breakeven_months),\n    )\n    breakeven[1].metric(\n        \"NPV Breakeven\",\n        format_months(analysis.npv_breakeven_months),\n    )\n\n    st.divider()\n\n    interest = st.columns(3)\n    interest[0].metric(\n        \"Current Total Interest\",\n        format_currency(analysis.current_total_interest),\n    )\n    interest[1].metric(\n        \"New Total Interest\",\n        format_currency(analysis.new_total_interest),\n    )\n    interest[2].metric(\n        \"Interest \u0394\",\n        format_signed_currency(analysis.interest_delta),\n    )\n\n    st.divider()\n\n    st.subheader(\"After-Tax Analysis\")\n    after_tax_payments = st.columns(3)\n    after_tax_payments[0].metric(\n        \"Current (After-Tax)\",\n        format_currency(analysis.current_after_tax_payment),\n    )\n    after_tax_payments[1].metric(\n        \"New (After-Tax)\",\n        format_currency(analysis.new_after_tax_payment),\n    )\n    after_tax_payments[2].metric(\n        \"Monthly \u0394 (A-T)\",\n        format_savings_delta(analysis.after_tax_monthly_savings),\n    )\n\n    after_tax_breakeven = st.columns(3)\n    after_tax_breakeven[0].metric(\n        \"Simple BE (A-T)\",\n        format_months(analysis.after_tax_simple_breakeven_months),\n    )\n    after_tax_breakeven[1].metric(\n        \"NPV BE (A-T)\",\n        format_months(analysis.after_tax_npv_breakeven_months),\n    )\n    after_tax_breakeven[2].metric(\n        \"Interest \u0394 (A-T)\",\n        format_signed_currency(analysis.after_tax_interest_delta),\n    )\n\n    st.divider()\n\n    if inputs.maintain_payment and analysis.accelerated_months:\n        st.subheader(\"Accelerated Payoff (Maintain Payment)\")\n        accel = st.columns(3)\n        accel[0].metric(\"Payoff Time\", format_months(analysis.accelerated_months))\n        accel[1].metric(\n            \"Time Saved\",\n            format_months(analysis.accelerated_time_savings_months),\n        )\n        accel[2].metric(\n            \"Interest Saved\",\n            format_optional_currency(analysis.accelerated_interest_savings),\n        )\n        st.divider()\n\n    st.subheader(\"Total Cost NPV Analysis\")\n    cost = st.columns(3)\n    cost[0].metric(\"Current Loan NPV\", format_currency(analysis.current_total_cost_npv))\n    cost[1].metric(\"New Loan NPV\", format_currency(analysis.new_total_cost_npv))\n    cost[2].metric(\n        \"NPV Advantage\",\n        format_signed_currency(analysis.total_cost_npv_advantage),\n    )\n\n    st.divider()\n\n    st.metric(\n        f\"{inputs.npv_window_years}-Year NPV of Refinancing\",\n        format_signed_currency(analysis.five_year_npv),\n    )\n</code></pre>"},{"location":"reference/refi_calculator/web/runner/","title":"runner","text":"<p>Helper that launches the Streamlit web placeholder through the Streamlit CLI.</p>"},{"location":"reference/refi_calculator/web/runner/#refi_calculator.web.runner.main","title":"<code>main()</code>","text":"<p>Run the Streamlit app via the CLI to ensure a proper ScriptRunContext.</p> Source code in <code>src/refi_calculator/web/runner.py</code> <pre><code>def main() -&gt; None:\n    \"\"\"Run the Streamlit app via the CLI to ensure a proper ScriptRunContext.\"\"\"\n    script_path = Path(__file__).resolve().parent / \"app.py\"\n    sys.argv = [\"streamlit\", \"run\", str(script_path)]\n    stcli.main()\n</code></pre>"}]}